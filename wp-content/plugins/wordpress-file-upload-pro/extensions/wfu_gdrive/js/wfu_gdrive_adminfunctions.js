function wfu_gdrive_authorize_app_start(){var e=document.getElementById("wfu_gdrive_nonce").value,a=wfu_GetHttpRequestObject();if(null!=a){var t=AdminParams.wfu_ajax_url;params=new Array(2),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_gdrive_authorize_app_start",params[1]=new Array(2),params[1][0]="token",params[1][1]=e;for(var r="",n=0;n<params.length;n++)r+=(n>0?"&":"")+params[n][0]+"="+encodeURI(params[n][1]);a.open("POST",t,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=a.responseText.indexOf("wfu_gdrive_authorize_app_start:");-1==e&&(e=a.responseText.length),a.responseText.substr(0,e);var t=a.responseText.substr(e+31,a.responseText.length-e-31);e=t.indexOf(":");var r=t.substr(0,e);if(txt_value=t.substr(e+1,t.length-e-1),"success"==r){var n=window.open(wfu_plugin_decode_string(txt_value),"_blank");n?(n.plugin_window=window,addEventListener("message",wfu_gdrive_onmessage_listener)):alert("Please enable popup windows from the browser's settings!")}else"error"==r&&console.log("Google Drive application authorization error: "+txt_value)}},a.send(r)}}function wfu_gdrive_onmessage_listener(e){var a=wfu_decode_array_from_string(e.data);null!=a&&a.hasOwnProperty("code")&&""!=a.code&&a.hasOwnProperty("state")&&""!=a.state&&wfu_gdrive_authorize_app_finish(a.state,a.code)}function wfu_gdrive_authorize_app_finish(e,a){var t=document.getElementById("wfu_gdrive_nonce").value;if(""!=a.trim()&&""!=e.trim()){var r=wfu_GetHttpRequestObject();if(null!=r){removeEventListener("message",wfu_gdrive_onmessage_listener);var n=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_gdrive_authorize_app_finish",params[1]=new Array(2),params[1][0]="token",params[1][1]=t,params[2]=new Array(2),params[2][0]="authcode",params[2][1]=a,params[3]=new Array(2),params[3][0]="state",params[3][1]=e;for(var s="",o=0;o<params.length;o++)s+=(o>0?"&":"")+params[o][0]+"="+encodeURI(params[o][1]);document.querySelector(".wfu-gdrive-completing-activation").style.display="inline-flex",document.querySelector(".wfu-gdrive-repeat-activation").style.display="none",r.open("POST",n,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){document.querySelector(".wfu-gdrive-completing-activation").style.display="none";var e=r.responseText.indexOf("wfu_gdrive_authorize_app_finish:");-1==e&&(e=r.responseText.length),r.responseText.substr(0,e);var a=r.responseText.substr(e+32,r.responseText.length-e-32);e=a.indexOf(":");var t=a.substr(0,e);txt_value=a.substr(e+1,a.length-e-1),"success"==t?document.getElementById("editsettings").submit():"error"==t?console.log("Google Drive application authorization error: "+txt_value):"repeat"==t&&(document.querySelector(".wfu-gdrive-repeat-activation").style.display="inline-block")}},r.send(s)}}}function wfu_gdrive_authorize_app_reset(){var e=document.getElementById("wfu_gdrive_nonce").value,a=wfu_GetHttpRequestObject();if(null!=a){var t=AdminParams.wfu_ajax_url;params=new Array(2),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_gdrive_authorize_app_reset",params[1]=new Array(2),params[1][0]="token",params[1][1]=e;for(var r="",n=0;n<params.length;n++)r+=(n>0?"&":"")+params[n][0]+"="+encodeURI(params[n][1]);a.open("POST",t,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=a.responseText.indexOf("wfu_gdrive_authorize_app_reset:");-1==e&&(e=a.responseText.length),a.responseText.substr(0,e);var t=a.responseText.substr(e+31,a.responseText.length-e-31);e=t.indexOf(":");var r=t.substr(0,e);txt_value=t.substr(e+1,t.length-e-1),"success"==r?document.getElementById("editsettings").submit():"error"==r&&console.log("Google Drive application authorization error: "+txt_value)}},a.send(r)}}function wfu_gdrive_send_file(e,a){var t=wfu_GetHttpRequestObject();if(null!=t){var r="",n=document.getElementById("wfu_gdrive_transfer_nonce");if(n&&(r=n.value),""!=r){var s=AdminParams.wfu_ajax_url;params=new Array(2),params[0]=new Array(3),params[0][0]="action",params[0][1]="wfu_ajax_action_gdrive_add_file",params[1]=new Array(2),params[1][0]="file",params[1][1]=e,params[2]=new Array(2),params[2][0]="nonce",params[2][1]=r;for(var o="",i=0;i<params.length;i++)o+=(i>0?"&":"")+params[i][0]+"="+encodeURI(params[i][1]);document.getElementById("wfu_send_to_gdrive_"+a+"_a").href="javascript: void(0)",document.getElementById("wfu_send_to_gdrive_"+a+"_img").style.display="inline",t.open("POST",s,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4==t.readyState&&(document.getElementById("wfu_send_to_gdrive_"+a+"_img").style.display="none",200==t.status)){var e=t.responseText.indexOf("wfu_gdrive_add_file:");-1==e&&(e=t.responseText.length),t.responseText.substr(0,e);var r=t.responseText.substr(e+20,t.responseText.length-e-20);e=r.indexOf(":");var n=r.substr(0,e);txt_value=r.substr(e+1,r.length-e-1),document.getElementById("wfu_send_to_gdrive_"+a+"_a").innerHTML="success"==n?document.getElementById("wfu_send_to_gdrive_"+a+"_inpok").value:document.getElementById("wfu_send_to_gdrive_"+a+"_inpfail").value}},t.send(o)}}}
