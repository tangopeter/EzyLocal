var DraggedItem=null,ShortcodeNextSave=0,ShortcodeTimeOut=null,ShortcodeString="",Autosave=!1,PageObsolete=!1,PageUpdating=!1,CheckObsolescenceTimeOut=5e3,wfu_transfers_observer_interval=100,wfu_allops_freeze_events=!1,wfu_PD_bank={};function wfu_admin_activate_tab(e){for(var t,n,a=document.getElementById("wfu_tab_container"),o=0;o<a.childNodes.length;o++)1===(t=a.childNodes[o]).nodeType&&(n=t.id.substr(8),t.className.indexOf("nav-tab-active")>-1&&(t.className="nav-tab",document.getElementById("wfu_container_"+n).style.display="none"));if(document.getElementById("wfu_tab_"+e).className="nav-tab nav-tab-active",document.getElementById("wfu_container_"+e).style.display="block","customcss"==e){var r,l=document.getElementsByName("wfu_csseditor_elements");for(o=0;o<l.length;o++)r=l[o].id.replace("wfu_attribute_",""),document.getElementById("wfu_attribute_"+r+"_wrapper").CodeMirror.refresh()}}function wfu_admin_onoff_clicked(e){var t=document.getElementById("wfu_attribute_"+e),n=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_"+e),a=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_"+e+"_inv"),o="on"==t.className.substr(t.className.length-2);if(o=!o){document.getElementById("wfu_attribute_value_"+e).value="true",t.className="wfu_onoff_container_on";for(var r=0;r<n.length;r++)n[r].style.display="none";for(r=0;r<a.length;r++)a[r].style.display="block"}else{for(document.getElementById("wfu_attribute_value_"+e).value="false",t.className="wfu_onoff_container_off",r=0;r<n.length;r++)n[r].style.display="block";for(r=0;r<a.length;r++)a[r].style.display="none"}wfu_generate_shortcode(),"userdata"!=e&&"formdata"!=e||wfu_update_formfield_variables()}function wfu_admin_radio_clicked(e){var t=document.getElementsByName("wfu_radioattribute_"+e),n=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_"+e),a=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_"+e+"_inv"),o="";for(r=0;r<t.length;r++)t[r].checked&&(o=t[r].value);if("*"==o.substr(0,1)){o=o.substr(1);for(var r=0;r<n.length;r++)n[r].style.display="none";for(r=0;r<a.length;r++)a[r].style.display="block"}else{for(r=0;r<n.length;r++)n[r].style.display="block";for(r=0;r<a.length;r++)a[r].style.display="none"}document.getElementById("wfu_attribute_value_"+e).value=o,wfu_generate_shortcode()}function wfu_set_checkbox_status(e,t){0==t?(e.checked=!1,e.indeterminate=!0,e.classList.add("indeterminate")):(e.indeterminate=!1,e.classList.remove("indeterminate"),e.checked=1==t)}function wfu_addEventHandler(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function wfu_attach_separator_dragdrop_events(){for(var e,t=document.getElementById("wfu_placements_container"),n=0;n<t.childNodes.length;n++)"wfu_component_separator_hor"!=(e=t.childNodes[n]).className&&"wfu_component_separator_ver"!=e.className||(wfu_addEventHandler(e,"dragenter",wfu_separator_dragenter),wfu_addEventHandler(e,"dragover",wfu_default_dragover),wfu_addEventHandler(e,"dragleave",wfu_separator_dragleave),wfu_addEventHandler(e,"drop",wfu_separator_drop))}function wfu_Attach_Admin_DragDrop_Events(){if(window.FileReader){var e=document.getElementById("wfu_placements_container");if(e){for(var t,n=document.getElementById("wfu_componentlist_container"),a=0;a<e.childNodes.length;a++)"wfu_component_box"==(t=e.childNodes[a]).className&&(wfu_addEventHandler(t,"dragstart",wfu_component_dragstart),wfu_addEventHandler(t,"dragend",wfu_component_dragend));for(a=0;a<n.childNodes.length;a++)if("wfu_component_box_container"==(t=n.childNodes[a]).className)for(var o=0;o<t.childNodes.length;o++)"wfu_component_box wfu_inbase"==t.childNodes[o].className&&(wfu_addEventHandler(t.childNodes[o],"dragstart",wfu_component_dragstart),wfu_addEventHandler(t.childNodes[o],"dragend",wfu_component_dragend));wfu_addEventHandler(t=document.getElementById("wfu_componentlist_dragdrop"),"dragenter",wfu_componentlist_dragenter),wfu_addEventHandler(t,"dragover",wfu_default_dragover),wfu_addEventHandler(t,"dragleave",wfu_componentlist_dragleave),wfu_addEventHandler(t,"drop",wfu_componentlist_drop),wfu_attach_separator_dragdrop_events()}}}function wfu_componentlist_dragenter(e){if((e=e||window.event).preventDefault&&e.preventDefault(),!DraggedItem)return!1;var t=document.getElementById("wfu_componentlist_dragdrop");return-1==t.className.indexOf("wfu_componentlist_dragdrop_dragover")&&(t.className+=" wfu_componentlist_dragdrop_dragover"),!1}function wfu_componentlist_dragleave(e){if((e=e||window.event).preventDefault&&e.preventDefault(),!DraggedItem)return!1;var t=document.getElementById("wfu_componentlist_dragdrop");return t.className=t.className.replace(" wfu_componentlist_dragdrop_dragover",""),!1}function wfu_componentlist_drop(e){(e=e||window.event).preventDefault&&e.preventDefault();var t=e.dataTransfer.getData("Component");if(!t)return!1;var n=t.split("_"),a=n[0],o=parseInt(n[1]),r=document.getElementById("wfu_component_box_"+a+"_"+o);0==o?(r.className="wfu_component_box wfu_inbase",r.style.display="block",document.getElementById("wfu_component_box_container_"+a).appendChild(r)):r.parentNode.removeChild(r);var l=wfu_admin_recreate_placements_text(null,"");return wfu_admin_recreate_placements_panel(l),document.getElementById("wfu_attribute_value_placements").value=l,wfu_update_multiplacement_attributes(),wfu_generate_shortcode(),!1}function wfu_separator_dragenter(e){if((e=e||window.event).preventDefault&&e.preventDefault(),!DraggedItem)return!1;if("wfu_component_separator_hor"==e.target.className)(t=document.getElementById("wfu_component_bar_hor")).style.top=e.target.offsetTop+"px",t.style.display="block";else if("wfu_component_separator_ver"==e.target.className){var t;(t=document.getElementById("wfu_component_bar_ver")).style.top=e.target.offsetTop+"px",t.style.left=e.target.offsetLeft+"px",t.style.display="block"}return!1}function wfu_default_dragover(e){return(e=e||window.event).preventDefault&&e.preventDefault(),!1}function wfu_separator_dragleave(e){return(e=e||window.event).preventDefault&&e.preventDefault(),!!DraggedItem&&("wfu_component_separator_hor"==e.target.className?document.getElementById("wfu_component_bar_hor").style.display="none":"wfu_component_separator_ver"==e.target.className&&(document.getElementById("wfu_component_bar_ver").style.display="none"),!1)}function wfu_separator_drop(e){(e=e||window.event).preventDefault&&e.preventDefault();var t=e.dataTransfer.getData("Component");if(!t)return!1;var n=t.split("_"),a=n[0],o=parseInt(n[1]),r=document.getElementById("wfu_component_box_"+a+"_"+o);r.style.display="none",r.className="wfu_component_box wfu_inbase",document.getElementById("wfu_component_box_container_"+a).appendChild(r);var l=wfu_admin_recreate_placements_text(e.target,a);return wfu_admin_recreate_placements_panel(l),document.getElementById("wfu_attribute_value_placements").value=l,wfu_update_multiplacement_attributes(),wfu_generate_shortcode(),!1}function wfu_component_dragstart(e){(e=e||window.event).dataTransfer.setData("Component",e.target.id.replace("wfu_component_box_","")),-1==e.target.className.indexOf("wfu_component_box_dragged")&&(e.target.className+=" wfu_component_box_dragged",DraggedItem=e.target),e.target.style.zIndex=3;var t=document.getElementById("wfu_componentlist_dragdrop");return t.className="wfu_componentlist_dragdrop wfu_componentlist_dragdrop_dragover",t.style.display="block",!1}function wfu_component_dragend(e){e=e||window.event,DraggedItem=null,e.target.style.zIndex=1;var t=document.getElementById("wfu_componentlist_dragdrop");return t.style.display="none",t.className="wfu_componentlist_dragdrop",e.target.className=e.target.className.replace(" wfu_component_box_dragged",""),document.getElementById("wfu_component_bar_ver").style.display="none",document.getElementById("wfu_component_bar_hor").style.display="none",!1}function wfu_admin_recreate_placements_text(e,t){function n(e){""!=r&&(r+=o),r+=e,o=""}for(var a=document.getElementById("wfu_placements_container"),o="",r="",l=0;l<a.childNodes.length;l++)item=a.childNodes[l],"wfu_component_separator_ver"==item.className?(""==o&&(o="+"),item==e&&(n(t),o="+")):"wfu_component_separator_hor"==item.className?(o="/",item==e&&(n(t),o="/")):"wfu_component_box"==item.className&&n(item.id.replace("wfu_component_box_","").replace(/_.*$/,""));return r}function wfu_admin_recreate_placements_panel(e){for(var t,n,a,o,r,l=document.getElementById("wfu_placements_container"),s="",u=0;u<l.childNodes.length;u++)"wfu_component_box"==(t=l.childNodes[u]).className&&(s=(o=t.id.replace("wfu_component_box_","").split("_"))[0],0==parseInt(o[1])?(t.style.display="inline-block",t.className="wfu_component_box wfu_inbase",document.getElementById("wfu_component_box_container_"+s).appendChild(t)):t.parentNode.removeChild(t));var d=document.querySelectorAll("div.wfu_component_box_container"),_={};for(u=0;u<d.length;u++)_[s=d[u].id.replace("wfu_component_box_container_","")]=0,(r=document.querySelector("div#"+d[u].id+" div.wfu_component_box_index"))&&(r.innerHTML="1");for(l.innerHTML="",n=e.split("/"),u=0;u<n.length;u++){(t=document.createElement("DIV")).className="wfu_component_separator_hor",t.setAttribute("draggable",!0),l.appendChild(t),(t=document.createElement("DIV")).className="wfu_component_separator_ver",t.setAttribute("draggable",!0),l.appendChild(t),a=n[u].split("+");for(var i=0;i<a.length;i++)(t=document.querySelector("div#wfu_component_box_container_"+a[i]+" div.wfu_component_box.wfu_inbase"))&&(s=(o=t.id.replace("wfu_component_box_","").split("_"))[0],0==parseInt(o[1])?l.appendChild(t):(_[s]++,t.id="wfu_component_box_"+s+"_"+(_[s]+1).toString(),t.style.display="block",(r=document.querySelector("div#"+t.id+" div.wfu_component_box_index")).innerHTML=(_[s]+1).toString(),t=t.cloneNode(!0),l.appendChild(t),t.id="wfu_component_box_"+s+"_"+_[s].toString(),(r=document.querySelector("div#"+t.id+" div.wfu_component_box_index")).innerHTML=_[s].toString(),wfu_addEventHandler(t,"dragstart",wfu_component_dragstart),wfu_addEventHandler(t,"dragend",wfu_component_dragend)),t.className="wfu_component_box",t.style.display="inline-block",(t=document.createElement("DIV")).className="wfu_component_separator_ver",t.setAttribute("draggable",!0),l.appendChild(t))}(t=document.createElement("DIV")).className="wfu_component_separator_hor",t.setAttribute("draggable",!0),l.appendChild(t),(t=document.createElement("DIV")).id="wfu_component_bar_hor",t.className="wfu_component_bar_hor",l.appendChild(t),(t=document.createElement("DIV")).id="wfu_component_bar_ver",t.className="wfu_component_bar_ver",l.appendChild(t),wfu_attach_separator_dragdrop_events()}function wfu_update_multiplacement_attributes(){for(var e=document.querySelectorAll("div.wfu_component_box_container"),t=0;t<e.length;t++){itemname=e[t].id.replace("wfu_component_box_container_","");var n=document.querySelector("div#"+e[t].id+" div.wfu_component_box_index");if(n)for(var a=Math.max(1,parseInt(n.innerHTML)-1),o=document.getElementsByName("wfu_attribute_governor_"+itemname),r=0;r<o.length;r++)wfu_update_multiplacement_attribute(o[r].value,a)}}function wfu_update_multiplacement_attribute(e,t){if("userdatalabel"==e){var n=document.querySelectorAll("div.wfu_formdata_container"),a=n.length;if(a<1)return;for(var o,r,l=n[0],s=2;s<=Math.max(a,t);){if(s>a){var u=e+s.toString();for(o=l.parentNode;null!=o&&"TR"!=o.tagName;)o=o.parentNode;if(null==o||"TR"!=o.tagName)return;(r=o.cloneNode(!0)).id="tr_"+wfu_randomString(4),o.parentNode.appendChild(r);var d=document.querySelector("tr#"+r.id+' label[for="wfu_attribute_'+e+'"]');d.setAttribute("for","wfu_attribute_"+u),d.innerHTML+=" ("+s.toString()+")",(d=document.querySelector("tr#"+r.id+" input.wfu_attribute_governor")).setAttribute("name","wfu_attribute_governor_independent"),d.value=u,(d=document.querySelector("tr#"+r.id+" div.wfu_formdata_container")).id+=s.toString();var _=document.getElementById("wfu_attribute_default_"+u);_||((_=document.createElement("INPUT")).id="wfu_attribute_default_"+u,_.type="hidden",_.value=document.getElementById("wfu_attribute_default_"+e).value,document.getElementById("wfu_attribute_defaults").appendChild(_));var i=document.getElementById("wfu_attribute_value_"+u);i||((i=document.createElement("INPUT")).id="wfu_attribute_value_"+u,i.type="hidden",i.value=_.value,document.getElementById("wfu_attribute_values").appendChild(i)),window["wfu_attribute_"+u+"_formtemplate"]=window["wfu_attribute_"+e+"_formtemplate"],window["wfu_attribute_"+u+"_typeprops"]=window["wfu_attribute_"+e+"_typeprops"],wfu_apply_value(u,"formfields",i.value)}else if(s>t){for(r=n[s-1].parentNode;null!=r&&"TR"!=r.tagName;)r=r.parentNode;if(null==r||"TR"!=r.tagName)return;r.parentNode.removeChild(r),wfu_update_formfield_variables()}s++}n=document.querySelectorAll("div.wfu_formdata_container");var c=[];for(s=0;s<n.length;s++)c.push(n[s].id.replace(/^wfu_attribute_/,""));var f=document.querySelectorAll(".wfu_formdata_all_attributes");for(s=0;s<f.length;s++)f[s].value=c.join(",");wfu_formdata_update_all_updown_buttons(e)}}function wfu_subfolders_input_changed(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_subfolders_path_","");n=n.replace("wfu_subfolders_label_","");var a=document.getElementById("wfu_attribute_"+n);if(!(a.selectedIndex<0)){var o,r,l=document.getElementById("wfu_subfolders_path_"+n),s=document.getElementById("wfu_subfolders_label_"+n),u=document.getElementById("wfu_subfolders_ok_"+n),d="1"==document.getElementById("wfu_subfolders_isnewitem_"+n).value;if(d?(o="",r=""):(o=(t=a.data[a.selectedIndex]).path,r=t.label),l.value==o&&s.value==r)u.disabled=!0,d||wfu_subfolders_update_nav(n);else{u.disabled=!1;for(var _=document.getElementsByName("wfu_subfolder_nav_"+n),i=0;i<_.length;i++)_[i].disabled=!0}}}function wfu_subfolders_auto_changed(e){var t=document.getElementById("wfu_attribute_"+e),n=document.getElementById("wfu_subfolders_auto_"+e),a=document.getElementById("wfu_subfolders_editable_"+e),o=document.getElementById("wfu_subfolders_manualtext_"+e);if(n.checked){var r=document.getElementById("wfu_attribute_value_"+e).value;"auto"!=r.substr(0,4)&&(o.value=r),a.parentNode.style.display="inline",wfu_apply_value(e,"folderlist","auto"+(a.checked?"+":"")),t.disabled=!0}else t.disabled=!1,a.parentNode.style.display="none",wfu_apply_value(e,"folderlist",o.value)}function wfu_subfolders_up_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;item=n[t.selectedIndex];var a=item.index-1;if(!(a<0)){for(var o=-1,r=t.selectedIndex-1;r>=0;){if(n[r].level==item.level&&n[r].index==a){o=r;break}r--}if(-1!=o){var l=0;for(r=t.selectedIndex+1;r<n.length&&n[r].level>item.level;)l++,r++;n[o].index=item.index,item.index=a,t.data=n.slice(0,o).concat(n.slice(t.selectedIndex,t.selectedIndex+1+l)).concat(n.slice(o,t.selectedIndex)).concat(n.slice(t.selectedIndex+1+l));var s=wfu_update_subfolder_list(e);t.selectedIndex=o,wfu_subfolders_update_toolnav(e),item=t,s!==item.oldVal&&(item.oldVal=s,document.getElementById("wfu_attribute_value_"+e).value=s,wfu_generate_shortcode())}}}}function wfu_subfolders_down_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;item=n[t.selectedIndex];var a=item.index+1,o=-1;for(curind=t.selectedIndex+1;curind<n.length;){if(n[curind].level==item.level){o=curind;break}if(n[curind].level<item.level)break;curind++}if(-1!=o){var r=0;for(curind=o+1;curind<n.length&&n[curind].level>item.level;)r++,curind++;n[o].index=item.index,item.index=a,t.data=n.slice(0,t.selectedIndex).concat(n.slice(o,o+1+r)).concat(n.slice(t.selectedIndex,o)).concat(n.slice(o+1+r));var l=wfu_update_subfolder_list(e);t.selectedIndex=t.selectedIndex+r+1,wfu_subfolders_update_toolnav(e),item=t,l!==item.oldVal&&(item.oldVal=l,document.getElementById("wfu_attribute_value_"+e).value=l,wfu_generate_shortcode())}}}function wfu_subfolders_left_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;for(item=n[t.selectedIndex],curind=t.selectedIndex+1;curind<n.length&&n[curind].level>item.level;)n[curind].level--,curind++;item.level--;var a=wfu_update_subfolder_list(e);t.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),item=t,a!==item.oldVal&&(item.oldVal=a,document.getElementById("wfu_attribute_value_"+e).value=a,wfu_generate_shortcode())}}function wfu_subfolders_right_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;for(item=n[t.selectedIndex],curind=t.selectedIndex+1;curind<n.length&&n[curind].level>item.level;)n[curind].level++,curind++;item.level++;var a=wfu_update_subfolder_list(e);t.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),item=t,a!==item.oldVal&&(item.oldVal=a,document.getElementById("wfu_attribute_value_"+e).value=a,wfu_generate_shortcode())}}function wfu_subfolders_def_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;if(item=n[t.selectedIndex],item.default)item.default=!1;else{for(var a=0;a<n.length;a++)n[a].default=!1;item.default=!0}var o=wfu_update_subfolder_list(e);wfu_subfolders_update_toolnav(e),item=t,o!==item.oldVal&&(item.oldVal=o,document.getElementById("wfu_attribute_value_"+e).value=o,wfu_generate_shortcode())}}function wfu_subfolders_ok_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=document.getElementById("wfu_subfolders_path_"+e),a=document.getElementById("wfu_subfolders_label_"+e);if(""!=n.value&&""!=a.value){var o=t.data;if("1"==document.getElementById("wfu_subfolders_isnewitem_"+e).value){var r=parseInt(document.getElementById("wfu_subfolders_newitemlevel_"+e).value),l={label:a.value,path:n.value,level:r,default:!1},s=parseInt(document.getElementById("wfu_subfolders_newitemindex_"+e).value);s>=o.length?o.push(l):o.splice(s,0,l)}else item=o[t.selectedIndex],item.path=n.value,item.label=a.value;var u=wfu_update_subfolder_list(e);t.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),item=t,u!==item.oldVal&&(item.oldVal=u,document.getElementById("wfu_attribute_value_"+e).value=u,wfu_generate_shortcode())}else alert("Path or label cannot be empty!")}}function wfu_subfolders_del_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data;item=n[t.selectedIndex];var a=0;for(curind=t.selectedIndex+1;curind<n.length&&n[curind].level>item.level;)a++,curind++;if(!(a>0)||confirm("Children items will be deleted as well. Proceed?")){n.splice(t.selectedIndex,1+a);var o=wfu_update_subfolder_list(e);t.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),item=t,o!==item.oldVal&&(item.oldVal=o,document.getElementById("wfu_attribute_value_"+e).value=o,wfu_generate_shortcode())}}}function wfu_subfolders_add_clicked(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n=t.data,a=t.selectedIndex;item=n[a];var o=t.options,r=document.createElement("option");r.value="",r.innerHTML="",o.add(r,a),t.selectedIndex=a;var l=document.getElementById("wfu_subfolder_tools_"+e),s=document.getElementById("wfu_subfolders_path_"+e),u=document.getElementById("wfu_subfolders_label_"+e),d=document.getElementById("wfu_subfolders_ok_"+e),_=document.getElementById("wfu_subfolders_browse_"+e);l.className="wfu_subfolder_tools_container",u.disabled=!1,d.disabled=!0,document.getElementById("wfu_subfolders_isnewitem_"+e).value="1",document.getElementById("wfu_subfolders_newitemindex_"+e).value=a,document.getElementById("wfu_subfolders_newitemlevel_"+e).value=item.level,document.getElementById("wfu_subfolders_newitemlevel2_"+e).value="",s.disabled=0==item.level,_.disabled=0==item.level,0==item.level?(s.value="{root}",u.value="{upload folder}"):(s.value="",u.value="");for(var i=document.getElementsByName("wfu_subfolder_nav_"+e),c=0;c<i.length;c++)i[c].disabled=!0}}function wfu_subfolders_browse_clicked(e){var t=wfu_GetHttpRequestObject();if(null!=t){var n=null;try{n=new FormData}catch(e){}if(null!=n){for(var a=document.getElementById("wfu_global_dialog_container"),o=document.getElementById("wfu_subfolders_browser_"+e),r=document.getElementById("wfu_subfolders_browse_"+e),l=document.getElementById("wfu_subfolders_inner_shadow_"+e),s=document.getElementById("wfu_subfolders_browser_msgcont_"+e),u=document.getElementById("wfu_subfolders_browser_msg_"+e),d=document.getElementById("wfu_subfolders_browser_img_"+e),_=document.getElementById("wfu_subfolders_browser_ok_"+e),i=document.getElementById("wfu_subfolders_browser_list_"+e);i.options.length>0;)i.options.remove(0);_.disabled=!0,_.onclick=function(){wfu_folder_browser_cancel_clicked(e)},u.innerHTML="loading folder contents...",d.style.display="inline",s.style.display="block",a.style.display="block",o.style.display="block",o.style.left=r.offsetLeft+r.offsetWidth-o.offsetWidth+"px",o.style.top=r.offsetTop+r.offsetHeight-o.offsetHeight+"px",l.style.display="block",a.onclick=function(){wfu_folder_browser_cancel_clicked(e)};var c=document.getElementById("wfu_attribute_uploadpath").value;"/"==c.substr(c.length-1)&&(c=c.substr(0,c.length-1));var f=wfu_get_relative_path(e).split(","),m=c+f[0];"/"!=m.substr(0)&&(m="/"+m);var p="";2==f.length&&(p=f[1]),n.append("action","wfu_ajax_action_read_subfolders"),n.append("folder1",wfu_plugin_encode_string(m)),n.append("folder2",wfu_plugin_encode_string(p)),t.key=e,t.addEventListener("load",wfu_readfolderComplete,!1),t.addEventListener("error",wfu_readfolderFailed,!1),t.addEventListener("abort",wfu_readfolderCanceled,!1),t.open("POST",AdminParams.wfu_ajax_url),t.send(n)}}}function wfu_readfolderComplete(e){var t=e.target.key,n=document.getElementById("wfu_subfolders_browser_msgcont_"+t),a=document.getElementById("wfu_subfolders_browser_msg_"+t),o=document.getElementById("wfu_subfolders_browser_img_"+t),r=document.getElementById("wfu_subfolders_browser_list_"+t),l=document.getElementById("wfu_subfolders_browser_ok_"+t),s=document.getElementById("wfu_subfolders_path_"+t),u=document.getElementById("wfu_subfolders_label_"+t);if(-1!=e.target.responseText){var d=e.target.responseText.indexOf("wfu_read_subfolders:");-1==d&&(d=e.target.responseText.length),e.target.responseText.substr(0,d);var _=e.target.responseText.substr(d+20,e.target.responseText.length-d-20);d=_.indexOf(":");var i=_.substr(0,d);if(txt_value=_.substr(d+1,_.length-d-1),"success"==i){for(var c,f=wfu_plugin_decode_string(txt_value).split(","),m=0,p=0;p<f.length;p++)""!=f[p]&&((c=document.createElement("option")).value=f[p],c.innerHTML=f[p].replace("*","&nbsp;&nbsp;&nbsp;"),r.add(c),m++);0==m&&((c=document.createElement("option")).value="",c.innerHTML="{empty}",c.disabled=!0,r.add(c)),r.selectedIndex=-1,l.onclick=function(){var e=r.options[r.selectedIndex].value,n=parseInt(document.getElementById("wfu_subfolders_newitemlevel_"+t).value);"*"!=e.substr(0,1)&&0!=n||(document.getElementById("wfu_subfolders_newitemlevel_"+t).value=n+1,n>0&&(e=e.substr(1))),s.value=e,u.value=e,wfu_folder_browser_cancel_clicked(t),wfu_subfolders_ok_clicked(t)},n.style.display="none"}else"error"==i?(a.innerHTML=txt_value,o.style.display="none",l.disabled=!1):(a.innerHTML="Unknown error",o.style.display="none",l.disabled=!1)}}function wfu_readfolderFailed(e){var t=e.target.key,n=document.getElementById("wfu_subfolders_browser_msg_"+t),a=document.getElementById("wfu_subfolders_browser_img_"+t),o=document.getElementById("wfu_subfolders_browser_ok_"+t);n.innerHTML="Unknown error",a.style.display="none",o.disabled=!1}function wfu_readfolderCanceled(e){var t=e.target.key,n=document.getElementById("wfu_subfolders_browser_msg_"+t),a=document.getElementById("wfu_subfolders_browser_img_"+t),o=document.getElementById("wfu_subfolders_browser_ok_"+t);n.innerHTML="Unknown error",a.style.display="none",o.disabled=!1}function wfu_subfolders_browser_list_changed(e){var t=document.getElementById("wfu_subfolders_browser_list_"+e);document.getElementById("wfu_subfolders_browser_ok_"+e).disabled=t.selectedIndex<0}function wfu_folder_browser_cancel_clicked(e){var t=document.getElementById("wfu_global_dialog_container"),n=document.getElementById("wfu_subfolders_browser_"+e),a=(document.getElementById("wfu_subfolders_browse_"+e),document.getElementById("wfu_subfolders_inner_shadow_"+e));t.onclick=null,a.style.display="none",n.style.display="none",t.style.display="none"}function wfu_get_relative_path(e){var t=document.getElementById("wfu_attribute_"+e);if(!(t.selectedIndex<0)){var n,a=t.data,o="1"==document.getElementById("wfu_subfolders_isnewitem_"+e).value;n=o?parseInt(document.getElementById("wfu_subfolders_newitemlevel_"+e).value):a[t.selectedIndex].level;for(var r="/",l=t.selectedIndex-1,s=n;l>=0&&s>1;)a[l].level<s&&(r="/"+a[l].path+r,s=a[l].level),l--;return o&&"1"==document.getElementById("wfu_subfolders_newitemlevel2_"+e).value&&n>0&&t.selectedIndex>0&&(r+=","+a[t.selectedIndex-1].path),r}}function wfu_subfolders_changed(e){wfu_update_subfolder_list(e),wfu_subfolders_update_toolnav(e)}function wfu_subfolders_update_toolnav(e){var t,n,a=document.getElementById("wfu_attribute_"+e),o=document.getElementById("wfu_subfolder_tools_"+e),r=document.getElementById("wfu_subfolders_path_"+e),l=document.getElementById("wfu_subfolders_label_"+e),s=document.getElementById("wfu_subfolders_ok_"+e),u=document.getElementById("wfu_subfolders_browse_"+e),d=document.getElementById("wfu_subfolders_auto_"+e);if(document.getElementById("wfu_subfolders_isnewitem_"+e).value="",document.getElementById("wfu_subfolders_newitemindex_"+e).value="",document.getElementById("wfu_subfolders_newitemlevel_"+e).value="",document.getElementById("wfu_subfolders_newitemlevel2_"+e).value="",null==a.data?(t=wfu_decode_subfolder_list(e),a.data=t):t=a.data,0===a.data.length?(a.className="wfu_select_folders wfu_select_folders_empty",a.options[0].innerHTML=d.checked?"":"press here"):a.className="wfu_select_folders",a.selectedIndex<0)o.className="wfu_subfolder_tools_container wfu_subfolder_tools_disabled",r.disabled=!0,l.disabled=!0,s.disabled=!0,u.disabled=!0,l.value="",r.value="";else if(a.selectedIndex>=a.options.length-1){var _;o.className="wfu_subfolder_tools_container",l.disabled=!1,s.disabled=!0,document.getElementById("wfu_subfolders_isnewitem_"+e).value="1",document.getElementById("wfu_subfolders_newitemindex_"+e).value=t.length,_=0==t.length?0:0==t[t.length-1].level?1:t[t.length-1].level,document.getElementById("wfu_subfolders_newitemlevel_"+e).value=_,document.getElementById("wfu_subfolders_newitemlevel2_"+e).value="1",r.disabled=0==_,u.disabled=!1,0==_?(r.value="{root}",l.value="{upload folder}"):(r.value="",l.value="")}else o.className="wfu_subfolder_tools_container",l.disabled=!1,s.disabled=!0,n=t[a.selectedIndex],r.disabled=0==n.level,u.disabled=0==n.level,l.value=n.label,r.value=n.path;var i=document.getElementsByName("wfu_subfolder_nav_"+e);if(a.selectedIndex<0||a.selectedIndex>=a.options.length-1)for(var c=0;c<i.length;c++)i[c].disabled=!0;else wfu_subfolders_update_nav(e)}function wfu_subfolders_update_nav(e){var t=document.getElementById("wfu_attribute_"+e),n=document.getElementById("wfu_subfolders_up_"+e),a=document.getElementById("wfu_subfolders_down_"+e),o=document.getElementById("wfu_subfolders_left_"+e),r=document.getElementById("wfu_subfolders_right_"+e),l=document.getElementById("wfu_subfolders_add_"+e),s=document.getElementById("wfu_subfolders_def_"+e),u=document.getElementById("wfu_subfolders_del_"+e),d=t.data,_=d[t.selectedIndex];for(n.disabled=_.index<=0,ind=t.selectedIndex+1,nextind=0;ind<d.length;){if(d[ind].level==_.level){nextind=d[ind].index;break}if(d[ind].level<_.level)break;ind++}a.disabled=0==_.level||0==nextind,o.disabled=0==t.selectedIndex&&_.level<1||t.selectedIndex>0&&_.level<=1,t.selectedIndex>=1?prevlevel=d[t.selectedIndex-1].level:prevlevel=0,r.disabled=_.level-prevlevel>0,l.disabled=0==_.level,s.disabled=!1,s.className="button"+(_.default?" wfu_subfolder_nav_pressed":""),u.disabled=!1}function wfu_decode_subfolder(e){var t={label:"",path:"",level:0,default:!1};e=e.trim();for(var n=0,a=!1;n<e.length&&"*"==e.substr(n,1);)n++;"&"==(e=e.substr(n,e.length-n)).substr(0,1)&&(e=e.substr(1),a=!0),t.level=n,t.default=a;var o=e.split("/");return 1==o.length?(t.path=o[0],t.label=o[0]):o.length>1&&(t.path=o[0],t.label=o[1]),0==n&&(t.path="{root}",""==t.label&&(t.label="{upload folder}")),t}function wfu_decode_subfolder_list(e){for(var t,n=document.getElementById("wfu_attribute_"+e).options,a=Array(),o=["root"],r=[0],l=-1,s=0;s<n.length-1;s++){for(a.push(wfu_decode_subfolder(wfu_plugin_decode_string(n[s].value))),o.length>a[s].level?o[a[s].level]=a[s].path:o.push(a[s].path),t="",j=1;j<=a[s].level;j++)t+=o[j]+"/";a[s].fullpath=t,r.length<=a[s].level&&r.push(0),a[s].level>l?a[s].index=0:a[s].index=r[a[s].level]+1,r[a[s].level]=a[s].index,l=a[s].level}return a}function wfu_update_subfolder_list(e){var t=document.getElementById("wfu_attribute_"+e).options,n=document.getElementById("wfu_attribute_"+e).data;if(null!=n){var a,o,r="";t.length=n.length+1;for(var l=0;l<n.length;l++){for(a="",o="",j=0;j<n[l].level;j++)a+="*",o+="&nbsp;&nbsp;&nbsp;";n[l].default?(a+="&",t[l].className="wfu_select_folders_option_default"):t[l].className="",a+=n[l].path+"/"+n[l].label,o+=n[l].label,t[l].value=wfu_plugin_encode_string(a),t[l].innerHTML=o,""!=r&&(r+=","),r+=a}return t[n.length].value="",t[n.length].innerHTML="",r}}function wfu_userdata_edit_field(e,t,n){for(var a,o=0;o<e.childNodes.length;o++)"INPUT"==(a=e.childNodes[o]).tagName?"text"==a.type?(a.value=t,wfu_attach_element_handlers(a,wfu_update_userfield_value)):"checkbox"==a.type&&(a.checked=n):"DIV"==a.tagName&&(a.className="wfu_userdata_action")}function wfu_formdata_edit_field(e,t,n){}function wfu_formdata_get_field_props(e){var t=e.split("_")[0],n="wfu_formfield_"+e,a=window["wfu_attribute_"+t+"_typeprops"][document.getElementById(n+"_type").value];return{type:document.getElementById(n+"_type").value,label:""==a.label?document.getElementById(n+"_label").value:a.label,labelposition:"show"==a.labelposition.substr(0,4)&&document.getElementById(n+"_labelposition")?document.getElementById(n+"_labelposition").value:a.labelposition.substr(5),required:"show"==a.required.substr(0,4)&&document.getElementById(n+"_required")?document.getElementById(n+"_required").checked:"true"==a.required.substr(5),donotautocomplete:"show"==a.donotautocomplete.substr(0,4)&&document.getElementById(n+"_donotautocomplete")?document.getElementById(n+"_donotautocomplete").checked:"true"==a.donotautocomplete.substr(5),validate:"show"==a.validate.substr(0,4)&&document.getElementById(n+"_validate")?document.getElementById(n+"_validate").checked:"true"==a.validate.substr(5),typehook:"show"==a.typehook.substr(0,4)&&document.getElementById(n+"_typehook")?document.getElementById(n+"_typehook").checked:"true"==a.typehook.substr(5),hintposition:"show"==a.hintposition.substr(0,4)&&document.getElementById(n+"_hintposition")?document.getElementById(n+"_hintposition").value:a.hintposition.substr(5),default:"show"==a.default.substr(0,4)&&document.getElementById(n+"_default")?document.getElementById(n+"_default").value:a.default.substr(5),data:"show"==a.data.substr(0,4)&&document.getElementById(n+"_data")?document.getElementById(n+"_data").value:a.data.substr(5),group:"show"==a.group.substr(0,4)&&document.getElementById(n+"_group")?document.getElementById(n+"_group").value:a.group.substr(5),format:"show"==a.format.substr(0,4)&&document.getElementById(n+"_format")?document.getElementById(n+"_format").value:a.format.substr(5)}}function wfu_formdata_type_changed(e){var t=e.split("_")[0],n="wfu_formfield_"+e,a=document.getElementById(n+"_container"),o=wfu_formdata_prepare_template(t,wfu_formdata_get_field_props(e),e);a.innerHTML=o;for(var r=document.querySelectorAll("div#"+n+'_container input[name="wfu_formfield_elements"]'),l=0;l<r.length;l++)wfu_attach_element_handlers(r[l],wfu_update_formfield_value);wfu_formdata_update_buttons(e),wfu_update_formfield_value({target:a})}function wfu_userdata_add_field(e){var t=e.parentNode,n=t.cloneNode(!0);wfu_userdata_edit_field(n,"",!1),t.parentNode.insertBefore(n,t.nextSibling)}function wfu_formdata_add_field(e){var t=e.split("_"),n=t[0],a=(t[1],document.getElementById("wfu_attribute_"+n)),o=document.getElementById("wfu_formfield_"+e+"_container"),r=document.createElement("DIV"),l=n+"_"+wfu_randomString(4);r.id="wfu_formfield_"+l+"_container",r.className="wfu_formdata_line_container",a.insertBefore(r,o.nextSibling);var s=wfu_formdata_prepare_template(n,{type:"text",label:"",labelposition:"left",required:!1,donotautocomplete:!1,validate:!1,default:"",data:"",group:"",format:"",hintposition:"right",typehook:!1},l);r.innerHTML=s;for(var u=document.querySelectorAll("div#wfu_formfield_"+l+'_container input[name="wfu_formfield_elements"]'),d=0;d<u.length;d++)wfu_attach_element_handlers(u[d],wfu_update_formfield_value);wfu_formdata_update_buttons(e),wfu_formdata_update_buttons(l),wfu_update_formfield_value({target:r})}function wfu_formdata_prepare_template(e,t,n){var a=wfu_plugin_decode_string(window["wfu_attribute_"+e+"_formtemplate"]),o=window["wfu_attribute_"+e+"_typeprops"][t.type],r=window["wfu_attribute_"+e+"_typeprops"][0].split(","),l=["label","required","donotautocomplete","validate","typehook","labelposition","hintposition","default","data","group","format"],s=["none","top","right","bottom","left","placeholder"],u=["none","inline","top","right","bottom","left"];a=a.replace(/\[\[key\]\]/g,n).replace(/\[\[t\]\]/g,t.type).replace(/\[\[label\]\]/g,t.label).replace(/\[\[s\]\]/g,t.labelposition).replace(/\[\[d\]\]/g,t.default).replace(/\[\[l\]\]/g,t.data).replace(/\[\[label_label\]\]/g,o.label_label).replace(/\[\[data_label\]\]/g,o.data_label).replace(/\[\[g\]\]/g,t.group).replace(/\[\[f\]\]/g,t.format).replace(/\[\[p\]\]/g,t.hintposition);for(var d=0;d<l.length;d++)a=a.replace(new RegExp("\\[\\["+l[d]+"_hint\\]\\]","g"),o[l[d]+"_hint"]);for(d=0;d<r.length;d++)a=a.replace("[[type_"+r[d]+"_selected]]",r[d]==t.type?' selected="selected"':"");for(d=0;d<s.length;d++)a=a.replace("[[labelposition_"+s[d]+"_selected]]",s[d]==t.labelposition?' selected="selected"':"");for(d=0;d<u.length;d++)a=a.replace("[[hintposition_"+u[d]+"_selected]]",u[d]==t.hintposition?' selected="selected"':"");return a=(a=(a=a.replace("[[remove_disabled]]","")).replace("[[up_disabled]]","")).replace("[[down_disabled]]",""),a=t.required?a.replace(/\[\[r\-\>\]\]|\[\[\<\-r\]\]/g,""):a.replace(/\[\[r\-\>\]\].*\[\[\<\-r\]\]/g,""),a=t.donotautocomplete?a.replace(/\[\[a\-\>\]\]|\[\[\<\-a\]\]/g,""):a.replace(/\[\[a\-\>\]\].*\[\[\<\-a\]\]/g,""),a=t.validate?a.replace(/\[\[v\-\>\]\]|\[\[\<\-v\]\]/g,""):a.replace(/\[\[v\-\>\]\].*\[\[\<\-v\]\]/g,""),a=t.typehook?a.replace(/\[\[h\-\>\]\]|\[\[\<\-h\]\]/g,""):a.replace(/\[\[h\-\>\]\].*\[\[\<\-h\]\]/g,""),a="show"==o.labelposition.substr(0,4)?a.replace(/\[\[S\-\>\]\]|\[\[\<\-S\]\]/g,""):a.replace(/\[\[S\-\>\]\][^]*\[\[\<\-S\]\]/g,""),a="show"==o.required.substr(0,4)?a.replace(/\[\[R\-\>\]\]|\[\[\<\-R\]\]/g,""):a.replace(/\[\[R\-\>\]\][^]*\[\[\<\-R\]\]/g,""),a="show"==o.donotautocomplete.substr(0,4)?a.replace(/\[\[A\-\>\]\]|\[\[\<\-A\]\]/g,""):a.replace(/\[\[A\-\>\]\][^]*\[\[\<\-A\]\]/g,""),a="show"==o.validate.substr(0,4)?a.replace(/\[\[V\-\>\]\]|\[\[\<\-V\]\]/g,""):a.replace(/\[\[V\-\>\]\][^]*\[\[\<\-V\]\]/g,""),a="show"==o.hintposition.substr(0,4)?a.replace(/\[\[P\-\>\]\]|\[\[\<\-P\]\]/g,""):a.replace(/\[\[P\-\>\]\][^]*\[\[\<\-P\]\]/g,""),a="show"==o.typehook.substr(0,4)?a.replace(/\[\[H\-\>\]\]|\[\[\<\-H\]\]/g,""):a.replace(/\[\[H\-\>\]\][^]*\[\[\<\-H\]\]/g,""),a="show"==o.default.substr(0,4)?a.replace(/\[\[D\-\>\]\]|\[\[\<\-D\]\]/g,""):a.replace(/\[\[D\-\>\]\][^]*\[\[\<\-D\]\]/g,""),a="show"==o.data.substr(0,4)?a.replace(/\[\[L\-\>\]\]|\[\[\<\-L\]\]/g,""):a.replace(/\[\[L\-\>\]\][^]*\[\[\<\-L\]\]/g,""),a="show"==o.group.substr(0,4)?a.replace(/\[\[G\-\>\]\]|\[\[\<\-G\]\]/g,""):a.replace(/\[\[G\-\>\]\][^]*\[\[\<\-G\]\]/g,""),"show"==o.format.substr(0,4)?a.replace(/\[\[F\-\>\]\]|\[\[\<\-F\]\]/g,""):a.replace(/\[\[F\-\>\]\][^]*\[\[\<\-F\]\]/g,"")}function wfu_userdata_remove_field(e){for(var t=e.parentNode,n=t.parentNode,a=null,o=0;o<n.childNodes.length;o++)if(1===n.childNodes[o].nodeType){a=n.childNodes[o];break}if(t!=a)for(t.parentNode.removeChild(t),o=0;o<a.childNodes.length;o++)if(1===a.childNodes[o].nodeType){wfu_update_userfield_value({target:a.childNodes[o]});break}}function wfu_formdata_remove_field(e){var t=e.split("_")[0],n=document.querySelectorAll("div#wfu_attribute_"+t+" .wfu_formdata_line_container");if(!(n.length<2)){for(var a=document.getElementById("wfu_attribute_"+t),o=document.getElementById("wfu_formfield_"+e+"_container"),r=0,l=0;l<n.length;l++)if(n[l]==o){r=l+1;break}a.removeChild(o),r>(n=document.querySelectorAll("div#wfu_attribute_"+t+" .wfu_formdata_line_container")).length&&(r=n.length),wfu_formdata_update_buttons((o=n[r-1]).id.replace(/^wfu_formfield_/,"").replace(/_container$/,"")),wfu_update_formfield_value({target:o})}}function wfu_formdata_move_field(e,t){for(var n=e.split("_")[0],a=document.querySelector("div#wfu_attribute_"+n+" .wfu_formdata_all_attributes").value.split(","),o=a.indexOf(n)+1,r=document.querySelectorAll("div#wfu_attribute_"+n+" .wfu_formdata_line_container"),l=document.getElementById("wfu_attribute_"+n),s=document.getElementById("wfu_formfield_"+e+"_container"),u=0,d=0;d<r.length;d++)if(r[d]==s){u=d+1;break}if(!("up"==t&&1==o&&1==u||"down"==t&&o==a.length&&u==r.length)){var _,i=wfu_formdata_get_field_props(e),c=n,f=s;"up"==t?u>1?f=r[u-2]:(c=a[o-2],f=(_=document.querySelectorAll("div#wfu_attribute_"+c+" .wfu_formdata_line_container"))[_.length-1]):u<r.length?f=r[u]:(c=a[o],f=(_=document.querySelectorAll("div#wfu_attribute_"+c+" .wfu_formdata_line_container"))[0]);var m=f.id.replace(/^wfu_formfield_/,"").replace(/_container$/,"");if(c==n)"up"==t?l.insertBefore(s,f):l.insertBefore(f,s);else{var p=wfu_formdata_get_field_props(m),w=wfu_formdata_prepare_template(c,i,m);f.innerHTML=w;var v=document.querySelectorAll("div#wfu_formfield_"+m+'_container input[name="wfu_formfield_elements"]');for(d=0;d<v.length;d++)wfu_attach_element_handlers(v[d],wfu_update_formfield_value);for(w=wfu_formdata_prepare_template(n,p,e),s.innerHTML=w,v=document.querySelectorAll("div#wfu_formfield_"+e+'_container input[name="wfu_formfield_elements"]'),d=0;d<v.length;d++)wfu_attach_element_handlers(v[d],wfu_update_formfield_value)}wfu_formdata_update_buttons(e),wfu_formdata_update_buttons(m),wfu_update_formfield_value({target:s}),c!=n&&wfu_update_formfield_value({target:f})}}function wfu_formdata_update_buttons(e){for(var t=e.split("_")[0],n=document.querySelector("div#wfu_attribute_"+t+" .wfu_formdata_all_attributes").value.split(","),a=n.indexOf(t)+1,o=document.querySelectorAll("div#wfu_attribute_"+t+" .wfu_formdata_line_container"),r=document.getElementById("wfu_formfield_"+e+"_container"),l=0,s=0;s<o.length;s++)if(o[s]==r){l=s+1;break}var u=document.querySelector("div#wfu_formfield_"+e+"_container .wfu_formdata_action.wfu_formdata_action_up"),d=document.querySelector("div#wfu_formfield_"+e+"_container .wfu_formdata_action.wfu_formdata_action_down"),_=document.querySelectorAll("div#wfu_attribute_"+t+" .wfu_formdata_action_remove");for(u.className="wfu_formdata_action wfu_formdata_action_up"+(1==a&&1==l?" wfu_formdata_action_disabled":""),d.className="wfu_formdata_action wfu_formdata_action_down"+(a==n.length&&l==o.length?" wfu_formdata_action_disabled":""),s=0;s<_.length;s++)_[s].className="wfu_formdata_action wfu_formdata_action_remove"+(_.length>1?"":" wfu_formdata_action_disabled")}function wfu_formdata_update_all_updown_buttons(e){for(var t=document.querySelector("div#wfu_attribute_"+e+" .wfu_formdata_all_attributes").value.split(","),n=0;n<t.length;n++)for(var a=n+1,o=document.querySelectorAll("div#wfu_attribute_"+t[n]+" .wfu_formdata_line_container"),r=0;r<o.length;r++){var l=r+1,s=o[r].id.replace(/^wfu_formfield_/,"").replace(/_container$/,""),u=document.querySelector("div#wfu_formfield_"+s+"_container .wfu_formdata_action.wfu_formdata_action_up"),d=document.querySelector("div#wfu_formfield_"+s+"_container .wfu_formdata_action.wfu_formdata_action_down");u.className="wfu_formdata_action wfu_formdata_action_up"+(1==a&&1==l?" wfu_formdata_action_disabled":""),d.className="wfu_formdata_action wfu_formdata_action_down"+(a==t.length&&l==o.length?" wfu_formdata_action_disabled":"")}}function wfu_generate_shortcode(){for(var e,t=document.getElementById("wfu_shortcode_tag").value,n=document.getElementById("wfu_attribute_defaults"),a=(document.getElementById("wfu_attribute_values"),""),o="",r="["+t,l="",s=0;s<n.childNodes.length;s++)1===(e=n.childNodes[s]).nodeType&&(a=e.id.replace("wfu_attribute_default_",""),o=document.getElementById("wfu_attribute_value_"+a).value,e.value!=o&&(l+=" "+a+'="'+o+'"'));r+=l+"]",document.getElementById("wfu_shortcode").value=r,ShortcodeString=l.substr(1),document.getElementById("wfu_update_shortcode")&&(document.getElementById("wfu_update_shortcode").disabled=wfu_plugin_encode_string(r)==document.getElementById("wfu_shortcode_original_enc").value),Autosave&&wfu_schedule_save_shortcode()}function wfu_update_text_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_",""),a=t.value;(a=(a=(a=(a=a.replace(/(\r\n|\n|\r)/gm,"%n%")).replace(/\"/gm,"%dq%")).replace(/\[/gm,"%brl%")).replace(/\]/gm,"%brr%"))!==t.oldVal&&(t.oldVal=a,document.getElementById("wfu_attribute_value_"+n).value=a,wfu_generate_shortcode())}function wfu_update_date_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_",""),a=t.value;a!==t.oldVal&&(t.oldVal=a,document.getElementById("wfu_attribute_value_"+n).value=a,wfu_generate_shortcode())}function wfu_update_stringmatch_textvalue(e){var t=(e=e||window.event).target.id.replace("wfu_attribute_","");wfu_update_stringmatch_value(t=t.replace("_matchfield","").replace("_matchvalue",""))}function wfu_update_triplecolor_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_","");n=(n=(n=n.replace("_color","")).replace("_bgcolor","")).replace("_borcolor","");var a=(t=document.getElementById("wfu_attribute_"+n+"_color")).value+","+document.getElementById("wfu_attribute_"+n+"_bgcolor").value+","+document.getElementById("wfu_attribute_"+n+"_borcolor").value;a!==t.oldVal&&(t.oldVal=a,document.getElementById("wfu_attribute_value_"+n).value=a,wfu_generate_shortcode())}function wfu_update_dimension_value(e){var t=(e=e||window.event).target,n=t.name.replace("wfu_dimension_elements_",""),a=document.getElementsByName(t.name);t=a[0];for(var o="",r="",l=0;l<a.length;l++)r=a[l].id.replace("wfu_attribute_"+n+"_",""),""!=o&&""!=a[l].value&&(o+=", "),""!=a[l].value&&(o+=r+":"+a[l].value);o!==t.oldVal&&(t.oldVal=o,document.getElementById("wfu_attribute_value_"+n).value=o,wfu_generate_shortcode())}function wfu_update_ptext_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_","");n=n.substr(2);var a=document.getElementById("wfu_attribute_s_"+n).value+"/"+document.getElementById("wfu_attribute_p_"+n).value;a!==t.oldVal&&(t.oldVal=a,document.getElementById("wfu_attribute_value_"+n).value=a),wfu_generate_shortcode()}function wfu_update_mchecklist_value(e){var t="";document.getElementById("wfu_attribute_"+e),document.getElementById("wfu_attribute_"+e+"_all").checked?(jQuery("#wfu_attribute_"+e+" input").prop("disabled",!0),jQuery("#wfu_attribute_"+e+" input").prop("checked",!0),t="all"):(jQuery("#wfu_attribute_"+e+" input").prop("disabled",!1),jQuery("#wfu_attribute_"+e+" input").each((function(){jQuery(this).prop("checked")&&(t+=","+jQuery(this).next().html())})),t=t.substr(1)),document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_rolelist_value(e){var t="",n=document.getElementById("wfu_attribute_"+e),a=document.getElementById("wfu_attribute_"+e+"_guests");if(document.getElementById("wfu_attribute_"+e+"_all").checked)n.disabled=!0,t="all";else{n.disabled=!1;for(var o=n.options,r=0;r<o.length;r++)o[r].selected&&(""!=t&&(t+=","),t+=o[r].value)}a.checked&&(""!=t&&(t+=","),t+="guests"),document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_userlist_value(e){var t="",n=document.getElementById("wfu_attribute_"+e),a=document.getElementById("wfu_attribute_"+e+"_current"),o=document.getElementById("wfu_attribute_"+e+"_guests"),r=document.getElementById("wfu_attribute_"+e+"_all");if(a&&a.checked)n.disabled=!0,r.disabled=!0,o.disabled=!0,t="current";else{if(r.disabled=!1,o.disabled=!1,r.checked)n.disabled=!0,t="all";else{n.disabled=!1;for(var l=n.options,s=0;s<l.length;s++)l[s].selected&&(""!=t&&(t+=","),t+=l[s].value)}o.checked&&(""!=t&&(t+=","),t+="guests")}document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_postlist_value(e){for(var t="",n=Array(),a=Array(),o=document.getElementById("wfu_attribute_"+e+"_postlist").value.split(","),r=0;r<o.length;r++)n.push(document.getElementById("wfu_attribute_"+e+"_"+o[r])),a.push(document.getElementById("wfu_attribute_"+e+"_all_"+o[r]));var l=document.getElementById("wfu_attribute_"+e+"_current");if(l&&l.checked){for(r=0;r<o.length;r++)n[r].disabled=!0,a[r].disabled=!0;t="current"}else{var s=!0;for(t="",r=0;r<o.length;r++)if(a[r].disabled=!1,a[r].checked)n[r].disabled=!0,""!=t&&(t+=","),t+="all"+o[r];else{n[r].disabled=!1,s=!1;for(var u=n[r].options,d=0;d<u.length;d++)u[d].selected&&(""!=t&&(t+=","),t+=u[d].value)}s&&(t="all")}document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_bloglist_value(e){var t="",n=document.getElementById("wfu_attribute_"+e),a=document.getElementById("wfu_attribute_"+e+"_current"),o=document.getElementById("wfu_attribute_"+e+"_all");if(a&&a.checked)n.disabled=!0,o.disabled=!0,t="current";else if(o.disabled=!1,o.checked)n.disabled=!0,t="all";else{n.disabled=!1;for(var r=n.options,l=0;l<r.length;l++)r[l].selected&&(""!=t&&(t+=","),t+=r[l].value)}document.getElementById("wfu_attribute_value_"+e).value=t,wfu_generate_shortcode()}function wfu_update_stringmatch_value(e){var t=document.getElementById("wfu_attribute_"+e+"_matchfield").value,n=document.getElementById("wfu_attribute_"+e+"_matchcriterion").value,a=document.getElementById("wfu_attribute_"+e+"_matchvalue").value;""==(t=t.replace(";","")).trim()?document.getElementById("wfu_attribute_value_"+e).value="":document.getElementById("wfu_attribute_value_"+e).value="field:"+t+";criterion:"+n+";value:"+a,wfu_generate_shortcode()}function wfu_update_userfield_value(e){for(var t=(e=e||window.event).target,n=t.parentNode,a=n.parentNode,o="",r=!1,l="",s=0;s<a.childNodes.length;s++)if("DIV"===(n=a.childNodes[s]).tagName){for(var u=0;u<n.childNodes.length;u++)"INPUT"==n.childNodes[u].tagName&&("text"==n.childNodes[u].type?(o=n.childNodes[u].value,0==s&&(t=n.childNodes[u])):"checkbox"==n.childNodes[u].type&&(r=n.childNodes[u].checked));""!=l&&""!=o&&(l+="/"),""!=o&&r&&(l+="*"),""!=o&&(l+=o)}l!==t.oldVal&&(t.oldVal=l,document.getElementById("wfu_attribute_value_userdatalabel").value=l,wfu_generate_shortcode(),wfu_update_formfield_variables())}function wfu_update_ftpinfobase_value(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_attribute_",""),a=t.value;t.freezetool=!0;var o=wfu_decode_ftpinfo(a),r=document.getElementById("ftpinfo_username"),l=document.getElementById("ftpinfo_password"),s=document.getElementById("ftpinfo_domain"),u=document.getElementById("ftpinfo_port"),d=document.getElementById("ftpinfo_sftp");o.error?(t.classList.add("ftpinfo_error"),r.classList.add("ftpinfo_error"),l.classList.add("ftpinfo_error"),s.classList.add("ftpinfo_error"),u.classList.add("ftpinfo_error"),d.classList.add("ftpinfo_error")):(t.classList.remove("ftpinfo_error"),r.classList.remove("ftpinfo_error"),l.classList.remove("ftpinfo_error"),s.classList.remove("ftpinfo_error"),u.classList.remove("ftpinfo_error"),d.classList.remove("ftpinfo_error")),r.value=o.data.username,l.value=o.data.password,s.value=o.data.ftpdomain,u.value=o.data.port,d.checked=o.data.sftp,t.freezetool=!1,a!==t.oldVal&&(t.oldVal=a,document.getElementById("wfu_attribute_value_"+n).value=a,wfu_generate_shortcode())}function wfu_update_ftpinfotool_value(e){var t=document.querySelector(".ftpinfo_btn").previousElementSibling;if(!t.freezetool){t.id.replace("wfu_attribute_","");var n=document.getElementById("ftpinfo_username").value,a=document.getElementById("ftpinfo_password").value,o=document.getElementById("ftpinfo_domain").value,r=document.getElementById("ftpinfo_port").value;document.getElementById("ftpinfo_sftp").checked&&(r="s"+r);var l=n.replace(/:/g,"\\\\:").replace(/@/g,"\\\\@");""!=a&&(l+=":"+a.replace(/:/g,"\\\\:").replace(/@/g,"\\\\@")),l+="@"+o,""!=r&&(l+=":"+r),t.value=l,wfu_update_ftpinfobase_value({target:t})}}function wfu_update_formfield_value(e){for(var t=(e=e||window.event).target,n=t.id.match(/^wfu_formfield_(.*?)_/)[1],a=document.querySelectorAll("div#wfu_attribute_"+n+" .wfu_formdata_line_container"),o="",r=0;r<a.length;r++){var l="",s=n+"_"+a[r].id.match(/^wfu_formfield_.*?_(.*?)_/)[1],u=document.getElementById("wfu_formfield_"+s+"_label").value;if(""!=u.trim()){l=u.trim();var d=document.getElementById("wfu_formfield_"+s+"_type").value,_=window["wfu_attribute_"+n+"_typeprops"];l+="|t:"+d,"show"==_[d].labelposition.substr(0,4)&&(l+="|s:"+document.getElementById("wfu_formfield_"+s+"_labelposition").value),"show"==_[d].required.substr(0,4)&&(l+="|r:"+(document.getElementById("wfu_formfield_"+s+"_required").checked?"1":"0")),"show"==_[d].donotautocomplete.substr(0,4)&&(l+="|a:"+(document.getElementById("wfu_formfield_"+s+"_donotautocomplete").checked?"1":"0")),"show"==_[d].validate.substr(0,4)&&(l+="|v:"+(document.getElementById("wfu_formfield_"+s+"_validate").checked?"1":"0")),"show"==_[d].typehook.substr(0,4)&&(l+="|h:"+(document.getElementById("wfu_formfield_"+s+"_typehook").checked?"1":"0")),"show"==_[d].hintposition.substr(0,4)&&(l+="|p:"+document.getElementById("wfu_formfield_"+s+"_hintposition").value),"show"==_[d].default.substr(0,4)&&(l+="|d:"+document.getElementById("wfu_formfield_"+s+"_default").value),"show"==_[d].data.substr(0,4)&&(l+="|l:"+document.getElementById("wfu_formfield_"+s+"_data").value),"show"==_[d].group.substr(0,4)&&(l+="|g:"+document.getElementById("wfu_formfield_"+s+"_group").value),"show"==_[d].format.substr(0,4)&&(l+="|f:"+document.getElementById("wfu_formfield_"+s+"_format").value)}""!=l&&(""!=o&&(o+="/"),o+=l)}o!==t.oldVal&&(t.oldVal=o,document.getElementById("wfu_attribute_value_"+n).value=o,wfu_generate_shortcode(),wfu_update_formfield_variables())}function wfu_update_formfield_variables(){var e=document.getElementById("wfu_attribute_value_userdatalabel");if(e){for(var t=document.querySelectorAll("#wfu_wrapper div.wfu_shadow_userdata"),n=document.getElementsByName("wfu_formfield_select"),a=0;a<n.length;a++)n[a].style.display="none";if(0!=t.length&&"block"!=t[0].style.display){for(var o='<option style="display:none;">%userdataXXX%</option>',r=e.value.replace(/\//g,"[/]").replace(/\(.*?\)/g,(function(e){return e.replace(/\[\/\]/g,"/")})).split("[/]"),l=2;document.getElementById("wfu_attribute_userdatalabel"+l);){var s=document.getElementById("wfu_attribute_value_userdatalabel"+l).value.replace(/\//g,"[/]").replace(/\(.*?\)/g,(function(e){return e.replace(/\[\/\]/g,"/")})).split("[/]");r=r.concat(s),l++}var u="",d=0;for(l=1,a=0;a<r.length;a++)"*"==(u=r[a])[0]&&(u=u.substr(1)),(d=u.indexOf("|"))>-1&&(u=u.substr(0,d)),""!=u.trim()&&(o+='<option value="%userdata'+l+'%">'+l+": "+u.trim()+"</option>",l++);for(a=0;a<n.length;a++)n[a].innerHTML=o,n[a].style.display="inline-block"}}}function wfu_attach_element_handlers(e,t){for(var n=["DOMAttrModified","textInput","input","change","keypress","paste","focus","propertychange"],a=0;a<n.length;a++)wfu_addEventHandler(e,n[a],t)}function wfu_Attach_Admin_Events(e){Autosave=e,wfu_generate_shortcode(),wfu_update_formfield_variables(),wfu_Attach_Admin_DragDrop_Events(),wfu_Attach_Snippet_CSS_Editor();for(var t=document.getElementsByName("wfu_text_elements"),n=0;n<t.length;n++)wfu_attach_element_handlers(t[n],wfu_update_text_value);var a=document.getElementsByName("wfu_ptext_elements");for(n=0;n<a.length;n++)wfu_attach_element_handlers(a[n],wfu_update_ptext_value);var o=document.getElementsByName("wfu_stringmatch_elements");for(n=0;n<o.length;n++)wfu_attach_element_handlers(o[n],wfu_update_stringmatch_textvalue);var r=document.getElementsByName("wfu_triplecolor_elements");for(n=0;n<r.length;n++)wfu_attach_element_handlers(r[n],wfu_update_triplecolor_value);var l=document.getElementsByName("wfu_dimension_elements_widths");for(n=0;n<l.length;n++)wfu_attach_element_handlers(l[n],wfu_update_dimension_value);for(l=document.getElementsByName("wfu_dimension_elements_heights"),n=0;n<l.length;n++)wfu_attach_element_handlers(l[n],wfu_update_dimension_value);var s=document.getElementsByName("wfu_userfield_elements");for(n=0;n<s.length;n++)wfu_attach_element_handlers(s[n],wfu_update_userfield_value);var u=document.getElementsByName("wfu_formfield_elements");for(n=0;n<u.length;n++)wfu_attach_element_handlers(u[n],wfu_update_formfield_value);var d=document.getElementsByName("wfu_ftpinfobase_elements");for(n=0;n<d.length;n++)wfu_attach_element_handlers(d[n],wfu_update_ftpinfobase_value);var _=document.getElementsByName("wfu_ftpinfotool_elements");for(n=0;n<_.length;n++)wfu_attach_element_handlers(_[n],wfu_update_ftpinfotool_value);var i=document.getElementsByName("wfu_subfolder_tools_input");for(n=0;n<i.length;n++)wfu_attach_element_handlers(i[n],wfu_subfolders_input_changed);var c=document.getElementsByName("wfu_columnprops_elements");for(n=0;n<c.length;n++)wfu_attach_element_handlers(c[n],wfu_columnprops_element_changed);""!=document.getElementById("wfu_shortcode_postid").value&&setTimeout((function(){wfu_check_page_obsolescence()}),CheckObsolescenceTimeOut),wfu_install_unload_hook()}function wfu_install_unload_hook(){window.onbeforeunload=wfu_unload_hook}function wfu_unload_hook(){if(!wfu_changes_saved())return 1}function wfu_changes_saved(){return wfu_plugin_encode_string(document.getElementById("wfu_shortcode").value)==document.getElementById("wfu_shortcode_original_enc").value}function wfu_force_save_changes(){document.getElementById("wfu_shortcode").value=wfu_plugin_decode_string(document.getElementById("wfu_shortcode_original_enc").value)}function wfu_Attach_Snippet_CSS_Editor(){for(var e,t,n=document.getElementsByName("wfu_csseditor_elements"),a=0;a<n.length;a++)e=n[a].id.replace("wfu_attribute_",""),(t=CodeMirror.fromTextArea(n[a],{lineNumbers:!0,mode:"css",theme:"default"})).getWrapperElement().id="wfu_attribute_"+e+"_wrapper",t.setSize(null,500),CodeMirror.on(t,"cursorActivity",wfu_css_editor_changed)}function wfu_css_editor_changed(e){var t=e.getTextArea(),n=t.id.replace("wfu_attribute_",""),a=e.doc.getValue("%n%");(a=(a=(a=a.replace(/\"/gm,"%dq%")).replace(/\[/gm,"%brl%")).replace(/\]/gm,"%brr%"))!==t.oldVal&&(t.oldVal=a,document.getElementById("wfu_attribute_value_"+n).value=a),wfu_generate_shortcode()}function wfu_Attach_Snippet_PHP_Editor(){var e,t=document.getElementById("wfu_code");(e=CodeMirror.fromTextArea(t,{lineNumbers:!0,viewportMargin:1/0,matchBrackets:!0,mode:"text/x-php",indentUnit:4,indentWithTabs:!0,theme:"default"})).getWrapperElement().id="wfu_phpeditor_wrapper",e.setSize("90%","auto"),e.refresh()}function wfu_insert_variable(e){var t=e.className.replace("wfu_variable wfu_variable_",""),n=document.getElementById("wfu_attribute_"+t),a=n.selectionStart,o=n.value;n.value=o.substr(0,a)+e.innerHTML+o.substr(a),wfu_update_text_value({target:n})}function wfu_runcustomaction(e){}function wfu_insert_userfield_variable(e){var t=e.className.replace("wfu_variable wfu_variable_",""),n=document.getElementById("wfu_attribute_"+t),a=n.selectionStart,o=n.value;n.value=o.substr(0,a)+e.value+o.substr(a),e.value="%userdataXXX%",wfu_update_text_value({target:n})}function wfu_columns_itemclicked(e,t){var n=e.parentNode;if("SELECT"==n.tagName){for(var a=0;a<n.options.length;a++)n.options[a].selected=n.options[a]==e;wfu_update_column_props(t)}}function wfu_columns_buttonaction(e,t){var n=document.getElementById("wfu_attribute_"+e+"_sourcelist"),a=document.getElementById("wfu_attribute_"+e);if("add"==t){for(var o=0;o<n.options.length;o++)if(n.options[o].selected||"wfu_columns_item_required"==n.options[o].className){for(var r=!1,l=n.options[o].value.replace(/:.*/,""),s=0;s<a.options.length;s++)if(a.options[s].value.replace(/:.*/,"")==l){r=!0;break}if(!r){var u=n.options[o].value.match(/(.*?):(.*?)\/(.*)/),d=u[1],_="custom"==d?"+-"+(""==u[2]?"s":u[2]):""!=u[2]?"-+"+u[2]:"",i=u[3];"custom"==d&&(d="custom1");var c=document.createElement("OPTION");c.value=d+":"+_+"/"+n.options[o].innerHTML+"/"+i,c.innerHTML=n.options[o].innerHTML+(""!=i&&i!=n.options[o].innerHTML?" ("+i+")":""),c.className=n.options[o].className,c.onclick=n.options[o].onclick,a.appendChild(c),a.selectedIndex=a.options.length-1}}}else if("del"==t)for(o=0;o<a.options.length;)a.options[o].selected&&"wfu_columns_item_required"!=a.options[o].className?a.options.remove(o):o++;else if("up"==t||"down"==t){var f=-1;for(o=0;o<a.options.length;o++)a.options[o].selected&&-1==f?f=o:a.options[o].selected&&f>-1&&(a.options[o].selected=!1);"up"==t&&f>0?a.insertBefore(a.options[f],a.options[f-1]):"down"==t&&f<a.options.length-1&&a.insertBefore(a.options[f+1],a.options[f])}wfu_update_column_props(e),wfu_update_columns(e)}function wfu_update_column_props(e){var t=document.getElementById("wfu_attribute_"+e),n=document.getElementById("wfu_attribute_"+e+"_columnprops_container"),a=document.getElementById("wfu_attribute_"+e+"_columnprops_title"),o=(document.getElementById("wfu_attribute_"+e+"_columnprops_title_label"),document.getElementById("wfu_attribute_"+e+"_columnprops_id")),r=document.getElementById("wfu_attribute_"+e+"_columnprops_id_label"),l=document.getElementById("wfu_attribute_"+e+"_columnprops_sort"),s=document.getElementById("wfu_attribute_"+e+"_columnprops_sort_label"),u=document.getElementById("wfu_attribute_"+e+"_columnprops_sorttype"),d=document.getElementById("wfu_attribute_"+e+"_columnprops_sorttype_label"),_=document.getElementById("wfu_attribute_"+e+"_columnprops_defaultsort"),i=document.getElementById("wfu_attribute_"+e+"_columnprops_defaultsort_label"),c=t.selectedIndex;if(""==u.options[0].value&&u.options.remove(0),-1==c)n.className="wfu_columnprops_container wfu_columnprops_container_disabled",a.value="",a.disabled=!0,o.value="",o.disabled=!0,l.checked=!1,l.disabled=!0,u.selectedIndex=-1,u.disabled=!0,_.selectedIndex=-1,_.disabled=!0;else{var f=t.options[c].value.match(/(.*?):(.*?)\/(.*?)\/(.*)/),m=f[1],p="custom"==m.substr(0,6),w=p?m.substr(6):"",v=""!=f[2],g=v&&"+"==f[2].substr(1,1),h=g&&"+"==f[2].substr(0,1),b=g?f[2].substr(2,1):"",y=g?f[2].substr(3,1):"",I=f[4];n.className="wfu_columnprops_container",a.value=I,a.disabled=!1,r.className=p?"":"wfu_columnprops_label_disabled",o.value=w,o.disabled=!p,s.className=v?"":"wfu_columnprops_label_disabled",l.checked=g,l.disabled=!v,d.className=h?"":"wfu_columnprops_label_disabled",u.value=b,u.disabled=!h,i.className=g?"":"wfu_columnprops_label_disabled",_.value=y,_.disabled=!g}}function wfu_columnprops_element_changed(e){var t=(e=e||window.event).target.id.match(/^wfu_attribute_(.*?)_columnprops_/)[1],n=document.getElementById("wfu_attribute_"+t),a=document.getElementById("wfu_attribute_"+t+"_columnprops_title"),o=document.getElementById("wfu_attribute_"+t+"_columnprops_id"),r=document.getElementById("wfu_attribute_"+t+"_columnprops_sort"),l=document.getElementById("wfu_attribute_"+t+"_columnprops_sorttype"),s=document.getElementById("wfu_attribute_"+t+"_columnprops_defaultsort"),u=n.selectedIndex;if(-1!=u){var d=n.options[u].value.match(/(.*?):(.*?)\/(.*?)\/(.*)/),_=d[1],i="custom"==_.substr(0,6)?"custom":_,c="custom"==i?parseInt(o.value)>=1?o.value:"1":"",f=r.checked?""!=s.value?s.value.trim():d[2].substr(3,1):"",m=""!=d[2]?d[2].substr(0,1)+(r.checked?"+":"-")+(""!=l.value?l.value:""!=d[2].substr(2,1)?d[2].substr(2,1):"s")+f:"";if(""!=f){n.options[u].classList.add("wfu_columns_item_defaultsort");for(var p=0;p<n.options.length;p++)p!=u&&(n.options[p].value=n.options[p].value.replace(/(.?:[+-][+-][^\/])([+-])\//,"$1/"),n.options[p].classList.remove("wfu_columns_item_defaultsort"))}else n.options[u].classList.remove("wfu_columns_item_defaultsort");var w=d[3],v=""!=a.value?a.value:w;n.options[u].value=i+c+":"+m+"/"+w+"/"+v,n.options[u].innerHTML=w+(v!=w?" ("+v+")":""),wfu_update_column_props(t),wfu_update_columns(t)}}function wfu_update_columns(e){for(var t=document.getElementById("wfu_attribute_"+e),n="",a=0;a<t.options.length;a++){var o=t.options[a].value.match(/(.*?):(.*?)\/(.*?)\/(.*)/);""!=n&&(n+=","),n+=o[1]+":"+("+"==o[2].substr(1,1)?o[2].substr(2):"")+"/"+o[4]}document.getElementById("wfu_attribute_value_"+e).value=n,wfu_generate_shortcode()}function wfu_GetHttpRequestObject(){var e=null;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}if(null==e&&window.createRequest)try{xmlhttp=window.createRequest()}catch(e){}return e}function wfu_plugin_encode_string(e){var t,n=0,a="",o="";for(n=0;n<e.length;n++)(t=e.charCodeAt(n))>=2048?t=((16773120&t|917504)<<4)+((4032&t|8192)<<2)+(63&t|128):t>=128&&(t=((65472&t|12288)<<2)+(63&t|128)),1!=(o=t.toString(16)).length&&3!=o.length&&5!=o.length||(o="0"+o),a+=o;return a}function wfu_plugin_decode_string(e){for(var t,n,a=0,o="";a<e.length;)n=(t=parseInt(e.substr(a,2),16))<128?t:t<224?((31&t)<<6)+(63&parseInt(e.substr(a+=2,2),16)):((15&t)<<12)+((63&parseInt(e.substr(a+=2,2),16))<<6)+(63&parseInt(e.substr(a+=2,2),16)),o+=String.fromCharCode(n),a+=2;return o}function wfu_decode_array_from_string(e){var t=wfu_plugin_decode_string(e),n=null;try{n=JSON.parse(t)}catch(e){}return n}function wfu_randomString(e){for(var t=e,n="",a=0;a<t;a++){var o=Math.floor(61*Math.random());n+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(o,o+1)}return n}function wfu_schedule_save_shortcode(){var e=new Date,t=ShortcodeNextSave-e.getTime();null!=ShortcodeTimeOut&&(clearTimeout(ShortcodeTimeOut),ShortcodeTimeOut=null),t<=0?wfu_save_shortcode():ShortcodeTimeOut=setTimeout((function(){wfu_save_shortcode()}),t)}function wfu_check_page_obsolescence(){!PageObsolete&&!PageUpdating&&document.getElementById("wfu_shortcode_postid").value}function wfu_save_shortcode(){if(void 0!==window.fromGutenberg)return document.getElementById("wfu_shortcode").value=wfu_plugin_decode_string(document.getElementById("wfu_shortcode_original_enc").value),void window.plugin_window.wfu_save_from_editor(window.blockId);if(!PageObsolete){var e=wfu_GetHttpRequestObject();if(null!=e){PageUpdating=!0,document.getElementById("wfu_update_failed_message").style.display="none";var t=AdminParams.wfu_ajax_url;params=new Array(8),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_save_shortcode",params[1]=new Array(2),params[1][0]="shortcode",params[1][1]=wfu_plugin_encode_string(ShortcodeString),params[2]=new Array(2),params[2][0]="shortcode_original",params[2][1]=document.getElementById("wfu_shortcode_original_enc").value,params[3]=new Array(2),params[3][0]="post_id",params[3][1]=document.getElementById("wfu_shortcode_postid").value,params[4]=new Array(2),params[4][0]="post_hash",params[4][1]=document.getElementById("wfu_shortcode_posthash").value,params[5]=new Array(2),params[5][0]="shortcode_position",params[5][1]=document.getElementById("wfu_shortcode_position").value,params[6]=new Array(2),params[6][0]="shortcode_tag",params[6][1]=document.getElementById("wfu_shortcode_tag").value,params[7]=new Array(2),params[7][0]="widget_id",params[7][1]=document.getElementById("wfu_shortcode_widgetid").value;for(var n="",a=0;a<params.length;a++)n+=(a>0?"&":"")+params[a][0]+"="+encodeURI(params[a][1]);var o=new Date;Autosave?ShortcodeNextSave=o.getTime()+5e3:document.getElementById("wfu_update_shortcode")&&(document.getElementById("wfu_update_shortcode_wait").style.display="inline"),e.open("POST",t,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){PageUpdating=!1;var t=e.responseText.indexOf("wfu_save_shortcode:");-1==t&&(t=e.responseText.length),e.responseText.substr(0,t);var n=e.responseText.substr(t+19,e.responseText.length-t-19);t=n.indexOf(":");var a=n.substr(0,t);if(txt_value=n.substr(t+1,n.length-t-1),"success"==a){if(Autosave?(document.getElementById("wfu_save_label").innerHTML="saved",document.getElementById("wfu_save_label").className="wfu_save_label",document.getElementById("wfu_save_label").style.opacity=1,wfu_fadeout_element(300),ShortcodeNextSave=o.getTime()+1e3,null!=ShortcodeTimeOut&&wfu_schedule_save_shortcode()):document.getElementById("wfu_update_shortcode")&&(document.getElementById("wfu_update_shortcode_wait").style.display="none",document.getElementById("wfu_update_shortcode").disabled=!0,window.plugin_window&&window.plugin_window.location.reload(!0)),""!=document.getElementById("wfu_shortcode_postid").value){var r=document.getElementById("wfu_shortcode_tag").value;document.getElementById("wfu_shortcode_original_enc").value=wfu_plugin_encode_string("["+r+" "+ShortcodeString+"]"),document.getElementById("wfu_shortcode_posthash").value=txt_value,setTimeout((function(){wfu_check_page_obsolescence()}),CheckObsolescenceTimeOut)}}else Autosave&&(document.getElementById("wfu_save_label").innerHTML="not saved",document.getElementById("wfu_save_label").className="wfu_save_label_fail",document.getElementById("wfu_save_label").style.opacity=1,wfu_fadeout_element(300)),"fail"==a&&("post_modified"==txt_value?(PageObsolete=!0,document.getElementById("wfu_update_shortcode")&&(document.getElementById("wfu_update_shortcode").disabled=!0),document.getElementById("wfu_update_rejected_message").style.display="block"):document.getElementById("wfu_update_failed_message").style.display="block")}},e.send(n)}}}function wfu_adjust_opacity(e){document.getElementById("wfu_save_label").style.opacity=e}function wfu_fadeout_element(e){for(var t=0;t<20;t++)setTimeout('wfu_adjust_opacity("'+(1-t/20).toString()+'")',t*e/20);setTimeout('wfu_adjust_opacity("0.0")',t*e/20)}function wfu_apply_value(e,t,n){if("onoff"==t)document.getElementById("wfu_attribute_"+e).className="wfu_onoff_container_"+("true"!=n?"on":"off"),wfu_admin_onoff_clicked(e);else if("text"==t||"ltext"==t||"integer"==t||"float"==t||"mtext"==t||"color"==t||"coloralpha"==t){var a=document.getElementById("wfu_attribute_"+e);if(n=(n=(n=(n=n.replace(/\%n\%/gm,"\n")).replace(/\%dq\%/gm,'"')).replace(/\%brl\%/gm,"[")).replace(/\%brr\%/gm,"]"),"color"==t)(he=colourNameToHex(n))||(he=n),jQuery("#wfu_attribute_"+e).wpColorPicker("color",he);else if("coloralpha"==t){var o=document.getElementById("wfu_attribute_"+e+"_default").value,r=colourToRgba(n);r||(r=o),jQuery("#wfu_attribute_"+e).wpColorPicker("color",r)}a.value=n,wfu_update_text_value({target:a})}else if("date"==t)(a=document.getElementById("wfu_attribute_"+e)).value=n,wfu_update_date_value({target:a});else if("placements"==t)wfu_admin_recreate_placements_panel(n),document.getElementById("wfu_attribute_value_placements").value=n,wfu_generate_shortcode();else if("radio"==t){for(var l=document.getElementsByName("wfu_radioattribute_"+e),s=0;s<l.length;s++)l[s].checked=l[s].value==n||"*"+l[s].value==n;wfu_admin_radio_clicked(e)}else if("ptext"==t){var u=(R=(n=(n=(n=(n=n.replace(/\%n\%/gm,"\n")).replace(/\%dq\%/gm,'"')).replace(/\%brl\%/gm,"[")).replace(/\%brr\%/gm,"]")).split("/")).length<1?"":R[0],d=R.length<2?u:R[1],_=document.getElementById("wfu_attribute_s_"+e);_.value=u;var i=document.getElementById("wfu_attribute_p_"+e);i.value=d,wfu_update_ptext_value({target:_}),wfu_update_ptext_value({target:i})}else if("mchecklist"==t){if("all"==(n=n.toLowerCase()))document.getElementById("wfu_attribute_"+e+"_all").checked=!0;else{document.getElementById("wfu_attribute_"+e+"_all").checked=!1;var c=n.split(",");for(s=0;s<c.length;s++)c[s]=c[s].trim();jQuery("#wfu_attribute_"+e+" input").each((function(){jQuery(this).prop("checked",c.indexOf(jQuery(this).next().html())>-1)}))}wfu_update_mchecklist_value(e)}else if("rolelist"==t){a=document.getElementById("wfu_attribute_"+e);var f=(g=document.getElementById("wfu_attribute_"+e+"_all")).className.indexOf("wfu_default_administrator")>-1,m=n.split(",");if(m.indexOf("all")>-1)for(g.checked=!0,s=0;s<a.options.length;s++)a.options[s].selected=f&&"administrator"==a.options[s].value;else{for(g.checked=!1,s=0;s<m.length;s++)m[s]=m[s].trim();for(s=0;s<a.options.length;s++)a.options[s].selected=m.indexOf(a.options[s].value)>-1}document.getElementById("wfu_attribute_"+e+"_guests").checked=m.indexOf("guests")>-1,wfu_update_rolelist_value(e)}else if("userlist"==t){a=document.getElementById("wfu_attribute_"+e);var p=(g=document.getElementById("wfu_attribute_"+e+"_all")).className.indexOf("wfu_default_0")>-1;if((I=document.getElementById("wfu_attribute_"+e+"_current"))&&"current"==n)for(I.checked=!0,g.checked=!1,document.getElementById("wfu_attribute_"+e+"_guests").checked=!1,s=0;s<a.options.length;s++)a.options[s].selected=p&&s<1;else{I&&(I.checked=!1);var w=n.split(",");if(w.indexOf("all")>-1)for(g.checked=!0,s=0;s<a.options.length;s++)a.options[s].selected=p&&s<1;else{for(g.checked=!1,s=0;s<w.length;s++)w[s]=w[s].trim();for(s=0;s<a.options.length;s++)a.options[s].selected=w.indexOf(a.options[s].value)>-1}document.getElementById("wfu_attribute_"+e+"_guests").checked=w.indexOf("guests")>-1}wfu_update_userlist_value(e)}else if("postlist"==t){var v=Array(),g=Array(),h=document.getElementById("wfu_attribute_"+e+"_postlist").value.split(",");for(s=0;s<h.length;s++)v.push(document.getElementById("wfu_attribute_"+e+"_"+h[s])),g.push(document.getElementById("wfu_attribute_"+e+"_all_"+h[s]));if((I=document.getElementById("wfu_attribute_"+e+"_current"))&&"current"==n)for(I.checked=!0,s=0;s<h.length;s++){g[s].checked=!1;for(var b=0;b<v[s].options.length;b++)v[s].options[b].selected=!1}else{I&&(I.checked=!1);var y=n.split(",");for(s=0;s<h.length;s++)for(("all"==n||y.indexOf("all"+h[s])>-1)&&(g[s].checked=!0),b=0;b<v[s].options.length;b++)v[s].options[b].selected=y.indexOf(v[s].options[b].value)>-1}wfu_update_postlist_value(e)}else if("bloglist"==t){var I;if((I=document.getElementById("wfu_attribute_"+e+"_current"))&&"current"==n)for(I.checked=!0,document.getElementById("wfu_attribute_"+e+"_all").checked=!1,a=document.getElementById("wfu_attribute_"+e),s=0;s<a.options.length;s++)a.options[s].selected=!1;else{I&&(I.checked=!1);var E=n.split(",");if("all"==n)document.getElementById("wfu_attribute_"+e+"_all").checked=!0;else{for(document.getElementById("wfu_attribute_"+e+"_all").checked=!1,s=0;s<E.length;s++)E[s]=E[s].trim();for(a=document.getElementById("wfu_attribute_"+e),s=0;s<a.options.length;s++)a.options[s].selected=E.indexOf(a.options[s].value)>-1}}wfu_update_bloglist_value(e)}else if("stringmatch"==t){var k="",B="equal to",x="",q=n.match(/^field:(.*?);\s*criterion:(.*?)\s*;\s*value:(.*)$/);q&&4==q.length&&(k=q[1],B=q[2],x=q[3]),document.getElementById("wfu_attribute_"+e+"_matchfield").value=k,document.getElementById("wfu_attribute_"+e+"_matchcriterion").value=B,document.getElementById("wfu_attribute_"+e+"_matchvalue").value=x,wfu_update_stringmatch_value(e)}else if("columns"==t){var N=document.getElementById("wfu_attribute_"+e+"_sourcelist"),T=document.getElementById("wfu_attribute_"+e);T.innerHTML="";var L=n.replace(/(:|\/).*?(,|$)/g,"$2").split(",");for(s=0;s<N.options.length;s++){var S=(R=N.options[s].value.match(/(.*?):(.*?)\/(.*)/))[1];if("wfu_columns_item_required"==N.options[s].className&&-1==L.indexOf(S)){var P="custom"==S?"+-"+(""==R[2]?"s":R[2]):""!=R[2]?"-+"+R[2]:"",A=R[3];"custom"==S&&(S="custom1"),(ye=document.createElement("OPTION")).value=S+":"+P+"/"+N.options[s].innerHTML+"/"+A,ye.innerHTML=N.options[s].innerHTML+(""!=A&&A!=N.options[s].innerHTML?" ("+A+")":""),ye.className=N.options[s].className,ye.onclick=N.options[s].onclick,T.appendChild(ye)}}var D=n.split(",");for(s=0;s<D.length;s++){var O=D[s].split("/",2),C=(S=O[0],"");O.length>1&&(C=O[1]),O=S.split(":",2);var H=(S=O[0]).replace(/custom[0-9]+$/,"custom"),M=-1;for(b=0;b<N.options.length;b++)if(N.options[b].value.replace(/:.*/,"")==H){M=b;break}var j=!1;for(b=0;b<T.options.length;b++)if(T.options[b].value.replace(/:.*/,"")==S){j=!0;break}if("custom"!=S&&M>-1&&!j){var R=N.options[M].value.match(/(.*?):(.*?)\/(.*)/),z="custom"==H||""!=R[2],V=(P=R[2],N.options[M].innerHTML),U=A=R[3];U=1==O.length?"custom"==H?"+-s":z?"-+"+P:"":"custom"==H?"+"+(""==O[1]?"-s":"+"+O[1]):z?"-"+(""==O[1]?"-":"+")+P:"",""==C&&(C=A),(ye=document.createElement("OPTION")).value=S+":"+U+"/"+V+"/"+C,ye.innerHTML=V+(A!=V?" ("+A+")":""),ye.className=N.options[M].className,ye.onclick=N.options[s].onclick,T.appendChild(ye)}}wfu_update_column_props(e),wfu_update_columns(e)}else if("dimensions"==t){var F,Q,G=n.split(","),$=document.getElementsByName("wfu_dimension_elements_"+e);for(s=0;s<$.length;s++)$[s].value="";for(s=0;s<G.length;s++)Q=(F=G[s].split(":",2)).length<1?"":F[0],ce=F.length<2?Q:F[1],(a=document.getElementById("wfu_attribute_"+e+"_"+Q.trim()))&&(a.value=ce.trim());wfu_update_dimension_value({target:a=$[0]})}else if("userfields"==t){var J,X=n.replace(/\//g,"[/]").replace(/\(.*?\)/g,(function(e){return e.replace(/\[\/\]/g,"/")})).split("[/]"),W=Array();for(s=0;s<X.length;s++)(J="*"==X[s].substr(0,1))&&(X[s]=X[s].substr(1)),""!=X[s]&&W.push({name:X[s],required:J});var K,Z=document.getElementById("wfu_attribute_"+e),Y=null,ee=Array();for(s=0;s<Z.childNodes.length;s++)1===Z.childNodes[s].nodeType&&(null==Y?Y=Z.childNodes[s]:ee.push(Z.childNodes[s]));for(s=0;s<ee.length;s++)Z.removeChild(ee[s]);wfu_userdata_edit_field(Y,"",!1);var te=Y;for(s=0;s<W.length;s++)0==s?wfu_userdata_edit_field(Y,W[s].name,W[s].required):(wfu_userdata_edit_field(K=te.cloneNode(!0),W[s].name,W[s].required),Z.insertBefore(K,te.nextSibling),te=K);for(s=0;s<Y.childNodes.length&&"INPUT"!=(a=Y.childNodes[s]).tagName;s++);wfu_update_userfield_value({target:a})}else if("formfields"==t){W=Array();var ne=window["wfu_attribute_"+e+"_typeprops"],ae=ne[0].split(","),oe={};for(s=0;s<ae.length;s++){var re=ne[ae[s]];(o={}).type=ae[s],o.label=re.label,o.labelposition=re.labelposition.substr(5),o.required="true"==re.required.substr(5),o.donotautocomplete="true"==re.donotautocomplete.substr(5),o.validate="true"==re.validate.substr(5),o.typehook="true"==re.typehook.substr(5),o.hintposition=re.hintposition.substr(5),o.default=re.default.substr(5),o.data=re.data.substr(5),o.group=re.group.substr(5),o.format=re.format.substr(5),oe[ae[s]]=o}for(X=n.replace(/\//g,"[/]").replace(/\(.*?\)/g,(function(e){return e.replace(/\[\/\]/g,"/")})).split("[/]"),s=0;s<X.length;s++){var le=X[s].trim(),se={};for(prop in oe.text)se[prop]=oe.text[prop];"*"==le.substr(0,1)&&(se.required=!0,le=le.substr(1));var ue=le.split("|");if(""!=ue[0].trim()){var de=-1,_e="";for(b=0;b<ue.length;b++){var ie=(fe=ue[b].replace(/^\s+/gm,"")).substr(0,2),ce=fe.substr(2);if("t:"==ie&&b>0&&ae.indexOf(ce)>-1){_e=ce,de=b;break}}if(""!=_e){for(prop in oe[_e])se[prop]=oe[_e][prop];ue.splice(de,1)}for(se.label=ue[0].trim(),ue.splice(0,1),b=0;b<ue.length;b++){var fe;ie=(fe=ue[b].replace(/^\s+/gm,"")).substr(0,2),ce=fe.substr(2),"s:"==ie?se.labelposition=ce:"r:"==ie?se.required="1"==ce:"a:"==ie?se.donotautocomplete="1"==ce:"v:"==ie?se.validate="1"==ce:"d:"==ie?se.default=ce:"l:"==ie?se.data=ce:"g:"==ie?se.group=ce:"f:"==ie?se.format=ce:"p:"==ie?se.hintposition=ce:"h:"==ie&&(se.typehook="1"==ce)}W.push(se)}}0==W.length&&W.push(fieldprops_default),Z=document.getElementById("wfu_attribute_"+e);var me=document.querySelectorAll("div#wfu_attribute_"+e+" .wfu_formdata_line_container");for(s=1;s<me.length;s++)Z.removeChild(me[s]);var pe=me[0];for(s=0;s<W.length;s++){var we=e+"_"+wfu_randomString(4),ve=wfu_formdata_prepare_template(e,W[s],we);s>0&&(pe=document.createElement("DIV")),pe.id="wfu_formfield_"+we+"_container",pe.className="wfu_formdata_line_container",s>0&&Z.insertBefore(pe,null),pe.innerHTML=ve,wfu_formdata_update_buttons(we)}var ge=document.querySelectorAll("div#wfu_attribute_"+e+' input[name="wfu_formfield_elements"]');for(s=0;s<ge.length;s++)wfu_attach_element_handlers(ge[s],wfu_update_formfield_value);wfu_update_formfield_value({target:me[0]})}else if("color-triplet"==t){var he,be=n.split(",");for(s=0;s<be.length;s++)be[s]=be[s].trim();2==be.length?be=[be[0],be[1],"#000000"]:1==be.length?be=[be[0],"#FFFFFF","#000000"]:be.length<3&&(be=["#000000","#FFFFFF","#000000"]),(he=colourNameToHex(be[0]))||(he=be[0]),jQuery("#wfu_attribute_"+e+"_color").wpColorPicker("color",he),(a=document.getElementById("wfu_attribute_"+e+"_color")).value=be[0],(he=colourNameToHex(be[1]))||(he=be[1]),jQuery("#wfu_attribute_"+e+"_bgcolor").wpColorPicker("color",he),document.getElementById("wfu_attribute_"+e+"_bgcolor").value=be[1],(he=colourNameToHex(be[2]))||(he=be[2]),jQuery("#wfu_attribute_"+e+"_borcolor").wpColorPicker("color",he),document.getElementById("wfu_attribute_"+e+"_borcolor").value=be[2],wfu_update_triplecolor_value({target:a})}else if("ftpinfo"==t)(a=document.getElementById("wfu_attribute_"+e)).value=n,wfu_update_text_value({target:a});else if("folderlist"==t){c=wfu_parse_folderlist_js(n);for(var ye,Ie,Ee,ke,Be,xe,qe=document.getElementById("wfu_attribute_"+e).options;qe.length>0;)qe.remove(0);for(s=0;s<c.path.length;s++){for("/"==(Ie=c.path[s]).substr(Ie.length,1)&&(Ie=Ie.substr(0,Ie.length-1)),Ee=Ie.split("/"),Ie=Ee[Ee.length-1],Be=parseInt(c.level[s]),ke="",xe="",b=0;b<Be;b++)ke+="&nbsp;&nbsp;&nbsp;",xe+="*";ke+=c.label[s],c.default[s]&&(xe+="&"),xe+=""==Ie?"{root}/"+c.label[s]:Ie+c.label[s],ye=document.createElement("option"),c.default[s]?ye.className="wfu_select_folders_option_default":ye.className="",ye.value=wfu_plugin_encode_string(xe),ye.innerHTML=ke,qe.add(ye)}(ye=document.createElement("option")).value="",ye.innerHTML="",qe.add(ye);var Ne=document.getElementById("wfu_attribute_"+e);Ne.data=wfu_decode_subfolder_list(e),wfu_subfolders_update_toolnav(e),n!==(a=Ne).oldVal&&(a.oldVal=n,document.getElementById("wfu_attribute_value_"+e).value=n,wfu_generate_shortcode())}else"csseditor"==t&&(a=document.getElementById("wfu_attribute_"+e+"_wrapper"),n=(n=(n=(n=n.replace(/\%n\%/gm,"\n")).replace(/\%dq\%/gm,'"')).replace(/\%brl\%/gm,"[")).replace(/\%brr\%/gm,"]"),a.CodeMirror.doc.setValue(n))}function wfu_decode_ftpinfo(e){var t={error:!0,data:{username:"",password:"",ftpdomain:"",port:"",sftp:!1}},n=e.replace(/\\\\:/g,"\\\\_").replace(/\\\\@/g,"\\\\_"),a=n.indexOf(":"),o=n.indexOf("@");if(a>-1&&o>-1&&o>a){t.error=!1,t.data.username=e.substr(0,a).replace(/\\\\:/g,":").replace(/\\\\@/g,"@"),t.data.password=e.substr(a+1,o-a-1).replace(/\\\\:/g,":").replace(/\\\\@/g,"@");var r=e.substr(o+1);t.data.ftpdomain=r.replace(/:.*/,""),""==t.data.ftpdomain.trim()&&(t.error=!0),"s"==(l=r.replace(/^[^:]*:?/,"")).substr(0,1)&&(t.data.sftp=!0,l=l.substr(1)),t.data.port=l}else if(o>-1){var l;t.error=!1,t.data.username=e.substr(0,o).replace(/\\\\:/g,":").replace(/\\\\@/g,"@"),r=e.substr(o+1),t.data.ftpdomain=r.replace(/:.*/,""),""==t.data.ftpdomain.trim()&&(t.error=!0),"s"==(l=r.replace(/^[^:]*:?/,"")).substr(0,1)&&(t.data.sftp=!0,l=l.substr(1)),t.data.port=l}else a>-1?(t.error=!0,t.data.username=e.substr(0,a).replace(/\\\\:/g,":").replace(/\\\\@/g,"@"),t.data.password=e.substr(a+1).replace(/\\\\:/g,":").replace(/\\\\@/g,"@")):(t.error=!0,t.data.username=e.replace(/\\\\:/g,":").replace(/\\\\@/g,"@"));return t}function wfu_ftpinfotool_toggle(){var e=document.querySelector(".ftpinfo_btn"),t=document.querySelector(".ftpinfo_tool");t.classList.contains("hidden")?(e.innerHTML="Close",t.classList.remove("hidden")):(e.innerHTML="Edit",t.classList.add("hidden"))}function wfu_parse_folderlist_js(e){var t=Object();if(t.path=Array(),t.label=Array(),t.level=Array(),t.default=Array(),"auto"==e.substr(0,4))return t;var n=e.split(",");if(0==n.length)return t;if(1==n.length&&""==n[0].trim())return t;for(var a,o,r,l,s,u,d=["root"],_=0,i=0,c=-1,f=0;f<n.length;f++){for(a=n[f].trim(),o=0,r=!1;o<a.length&&"*"==a.substr(o,1);)o++;if(o-_<=1&&(o>0||0==i)&&("&"==(a=a.substr(o,a.length-o)).substr(0,1)&&(a=a.substr(1),r=!0),subfolder_items=a.split("/"),subfolder_items.length<2&&subfolder_items.push(""),""!=subfolder_items[1]?(l=subfolder_items[0],s=subfolder_items[1]):(l=a,s=a),""!=l)){r&&-1==c?c=t.path.length:r=!1,0==o&&(i=1),d.length>o?d[o]=l:d.push(l),u="";for(var m=1;m<=o;m++)u+=d[m]+"/";t.path.push(u),t.label.push(s),t.level.push(o),t.default.push(r),_=o}}return t}function colourNameToHex(e){var t={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return void 0!==t[e.toLowerCase()]&&t[e.toLowerCase()]}function colourToRgba(e){var t=function(e){var t=!1,n=e.match(/^#([A-Fa-f0-9]{2})([A-Fa-f0-9]{2})([A-Fa-f0-9]{2})([A-Fa-f0-9]{2})?$/);if(n){var a=null==n[4]?1:(parseInt(n[4],16)/256).toFixed(2);t="rgba("+parseInt(n[1],16)+", "+parseInt(n[2],16)+", "+parseInt(n[3],16)+", "+a+")"}return t},n=!1;if(e.startsWith("rgba("))n=e;else if(e.startsWith("#"))n=t(e);else{var a=colourNameToHex(e);a||(a=value),a.startsWith("#")&&(n=t(a))}return n}function wfu_add_cookies(e){for(var t=0;t<e.length;t++){var n=new Date;n.setTime(n.getTime()+1e3*e[t].expires),document.cookie=e[t].name+"="+e[t].value+"; expires="+n.toUTCString()+"; path=/"}}function wfu_download_file(e,t){var n=wfu_GetHttpRequestObject();if(null!=n){var a="",o=document.getElementById("wfu_download_file_nonce");if(o&&(a=o.value),""!=a){var r=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_download_file_invoker",params[1]=new Array(2),params[1][0]="file",params[1][1]=e,params[2]=new Array(2),params[2][0]="nonce",params[2][1]=a;for(var l="",s=0;s<params.length;s++)l+=(s>0?"&":"")+params[s][0]+"="+encodeURI(params[s][1]);n.open("POST",r,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var a=n.responseText.indexOf("wfu_ajax_action_download_file_invoker:");-1==a&&(a=n.responseText.length),n.responseText.substr(0,a);var o=n.responseText.substr(a+38,n.responseText.length-a-38);a=o.indexOf(":");var r=o.substr(0,a);if(txt_value=o.substr(a+1,o.length-a-1),"wfu_download_id;"==r.substr(0,16)){var l=r.substr(16),s=document.getElementById("wfu_file_download_container_"+t),u=wfu_decode_array_from_string(txt_value);if(u){if(s.innerHTML=u.html,""!=u.js){var d=document.createElement("SCRIPT");d.type="text/javascript",d.text=u.js,s.appendChild(d)}setTimeout("wfu_download_file_monitor('"+e+"', "+t+", '"+l+"')",100)}}}},n.send(l)}}}function wfu_download_file_monitor(e,t,n){var a=wfu_GetHttpRequestObject();if(null!=a){var o=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_download_file_monitor",params[1]=new Array(2),params[1][0]="file",params[1][1]=e,params[2]=new Array(2),params[2][0]="id",params[2][1]=n;for(var r="",l=0;l<params.length;l++)r+=(l>0?"&":"")+params[l][0]+"="+encodeURI(params[l][1]);a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var n=a.responseText.indexOf("wfu_ajax_action_download_file_monitor:");-1==n&&(n=a.responseText.length),a.responseText.substr(0,n);var o=a.responseText.substr(n+38,a.responseText.length-n-38);n=o.indexOf(":");var r=o.substr(0,n);txt_value=o.substr(n+1,o.length-n-1),"repeat"!=r?document.getElementById("wfu_file_download_container_"+t).innerHTML="":"repeat"==r&&setTimeout("wfu_download_file_monitor('"+e+"', "+t+", '"+txt_value+"')",100)}},a.send(r)}}function wfu_filedetails_changed(e){for(var t,n=document.getElementsByName("wfu_filedetails_userdata"),a=!1,o=!1,r=0;r<n.length;r++)if(t=document.getElementById(n[r].id.replace("wfu_filedetails_userdata_value_","wfu_filedetails_userdata_default_")),document.getElementById(n[r].id.replace("wfu_filedetails_userdata_value_","wfu_filedetails_userdata_")).value=n[r].value,n[r].value!=t.value){a=!0;break}document.getElementById("wfu_filedetails_userid")&&(o=document.getElementById("wfu_filedetails_userid").value!=document.getElementById("wfu_filedetails_userid_default").value),document.getElementById("dp_filedetails_submit_fields").disabled=!a&&!o}function wfu_Attach_FileDetails_Admin_Events(){for(var e=document.getElementsByName("wfu_filedetails_userdata"),t=0;t<e.length;t++)wfu_attach_element_handlers(e[t],wfu_filedetails_changed)}function wfu_update_browserpermission_option(e,t,n){var a=document.getElementById("wfu_fbperm_users"),o=document.getElementById("wfu_fbperm_roles"),r=document.getElementById("wfu_fbperm_"+e+"_"+t+"_view"),l=document.getElementById("wfu_fbperm_"+e+"_"+t+"_dl"),s=document.getElementById("wfu_fbperm_"+e+"_"+t+"_edit"),u=document.getElementById("wfu_fbperm_"+e+"_"+t+"_del");if("role"==e){if("0"==t){l.checked=r.checked&&l.checked,s.checked=r.checked&&s.checked,u.checked=r.checked&&u.checked,l.disabled=!r.checked,s.disabled=!r.checked,u.disabled=!r.checked;for(var d=document.querySelectorAll("tr.wfu_fbperm_role_tr"),_=0;_<d.length;_++)wfu_update_browserpermission_option("role",d[_].id.substr(16,d[_].id.length-20),!1);if(n){var i=(r.checked?"v":"")+(l.checked?"d":"")+(s.checked?"e":"")+(u.checked?"l":"");o.value=o.value.replace(/^0\[\w*\]/,"0["+i+"]")}}else if("administrator"!=t){var c=document.getElementById("wfu_fbperm_role_"+t+"_row"),f=document.getElementById("wfu_fbperm_role_"+t+"_def"),m=document.getElementById("wfu_fbperm_role_0_view"),p=document.getElementById("wfu_fbperm_role_0_dl"),w=document.getElementById("wfu_fbperm_role_0_edit"),v=document.getElementById("wfu_fbperm_role_0_del");r.checked=f.checked?m.checked:r.checked,c.style.fontWeight=f.checked?"":"bold",l.checked=f.checked?p.checked:r.checked&&l.checked,s.checked=f.checked?w.checked:r.checked&&s.checked,u.checked=f.checked?v.checked:r.checked&&u.checked,r.disabled=f.checked,l.disabled=f.checked||!r.checked,s.disabled=f.checked||!r.checked,u.disabled=f.checked||!r.checked,n&&(i=f.checked?"":"D"+(r.checked?"v":"")+(l.checked?"d":"")+(s.checked?"e":"")+(u.checked?"l":""),o.value=o.value.replace(new RegExp(","+t+"\\[\\w*\\]"),","+t+"["+i+"]"))}var g=document.querySelectorAll("tr.wfu_fbperm_user_tr");for(_=0;_<g.length;_++)wfu_update_browserpermission_option("user",g[_].id.substr(16,g[_].id.length-20),!1)}else if("user"==e){var h=document.getElementById("wfu_fbperm_user_"+t+"_role");if("0"==t){for(r.checked=!h.checked&&r.checked,l.checked=!h.checked&&r.checked&&l.checked,s.checked=!h.checked&&r.checked&&s.checked,u.checked=!h.checked&&r.checked&&u.checked,r.disabled=h.checked,l.disabled=h.checked||!r.checked,s.disabled=h.checked||!r.checked,u.disabled=h.checked||!r.checked,r.indeterminate=h.checked,l.indeterminate=h.checked,s.indeterminate=h.checked,u.indeterminate=h.checked,g=document.querySelectorAll("tr.wfu_fbperm_user_tr"),_=0;_<g.length;_++)wfu_update_browserpermission_option("user",g[_].id.substr(16,g[_].id.length-20),!1);n&&(i=h.checked?"":"R"+(r.checked?"v":"")+(l.checked?"d":"")+(s.checked?"e":"")+(u.checked?"l":""),a.value=a.value.replace(/^0\[\w*\],?/,""),a.value="0["+i+"]"+(""==a.value?"":","+a.value))}else{var b=document.getElementById("wfu_fbperm_user_"+t+"_roles").value.split(",");if(1==b.length&&""==b[0]&&(b=Array()),b.indexOf("administrator")<0){c=document.getElementById("wfu_fbperm_user_"+t+"_row"),f=document.getElementById("wfu_fbperm_user_"+t+"_def");var y=document.getElementById("wfu_fbperm_user_0_role");if(m=document.getElementById("wfu_fbperm_user_0_view"),p=document.getElementById("wfu_fbperm_user_0_dl"),w=document.getElementById("wfu_fbperm_user_0_edit"),v=document.getElementById("wfu_fbperm_user_0_del"),b.length>0){var I=!1,E=!1,k=!1,B=!1;for(_=0;_<b.length;_++)E=(I=I||document.getElementById("wfu_fbperm_role_"+b[_]+"_view").checked)&&(E||document.getElementById("wfu_fbperm_role_"+b[_]+"_dl").checked),k=I&&(k||document.getElementById("wfu_fbperm_role_"+b[_]+"_edit").checked),B=I&&(B||document.getElementById("wfu_fbperm_role_"+b[_]+"_del").checked)}else I=document.getElementById("wfu_fbperm_role_0_view"),E=document.getElementById("wfu_fbperm_role_0_dl"),k=document.getElementById("wfu_fbperm_role_0_edit"),B=document.getElementById("wfu_fbperm_role_0_del");c.style.fontWeight=f.checked?"":"bold",h.checked=f.checked?y.checked:h.checked,r.checked=f.checked?y.checked?I:m.checked:h.checked?I:r.checked,l.checked=f.checked?y.checked?E:p.checked:h.checked?E:r.checked&&l.checked,s.checked=f.checked?y.checked?k:w.checked:h.checked?k:r.checked&&s.checked,u.checked=f.checked?y.checked?B:v.checked:h.checked?B:r.checked&&u.checked,h.disabled=f.checked,r.disabled=f.checked||h.checked,l.disabled=f.checked||h.checked||!r.checked,s.disabled=f.checked||h.checked||!r.checked,u.disabled=f.checked||h.checked||!r.checked,n&&(i=f.checked?"":"D"+(h.checked?"":"R"+(r.checked?"v":"")+(l.checked?"d":"")+(s.checked?"e":"")+(u.checked?"l":"")),a.value=a.value.replace(new RegExp(","+t+"\\[\\w*\\]|"+t+"\\[\\w*\\],|"+t+"\\[\\w*\\]"),""),a.value+=(""==a.value?"":",")+t+"["+i+"]")}}}}function wfu_goto_historylog_page(e,t){var n=document.getElementById("wfu_historylog_pages"),a=n.selectedIndex+1,o=a;if("next"==t?o=Math.min(a+1,n.options.length):"prev"==t?o=Math.max(a-1,1):"last"==t?o=n.options.length:"first"==t?o=1:"sel"==t&&(a=-1),o!=a){var r=wfu_GetHttpRequestObject();if(null!=r){var l=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_historylog_page",params[1]=new Array(2),params[1][0]="token",params[1][1]=e,params[2]=new Array(2),params[2][0]="page",params[2][1]=o;for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);document.getElementById("wfu_historylog_overlay").style.display="block",r.open("POST",l,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){document.getElementById("wfu_historylog_overlay").style.display="none";var e=r.responseText.indexOf("wfu_historylog_page_success:");-1==e&&(e=r.responseText.length),r.responseText.substr(0,e);var t=r.responseText.substr(e+28,r.responseText.length-e-28);""!=t&&(document.getElementById("wfu_historylog_table").tBodies[0].innerHTML=wfu_plugin_decode_string(t),n.selectedIndex=o-1,document.getElementById("wfu_historylog_first_disabled").style.display=1==o?"inline":"none",document.getElementById("wfu_historylog_prev_disabled").style.display=1==o?"inline":"none",document.getElementById("wfu_historylog_first").style.display=1==o?"none":"inline",document.getElementById("wfu_historylog_prev").style.display=1==o?"none":"inline",document.getElementById("wfu_historylog_last_disabled").style.display=o==n.options.length?"inline":"none",document.getElementById("wfu_historylog_next_disabled").style.display=o==n.options.length?"inline":"none",document.getElementById("wfu_historylog_last").style.display=o==n.options.length?"none":"inline",document.getElementById("wfu_historylog_next").style.display=o==n.options.length?"none":"inline")}},r.send(s)}}}function wfu_attach_uploadedfiles_events(){function e(e){var t=e.id.replace(/^p_([0-9]+)_[0-9]+$/,"$1");document.querySelector("tr.wfu_row-"+t+" .wfu-remarks-container").innerHTML=wfu_plugin_decode_string(e.firstChild.value)}function t(e){var t=e.id.replace(/^p_([0-9]+)_[0-9]+$/,"$1");e.classList.remove("wfu-clicked"),document.querySelector("tr.wfu_row-"+t+" .wfu-remarks-container").innerHTML=""}window.wfu_last_shown_remark=null;for(var n=document.querySelectorAll(".wfu-properties:not(.wfu-dashicons-hidden)"),a=0;a<n.length;a++)void 0!==n[a].hashover&&1==n[a].hashover||(jQuery(n[a]).hover((function(){window.wfu_last_shown_remark&&t(window.wfu_last_shown_remark),e(this),window.wfu_last_shown_remark=this}),(function(){window.wfu_last_shown_remark&&t(window.wfu_last_shown_remark),t(this),window.wfu_last_shown_remark=null})),jQuery(n[a]).click((function(){window.wfu_last_shown_remark&&t(window.wfu_last_shown_remark),e(this),this.classList.add("wfu-clicked"),window.wfu_last_shown_remark=this})),this.hashover=!0)}function wfu_update_uploadedfiles_bubble(e){var t=document.querySelector("#toplevel_page_wfu_uploaded_files .update-plugins"),n=document.querySelector("#toplevel_page_wfu_uploaded_files .plugin-count");if(t&&n){t.className="update-plugins count-"+e;var a=e;e>99&&(a="99+"),n.innerHTML=a}}function wfu_goto_uploadedfiles_page(e,t){var n=document.getElementById("wfu_uploadedfiles_pages"),a=n.selectedIndex+1,o=a;if("next"==t?o=Math.min(a+1,n.options.length):"prev"==t?o=Math.max(a-1,1):"last"==t?o=n.options.length:"first"==t?o=1:"sel"==t&&(a=-1),o!=a){var r=wfu_GetHttpRequestObject();if(null!=r){var l=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_uploadedfiles_page",params[1]=new Array(2),params[1][0]="token",params[1][1]=e,params[2]=new Array(2),params[2][0]="page",params[2][1]=o;for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);document.getElementById("wfu_uploadedfiles_overlay").style.display="block",r.open("POST",l,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){document.getElementById("wfu_uploadedfiles_overlay").style.display="none";var e=r.responseText.indexOf("wfu_uploadedfiles_page_success:");-1==e&&(e=r.responseText.length),r.responseText.substr(0,e);var t=r.responseText.substr(e+31,r.responseText.length-e-31);if(""!=t){var a=document.getElementById("wfu_uploadedfiles_table"),l=wfu_plugin_decode_string(t),s=0,u=l.match(/wfu_uploadedfiles_unread\[(.*?)\]/);u&&u[1]&&(s=parseInt(u[1])),isNaN(s)&&(s=0),a.tBodies[0].innerHTML=l,n.selectedIndex=o-1,document.getElementById("wfu_uploadedfiles_first_disabled").style.display=1==o?"inline":"none",document.getElementById("wfu_uploadedfiles_prev_disabled").style.display=1==o?"inline":"none",document.getElementById("wfu_uploadedfiles_first").style.display=1==o?"none":"inline",document.getElementById("wfu_uploadedfiles_prev").style.display=1==o?"none":"inline",document.getElementById("wfu_uploadedfiles_last_disabled").style.display=o==n.options.length?"inline":"none",document.getElementById("wfu_uploadedfiles_next_disabled").style.display=o==n.options.length?"inline":"none",document.getElementById("wfu_uploadedfiles_last").style.display=o==n.options.length?"none":"inline",document.getElementById("wfu_uploadedfiles_next").style.display=o==n.options.length?"none":"inline",wfu_attach_uploadedfiles_events(),wfu_update_uploadedfiles_bubble(s)}}},r.send(s)}}}function wfu_include_file(e,t){var n=wfu_GetHttpRequestObject();if(null!=n){var a="",o=document.getElementById("wfu_include_file_nonce");if(o&&(a=o.value),""!=a){var r=AdminParams.wfu_ajax_url;params=new Array(2),params[0]=new Array(3),params[0][0]="action",params[0][1]="wfu_ajax_action_include_file",params[1]=new Array(2),params[1][0]="file",params[1][1]=e,params[2]=new Array(2),params[2][0]="nonce",params[2][1]=a;for(var l="",s=0;s<params.length;s++)l+=(s>0?"&":"")+params[s][0]+"="+encodeURI(params[s][1]);document.getElementById("wfu_include_file_"+t+"_a").href="javascript: void(0)",document.getElementById("wfu_include_file_"+t+"_img").style.display="inline",n.open("POST",r,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&(document.getElementById("wfu_include_file_"+t+"_img").style.display="none",200==n.status)){var e=n.responseText.indexOf("wfu_include_file:");-1==e&&(e=n.responseText.length),n.responseText.substr(0,e);var a=n.responseText.substr(e+17,n.responseText.length-e-17);e=a.indexOf(":");var o=a.substr(0,e);txt_value=a.substr(e+1,a.length-e-1),"success"==o?(document.getElementById("wfu_file_flat_"+t).style.display="none",document.getElementById("wfu_file_link_"+t).style.display="inline",document.getElementById("wfu_file_can_be_included_actions_"+t).style.display="none",document.getElementById("wfu_file_is_included_actions_"+t).style.display="block"):document.getElementById("wfu_include_file_"+t+"_a").innerHTML=document.getElementById("wfu_include_file_"+t+"_inpfail").value}},n.send(l)}}}function wfu_adminbrowser_select_all_visible_changed(){for(var e=document.getElementById("wfu_select_all_visible").checked,t=document.querySelectorAll(".wfu_selectors"),n=0;n<t.length;n++)t[n].checked=e}function wfu_adminbrowser_selector_changed(e){var t=document.querySelectorAll(".wfu_selectors").length,n=document.querySelectorAll(".wfu_selectors:checked").length,a=document.getElementById("wfu_select_all_visible");a.style.webkitAppearance="",a.style.webkitAppearance="checkbox",a.checked=n>0,a.indeterminate=n>0&&n<t}function wfu_apply_bulkaction_select(e){void 0!==window["wfu_apply_"+e+"_bulkselect"]&&window["wfu_apply_"+e+"_bulkselect"]()}function wfu_apply_adminbrowser_bulkaction(){var e=document.getElementById("wfu_adminbrowser_bulkactions");if(!(e.selectedIndex<1)){var t=e.options[e.selectedIndex].value,n=document.querySelectorAll(".wfu_selectors:checked");if(0!=n.length){for(var a=[],o=0,r=0,l=0;l<n.length;l++){var s=n[l].className.replace(/.*?wfu_selcode_/,"");if(""!=s){var u=n[l].className.indexOf("wfu_included")>-1;u?o++:r++,"delete"==t&&!u||"include"==t&&u?n[l].checked=!1:a.push(s)}}if("move"==t&&r>0?alert("Notice! Files that were not uploaded using the plugin cannot be moved and have been deselected."):"delete"==t&&r>0?alert("Notice! Files that were not uploaded using the plugin cannot be deleted and have been deselected."):"include"==t&&o>0&&alert("Notice! Files already included in the plugin have been deselected."),0!=a.length){var d=document.getElementById("wfu_adminbrowser_action_url").value,_=document.getElementById("wfu_adminbrowser_referer").value;if("move"==t||"delete"==t||"include"==t){var i=document.createElement("FORM");i.method="POST",i.action=d,i.style.display="none";var c=document.createElement("INPUT");c.type="hidden",c.name="action",c.value=t+"_file",i.appendChild(c);var f=document.createElement("INPUT");f.type="hidden",f.name="file",f.value="list:"+a.join(),i.appendChild(f);var m=document.createElement("INPUT");m.type="hidden",m.name="referer",m.value=_,i.appendChild(m),document.body.appendChild(i),i.submit()}}}}}function wfu_goto_adminbrowser_page(e,t){var n=document.getElementById("wfu_adminbrowser_pages"),a=n.selectedIndex+1,o=a;if("next"==t?o=Math.min(a+1,n.options.length):"prev"==t?o=Math.max(a-1,1):"last"==t?o=n.options.length:"first"==t?o=1:"sel"==t&&(a=-1),o!=a){var r=wfu_GetHttpRequestObject();if(null!=r){var l=AdminParams.wfu_ajax_url;params=new Array(4),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_adminbrowser_page",params[1]=new Array(2),params[1][0]="code",params[1][1]=document.getElementById("wfu_adminbrowser_code").value,params[2]=new Array(2),params[2][0]="token",params[2][1]=e,params[3]=new Array(2),params[3][0]="page",params[3][1]=o;for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);document.getElementById("wfu_adminbrowser_overlay").style.display="block",r.open("POST",l,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){document.getElementById("wfu_adminbrowser_overlay").style.display="none";var e=r.responseText.indexOf("wfu_adminbrowser_page_success:");-1==e&&(e=r.responseText.length),r.responseText.substr(0,e);var t=r.responseText.substr(e+30,r.responseText.length-e-30);""!=t&&(t=wfu_plugin_decode_string(t),document.getElementById("wfu_adminbrowser_table").tBodies[0].innerHTML=t,document.getElementById("wfu_select_all_visible").checked=!1,wfu_adminbrowser_select_all_visible_changed(),n.selectedIndex=o-1,document.getElementById("wfu_adminbrowser_first_disabled").style.display=1==o?"inline":"none",document.getElementById("wfu_adminbrowser_prev_disabled").style.display=1==o?"inline":"none",document.getElementById("wfu_adminbrowser_first").style.display=1==o?"none":"inline",document.getElementById("wfu_adminbrowser_prev").style.display=1==o?"none":"inline",document.getElementById("wfu_adminbrowser_last_disabled").style.display=o==n.options.length?"inline":"none",document.getElementById("wfu_adminbrowser_next_disabled").style.display=o==n.options.length?"inline":"none",document.getElementById("wfu_adminbrowser_last").style.display=o==n.options.length?"none":"inline",document.getElementById("wfu_adminbrowser_next").style.display=o==n.options.length?"none":"inline")}},r.send(s)}}}function wfu_focus_table_on_highlighted_file(e){var t=document.querySelector("#"+e+" tr.wfu-highlighted");if(t){var n=document.getElementById("wpadminbar");n&&(n=jQuery(n).is(":visible")?n:null),jQuery("html, body").animate({scrollTop:jQuery(t).offset().top-(n?jQuery(n).height():0)+"px"},"fast")}}function wfu_filebrowser_select_all_visible_changed(){for(var e=document.getElementById("wfu_select_all_visible").checked,t=document.querySelectorAll(".wfu_selectors"),n=0;n<t.length;n++)t[n].checked=e,wfu_filebrowser_store_selector(t[n])}function wfu_filebrowser_store_selector(e){"undefined"==typeof wfu_filebrowser_selected&&(wfu_filebrowser_selected=[]);var t=e.name,n=wfu_filebrowser_selected.indexOf(t);e.checked&&-1==n?wfu_filebrowser_selected.push(t):!e.checked&&n>-1&&wfu_filebrowser_selected.splice(n,1)}function wfu_update_selector_status(){if("undefined"!=typeof wfu_filebrowser_selected){for(var e,t=document.querySelectorAll(".wfu_selectors"),n=0;n<t.length;n++)e=t[n].name,t[n].checked=wfu_filebrowser_selected.indexOf(e)>-1;t[0]&&wfu_filebrowser_selector_changed(t[0])}}function wfu_filebrowser_selector_changed(e){var t=document.querySelectorAll(".wfu_selectors").length,n=document.querySelectorAll(".wfu_selectors:checked").length,a=document.getElementById("wfu_select_all_visible");a.style.webkitAppearance="",a.style.webkitAppearance="checkbox",a.checked=n>0,a.indeterminate=n>0&&n<t,wfu_filebrowser_store_selector(e)}function wfu_apply_filebrowser_bulkselect(){var e=document.getElementById("wfu_filebrowser_bulkactions");if(!(e.selectedIndex<1)){var t=document.querySelectorAll(".wfu_selectors:checked");if(0!=t.length)for(var n=e.options[e.selectedIndex].value,a=0;a<t.length;a++){var o="remote_"==t[a].className.replace(/.*?wfu_selcode_/,"").substr(0,7);("delete"==n&&o||"remove_remote"==n&&!o)&&(t[a].checked=!1,wfu_filebrowser_selector_changed(t[a]))}}}function wfu_apply_filebrowser_bulkaction(){var e=document.getElementById("wfu_filebrowser_bulkactions");if(!(e.selectedIndex<1)){wfu_apply_filebrowser_bulkselect();var t=document.querySelectorAll(".wfu_selectors:checked");if(0!=t.length){codes=[];for(var n=0;n<t.length;n++){var a=t[n].className.replace(/.*?wfu_selcode_/,"").replace("remote_","remote:");""!=a&&codes.push(a)}var o=document.getElementById("wfu_filebrowser_action_url").value,r=document.getElementById("wfu_filebrowser_referer").value,l=e.options[e.selectedIndex].value;if("delete"==l||"remove_remote"==l){var s=document.createElement("FORM");s.method="POST",s.action=o,s.style.display="none";var u=document.createElement("INPUT");u.type="hidden",u.name="action",u.value="delete"==l?"delete_file":"remove_remfile",s.appendChild(u);var d=document.createElement("INPUT");d.type="hidden",d.name="file",d.value="list:"+codes.join(),s.appendChild(d);var _=document.createElement("INPUT");_.type="hidden",_.name="referer",_.value=r,s.appendChild(_),document.body.appendChild(s),s.submit()}}}}function wfu_apply_remotefiles_bulkaction(){var e=document.getElementById("wfu_remotefiles_bulkactions");if(!(e.selectedIndex<1)){var t=document.querySelectorAll(".wfu_selectors:checked");if(0!=t.length){codes=[];for(var n=0;n<t.length;n++){var a=t[n].className.replace(/.*?wfu_selcode_/,"");""!=a&&codes.push(a)}var o=document.getElementById("wfu_remotefiles_action_url").value,r=document.getElementById("wfu_remotefiles_referer").value,l=document.getElementById("wfu_remotefiles_nonce").value;if("unlink"==e.options[e.selectedIndex].value){var s=document.createElement("FORM");s.method="POST",s.action=o,s.style.display="none";var u=document.createElement("INPUT");u.type="hidden",u.name="action",u.value="unlink_remotefile",s.appendChild(u);var d=document.createElement("INPUT");d.type="hidden",d.name="file",d.value="list:"+codes.join(),s.appendChild(d);var _=document.createElement("INPUT");_.type="hidden",_.name="referer",_.value=r,s.appendChild(_);var i=document.createElement("INPUT");i.type="hidden",i.name="nonce",i.value=l,s.appendChild(i),document.body.appendChild(s),s.submit()}}}}function wfu_filter_check_changed(e){var t=document.querySelectorAll('.wfu-filters .subsubsub li:not(.all) input[type="checkbox"]'),n=document.querySelector('.wfu-filters .subsubsub li.all input[type="checkbox"]');if("all"==e.parentElement.className)for(var a=0;a<t.length;a++)t[a].checked=e.checked;else{var o=!0;for(a=0;a<t.length;a++)if(!t[a].checked){o=!1;break}n.checked=o}}function wfu_apply_remotefiles_filter(){var e=document.querySelectorAll('.wfu-filters .subsubsub li:not(.all) input[type="checkbox"]'),t="";if(!document.querySelector('.wfu-filters .subsubsub li.all input[type="checkbox"]').checked)for(var n=0;n<e.length;n++)e[n].checked&&(t+=(""==t?"":"_")+e[n].parentElement.className);var a=document.getElementById("wfu_remotefiles_action_url").value;a+="&action=remote_files",""!=t&&(a+="&filter="+t);var o=document.createElement("FORM");o.method="POST",o.action=a,o.style.display="none",document.body.appendChild(o),o.submit()}function wfu_goto_remotefiles_page(e,t){var n=document.getElementById("wfu_remotefiles_pages"),a=n.selectedIndex+1,o=document.getElementById("wfu_remotefiles_cursort").value,r=document.getElementById("wfu_remotefiles_filter").value,l=a,s=o;if("next"==t?l=Math.min(a+1,n.options.length):"prev"==t?l=Math.max(a-1,1):"last"==t?l=n.options.length:"first"==t?l=1:"sel"==t?a=-1:"sort:"==t.substr(0,5)&&(s=t.substr(5)),l!=a||s!=o){var u=wfu_GetHttpRequestObject();if(null!=u){var d=AdminParams.wfu_ajax_url;params=new Array(4),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_remotefiles_page",params[1]=new Array(2),params[1][0]="token",params[1][1]=e,params[2]=new Array(2),params[2][0]="page",params[2][1]=l,params[3]=new Array(2),params[3][0]="sort",params[3][1]=s,params[4]=new Array(2),params[4][0]="filter",params[4][1]=r;for(var _="",i=0;i<params.length;i++)_+=(i>0?"&":"")+params[i][0]+"="+encodeURI(params[i][1]);document.getElementById("wfu_remotefiles_overlay").style.display="block",u.open("POST",d,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.onreadystatechange=function(){if(4==u.readyState&&200==u.status){document.getElementById("wfu_remotefiles_overlay").style.display="none";var e=u.responseText.indexOf("wfu_remotefiles_page_success:");-1==e&&(e=u.responseText.length),u.responseText.substr(0,e);var t=u.responseText.substr(e+29,u.responseText.length-e-29);if(""!=t){t=wfu_plugin_decode_string(t);var a=document.getElementById("wfu_remotefiles_referer"),o=t.match(/wfu_remotefiles_referer\[(.*?)\]/);o&&o[1]&&(a.value=o[1]),document.getElementById("wfu_remotefiles_table").tBodies[0].innerHTML=t,wfu_update_selector_status(),n.selectedIndex=l-1,document.getElementById("wfu_remotefiles_cursort").value=s,document.getElementById("wfu_remotefiles_first_disabled").style.display=1==l?"inline":"none",document.getElementById("wfu_remotefiles_prev_disabled").style.display=1==l?"inline":"none",document.getElementById("wfu_remotefiles_first").style.display=1==l?"none":"inline",document.getElementById("wfu_remotefiles_prev").style.display=1==l?"none":"inline",document.getElementById("wfu_remotefiles_last_disabled").style.display=l==n.options.length?"inline":"none",document.getElementById("wfu_remotefiles_next_disabled").style.display=l==n.options.length?"inline":"none",document.getElementById("wfu_remotefiles_last").style.display=l==n.options.length?"none":"inline",document.getElementById("wfu_remotefiles_next").style.display=l==n.options.length?"none":"inline";var r=1;"-"==s.substr(0,1)&&(r=-1,s=s.substr(1));for(var d=document.querySelectorAll("table#wfu_remotefiles_table th a"),_=0;_<d.length;_++){var i=d[_].href.match(/'sort:(.*?)'/);i[1]&&(i=i[1].substr(i[1].length-4,4));var c=s==i&&1==r?"-"+i:i;d[_].href=d[_].href.replace(/'sort:.*?'/,"'sort:"+c+"'"),d[_].innerHTML=d[_].innerHTML.replace("","").replace("",""),d[_].innerHTML+=s==i?1==r?"&uarr;":"&darr;":""}}}},u.send(_)}}}function wfu_goto_userpermissions_page(e,t){var n=document.getElementById("wfu_userpermissions_pages"),a=n.selectedIndex+1,o=a;if("next"==t?o=Math.min(a+1,n.options.length):"prev"==t?o=Math.max(a-1,1):"last"==t?o=n.options.length:"first"==t?o=1:"sel"==t&&(a=-1),o!=a){var r=wfu_GetHttpRequestObject();if(null!=r){var l=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_userpermissions_page",params[1]=new Array(2),params[1][0]="token",params[1][1]=e,params[2]=new Array(2),params[2][0]="page",params[2][1]=o;for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);document.getElementById("wfu_userpermissions_overlay").style.display="block",r.open("POST",l,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){document.getElementById("wfu_userpermissions_overlay").style.display="none";var e=r.responseText.indexOf("wfu_userpermissions_page_success:");-1==e&&(e=r.responseText.length),r.responseText.substr(0,e);var t=r.responseText.substr(e+33,r.responseText.length-e-33);if(""!=t){document.getElementById("wfu_userpermissions_table").tBodies[0].innerHTML=wfu_plugin_decode_string(t),n.selectedIndex=o-1,document.getElementById("wfu_userpermissions_first_disabled").style.display=1==o?"inline":"none",document.getElementById("wfu_userpermissions_prev_disabled").style.display=1==o?"inline":"none",document.getElementById("wfu_userpermissions_first").style.display=1==o?"none":"inline",document.getElementById("wfu_userpermissions_prev").style.display=1==o?"none":"inline",document.getElementById("wfu_userpermissions_last_disabled").style.display=o==n.options.length?"inline":"none",document.getElementById("wfu_userpermissions_next_disabled").style.display=o==n.options.length?"inline":"none",document.getElementById("wfu_userpermissions_last").style.display=o==n.options.length?"none":"inline",document.getElementById("wfu_userpermissions_next").style.display=o==n.options.length?"none":"inline";var a=document.getElementById("wfu_fbperm_users").value,l=a.match(/^0\[(\w*)\]/);l&&l[1]&&(l=l[1],document.getElementById("wfu_fbperm_user_0_role").checked=""==l,document.getElementById("wfu_fbperm_user_0_view").checked=l.indexOf("v")>-1,document.getElementById("wfu_fbperm_user_0_dl").checked=l.indexOf("d")>-1,document.getElementById("wfu_fbperm_user_0_edit").checked=l.indexOf("e")>-1,document.getElementById("wfu_fbperm_user_0_del").checked=l.indexOf("l")>-1),wfu_update_browserpermission_option("user","0",!1);for(var s=document.querySelectorAll("tr.wfu_fbperm_user_tr"),u=0;u<s.length;u++){var d=s[u].id.substr(16,s[u].id.length-20),_=a.match(new RegExp("(^|,)"+d+"\\[(\\w*)\\]"));_&&_[2]&&(_=_[2],document.getElementById("wfu_fbperm_user_"+d+"_def").checked=""==_,document.getElementById("wfu_fbperm_user_"+d+"_role").checked="D"==_,document.getElementById("wfu_fbperm_user_"+d+"_view").checked=_.indexOf("v")>-1,document.getElementById("wfu_fbperm_user_"+d+"_dl").checked=_.indexOf("d")>-1,document.getElementById("wfu_fbperm_user_"+d+"_edit").checked=_.indexOf("e")>-1,document.getElementById("wfu_fbperm_user_"+d+"_del").checked=_.indexOf("l")>-1),wfu_update_browserpermission_option("user",d,!1)}}}},r.send(s)}}}function wfu_goto_filebrowser_page(e,t){var n=document.getElementById("wfu_filebrowser_pages"),a=n.selectedIndex+1,o=document.getElementById("wfu_filebrowser_cursort").value,r=a,l=o;if("next"==t?r=Math.min(a+1,n.options.length):"prev"==t?r=Math.max(a-1,1):"last"==t?r=n.options.length:"first"==t?r=1:"sel"==t?a=-1:"sort:"==t.substr(0,5)&&(l=t.substr(5)),r!=a||l!=o){var s=wfu_GetHttpRequestObject();if(null!=s){var u=AdminParams.wfu_ajax_url;params=new Array(4),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_filebrowser_page",params[1]=new Array(2),params[1][0]="token",params[1][1]=e,params[2]=new Array(2),params[2][0]="page",params[2][1]=r,params[3]=new Array(2),params[3][0]="sort",params[3][1]=l;for(var d="",_=0;_<params.length;_++)d+=(_>0?"&":"")+params[_][0]+"="+encodeURI(params[_][1]);document.getElementById("wfu_filebrowser_overlay").style.display="block",s.open("POST",u,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){document.getElementById("wfu_filebrowser_overlay").style.display="none";var e=s.responseText.indexOf("wfu_filebrowser_page_success:");-1==e&&(e=s.responseText.length),s.responseText.substr(0,e);var t=s.responseText.substr(e+29,s.responseText.length-e-29);if(""!=t){t=wfu_plugin_decode_string(t);var a=document.getElementById("wfu_filebrowser_referer"),o=t.match(/wfu_filebrowser_referer\[(.*?)\]/);o&&o[1]&&(a.value=o[1]),document.getElementById("wfu_filebrowser_table").tBodies[0].innerHTML=t,wfu_update_selector_status(),n.selectedIndex=r-1,document.getElementById("wfu_filebrowser_cursort").value=l,document.getElementById("wfu_filebrowser_first_disabled").style.display=1==r?"inline":"none",document.getElementById("wfu_filebrowser_prev_disabled").style.display=1==r?"inline":"none",document.getElementById("wfu_filebrowser_first").style.display=1==r?"none":"inline",document.getElementById("wfu_filebrowser_prev").style.display=1==r?"none":"inline",document.getElementById("wfu_filebrowser_last_disabled").style.display=r==n.options.length?"inline":"none",document.getElementById("wfu_filebrowser_next_disabled").style.display=r==n.options.length?"inline":"none",document.getElementById("wfu_filebrowser_last").style.display=r==n.options.length?"none":"inline",document.getElementById("wfu_filebrowser_next").style.display=r==n.options.length?"none":"inline";var u=1;"-"==l.substr(0,1)&&(u=-1,l=l.substr(1));for(var d=document.querySelectorAll("table#wfu_filebrowser_table th a"),_=0;_<d.length;_++){var i=d[_].href.match(/'sort:(.*?)'/);i[1]&&(i=i[1].substr(i[1].length-4,4));var c=l==i&&1==u?"-"+i:i;d[_].href=d[_].href.replace(/'sort:.*?'/,"'sort:"+c+"'"),d[_].innerHTML=d[_].innerHTML.replace("","").replace("",""),d[_].innerHTML+=l==i?1==u?"&uarr;":"&darr;":""}}}},s.send(d)}}}function wfu_get_hook_code_from_template(){if("-1"!=document.getElementById("wfu_templates").value){var e=wfu_GetHttpRequestObject();if(null!=e){var t=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_get_hook_code_from_template",params[1]=new Array(2),params[1][0]="token",params[1][1]=document.getElementById("_wpnonce").value,params[2]=new Array(2),params[2][0]="template",params[2][1]=document.getElementById("wfu_templates").value;for(var n="",a=0;a<params.length;a++)n+=(a>0?"&":"")+params[a][0]+"="+encodeURI(params[a][1]);document.getElementById("wfu_templates").disabled=!0,document.getElementById("wfu_add_code").disabled=!0,document.getElementById("wfu_add_code_spinner").style.visibility="visible",e.open("POST",t,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4==e.readyState&&(document.getElementById("wfu_templates").disabled=!1,document.getElementById("wfu_add_code").disabled=!1,document.getElementById("wfu_add_code_spinner").style.visibility="hidden",200==e.status)){var t=e.responseText.indexOf("wfu_get_hook_code_from_template:");-1==t&&(t=e.responseText.length),e.responseText.substr(0,t);var n=e.responseText.substr(t+32,e.responseText.length-t-32);n=wfu_plugin_decode_string(n);var a="";n=n.replace(/\/\*scope:(\w*?)\*\/\n/,(function(e,t){return a=t,""})),wrapper=document.getElementById("wfu_phpeditor_wrapper"),wrapper.CodeMirror.doc.replaceSelection(n),"everywhere"==a?document.getElementById("wfu_scope_all").checked=!0:"dashboard"==a?document.getElementById("wfu_scope_back").checked=!0:"frontend"==a&&(document.getElementById("wfu_scope_front").checked=!0)}},e.send(n)}}}function wfu_update_envar(e){var t=document.getElementById("wfu_envar_value_"+e),n=document.getElementById("wfu_envar_initial_"+e),a=document.getElementById("wfu_envar_tr_"+e),o=document.getElementById("wfu_envar_restore_"+e);if(document.getElementById("wfu_envar_save_"+e),t.value!=n.value){var r=wfu_GetHttpRequestObject();if(null!=r){var l=AdminParams.wfu_ajax_url;params=new Array(4),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_update_envar",params[1]=new Array(2),params[1][0]="token",params[1][1]=document.getElementById("_wpnonce_envar").value,params[2]=new Array(2),params[2][0]="slug",params[2][1]=document.getElementById("wfu_envar_slug_"+e).value,params[3]=new Array(2),params[3][0]="value_enc",params[3][1]=wfu_plugin_encode_string(document.getElementById("wfu_envar_value_"+e).value);for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);a.className="wfu_envar_tr_updating",t.disabled=!0,o.style.display="none",r.open("POST",l,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState){if(t.disabled=!1,o.style.display="inline-block",200==r.status){var a=r.responseText.indexOf("wfu_update_envar:");-1==a&&(a=r.responseText.length),r.responseText.substr(0,a);var l=r.responseText.substr(a+17,r.responseText.length-a-17);if("success:"==l.substr(0,8)){var s=wfu_plugin_decode_string(l.substr(8));t.value=s,n.value=s}}wfu_envar_mark_line(e,t.value!=n.value)}},r.send(s)}}}function wfu_update_extension_active(e){var t=document.querySelector(".tr-"+e);if(t){var n=t.querySelector(".wfu-extensions-btn"),a=t.classList.contains("active"),o=wfu_GetHttpRequestObject();if(null!=o){var r=AdminParams.wfu_ajax_url;params=new Array(4),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_update_extension_active",params[1]=new Array(2),params[1][0]="token",params[1][1]=document.getElementById("_wpnonce").value,params[2]=new Array(2),params[2][0]="extension",params[2][1]=e,params[3]=new Array(2),params[3][0]="active",params[3][1]=a?"0":"1";for(var l="",s=0;s<params.length;s++)l+=(s>0?"&":"")+params[s][0]+"="+encodeURI(params[s][1]);n.classList.add("updating","disabled"),o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4==o.readyState&&(n.classList.remove("updating","disabled"),200==o.status)){var e=o.responseText.indexOf("wfu_update_extension_active:");-1==e&&(e=o.responseText.length),o.responseText.substr(0,e);var r=o.responseText.substr(e+28,o.responseText.length-e-28);if("success:"==r.substr(0,8)){var l=r.substr(8);a="1"==l,t.classList.toggle("active",a),t.classList.toggle("inactive",!a)}}},o.send(l)}}}function wfu_transfer_command(e,t,n){1==e&&"restart"==t&&!confirm("Are your sure you want to restart the transfer?")||1==e&&"remove"==t&&!confirm("Are your sure you want to stop and remove the transfer from the list?")||0==e&&"remove"==t&&!confirm("Are your sure you want to remove the transfer from the list?")||wfu_execute_transfer_command(n)}function wfu_execute_transfer_command(e){var t=document.getElementById("wfu_transfers_nonce").value,n=wfu_GetHttpRequestObject();if(null!=n){var a=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_transfer_command",params[1]=new Array(2),params[1][0]="code",params[1][1]=e,params[2]=new Array(2),params[2][0]="nonce",params[2][1]=t;for(var o="",r=0;r<params.length;r++)o+=(r>0?"&":"")+params[r][0]+"="+encodeURI(params[r][1]);if(window.wfu_transfers_refresh_status="refreshing",document.getElementById("wfu_transfers_timer_inner").style.width="100%","refresh"==e){var l=document.getElementById("wfu_transfers_switch");l.className=l.className.replace(" wfu_disabled","")+" wfu_disabled",document.getElementById("wfu_transfers_switch").disabled=!0,document.getElementById("wfu_transfers_refreshing").className="wfu_transfers_refreshing";var s=document.querySelectorAll("a.button.wfu_transfers_button, a.button.wfu_transfers_button_disabled");for(r=0;r<s.length;r++)s[r].className=s[r].className.replace(" wfu_disabled","")+" wfu_disabled"}else document.getElementById("wfu_filetransfers_overlay").style.display="block";n.open("POST",a,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){if("refresh"==e){l.className=l.className.replace(" wfu_disabled",""),document.getElementById("wfu_transfers_switch").disabled=!1,document.getElementById("wfu_transfers_refreshing").className="wfu_transfers_refreshing_disabled";for(var t=0;t<s.length;t++)s[t].className=s[t].className.replace(" wfu_disabled","")}else document.getElementById("wfu_filetransfers_overlay").style.display="none";var a=n.responseText.indexOf("wfu_transfer_command:");-1==a&&(a=n.responseText.length),n.responseText.substr(0,a);var o=n.responseText.substr(a+21,n.responseText.length-a-21);if("success:"==o.substr(0,8)){var r=wfu_plugin_decode_string(o.substr(8));document.getElementById("wfu_filetransfer_table").tBodies[0].innerHTML=r,window.wfu_transfers_refresh_timer=0,window.wfu_transfers_refresh_status="idle",document.getElementById("wfu_transfers_timer_inner").style.width="0%"}else"obsolete:"==o.substr(0,9)&&(r=wfu_plugin_decode_string(o.substr(9)),document.getElementById("wfu_filetransfer_table").tBodies[0].innerHTML=r,alert("Command was not executed because the status of the files has changed!"))}},n.send(o)}}function wfu_initiate_transfers_timer_observer(){window.wfu_transfers_interval=parseInt(document.getElementById("wfu_transfers_interval").value),-1!=window.wfu_transfers_interval&&(window.wfu_transfers_refresh_status="idle",window.wfu_transfers_refresh_timer=0,window.wfu_transfers_page_active=!0,window.wfu_transfers_autorefresh=!0,function(){var e="hidden";function t(t){var n="visible",a="hidden",o={focus:n,focusin:n,pageshow:n,blur:a,focusout:a,pagehide:a};if((t=t||window.event).type in o?"hidden"==o[t.type]:this[e])window.wfu_transfers_page_active=!1;else{if(window.wfu_transfers_page_active)return;window.wfu_transfers_page_active=!0,wfu_transfers_timer_observer()}}e in document?document.addEventListener("visibilitychange",t):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",t):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",t):(e="msHidden")in document?document.addEventListener("msvisibilitychange",t):"onfocusin"in document?document.onfocusin=document.onfocusout=t:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=t,void 0!==document[e]&&t({type:document[e]?"blur":"focus"})}(),wfu_transfers_timer_observer())}function wfu_transfers_timer_observer(){if(window.wfu_transfers_autorefresh&&-1!=window.wfu_transfers_interval){if("refreshing"==window.wfu_transfers_refresh_status)return window.wfu_transfers_refresh_timer=0,void setTimeout(wfu_transfers_timer_observer,wfu_transfers_observer_interval);var e=(new Date).getTime()/1e3;0==window.wfu_transfers_refresh_timer&&(window.wfu_transfers_refresh_timer=e);var t=e-window.wfu_transfers_refresh_timer;t>window.wfu_transfers_interval&&wfu_execute_transfer_command("refresh"),document.getElementById("wfu_transfers_timer_inner").style.width=Math.round(100*Math.min(t/window.wfu_transfers_interval,1))+"%",setTimeout(wfu_transfers_timer_observer,wfu_transfers_observer_interval)}}function wfu_transfers_switch(){var e=document.getElementById("wfu_transfers_switch");-1!==e.className.indexOf("wfu_pause")?(window.wfu_transfers_autorefresh=!1,e.className=e.className.replace("wfu_pause","wfu_refresh"),e.title="restart auto-refresh",window.wfu_transfers_refresh_timer=0,window.wfu_transfers_refresh_status="idle",document.getElementById("wfu_transfers_timer_inner").style.width="0%"):(window.wfu_transfers_autorefresh=!0,e.className=e.className.replace("wfu_refresh","wfu_pause"),e.title="pause auto-refresh",window.wfu_transfers_refresh_timer=(new Date).getTime()/1e3-window.wfu_transfers_interval-1,wfu_transfers_timer_observer())}function wfu_apply_notifications_bulkaction(){var e=document.getElementById("wfu_notifications_bulkactions");if(!(e.selectedIndex<1)){var t=document.querySelectorAll(".wfu_selectors:checked");if(0!=t.length){for(var n=[],a=0;a<t.length;a++){var o=t[a].className.replace(/.*?wfu_selcode_/,"");""!=o&&n.push(o)}var r=document.getElementById("wfu_notifications_action_url").value,l=document.getElementById("wfu_notifications_referer").value,s=document.getElementById("wfu_notifications_nonce").value,u="";switch(e.options[e.selectedIndex].value){case"mark_read":u="mark_notifications_read";break;case"mark_unread":u="mark_notifications_unread";break;case"delete":u="delete_notifications"}if(""!=u){var d=document.createElement("FORM");d.method="POST",d.action=r,d.style.display="none";var _=document.createElement("INPUT");_.type="hidden",_.name="action",_.value=u,d.appendChild(_);var i=document.createElement("INPUT");i.type="hidden",i.name="key",i.value="list:"+n.join(),d.appendChild(i);var c=document.createElement("INPUT");c.type="hidden",c.name="referer",c.value=l,d.appendChild(c);var f=document.createElement("INPUT");f.type="hidden",f.name="nonce",f.value=s,d.appendChild(f),document.body.appendChild(d),d.submit()}}}}function wfu_apply_notifications_filter(){var e=document.querySelectorAll('.wfu-filters .subsubsub li:not(.all) input[type="checkbox"]'),t="";if(!document.querySelector('.wfu-filters .subsubsub li.all input[type="checkbox"]').checked)for(var n=0;n<e.length;n++)e[n].checked&&(t+=(""==t?"":"_")+e[n].parentElement.className);var a=document.getElementById("wfu_notifications_action_url").value,o=document.getElementById("wfu_notifications_cursort").value;a+="&action=plugin_notifications",""!=o&&(a+="&sort="+o),""!=t&&(a+="&filter="+t);var r=document.createElement("FORM");r.method="POST",r.action=a,r.style.display="none",document.body.appendChild(r),r.submit()}function wfu_goto_notifications_page(e,t){var n=document.getElementById("wfu_notifications_pages"),a=n.selectedIndex+1,o=a;if("next"==t?o=Math.min(a+1,n.options.length):"prev"==t?o=Math.max(a-1,1):"last"==t?o=n.options.length:"first"==t?o=1:"sel"==t&&(a=-1),o!=a){var r=document.getElementById("wfu_notifications_action_url").value,l=document.getElementById("wfu_notifications_cursort").value,s=document.getElementById("wfu_notifications_filter").value;r+="&action=plugin_notifications",""!=l&&(r+="&sort="+l),""!=s&&(r+="&filter="+s),r+="&pageid="+o;var u=document.createElement("FORM");u.method="POST",u.action=r,u.style.display="none",document.body.appendChild(u),u.submit()}}function wfu_cleanlog_initialize_elements(){jQuery("#wfu_cleanlog_dateold").datepicker({dateFormat:"yy-mm-dd",beforeShow:function(){wfu_cleanlog_element_handler()},onSelect:function(){wfu_cleanlog_element_handler()},onClose:function(){wfu_cleanlog_element_handler()}}),jQuery("#wfu_cleanlog_datefrom").datepicker({dateFormat:"yy-mm-dd",beforeShow:function(){wfu_cleanlog_element_handler()},onSelect:function(){wfu_cleanlog_element_handler()},onClose:function(){wfu_cleanlog_element_handler()}}),jQuery("#wfu_cleanlog_dateto").datepicker({dateFormat:"yy-mm-dd",beforeShow:function(){wfu_cleanlog_element_handler()},onSelect:function(){wfu_cleanlog_element_handler()},onClose:function(){wfu_cleanlog_element_handler()}}),wfu_attach_element_handlers(document.getElementById("wfu_cleanlog_periodold"),wfu_cleanlog_element_handler),wfu_attach_element_handlers(document.getElementById("wfu_cleanlog_periodtype"),wfu_cleanlog_element_handler)}function wfu_cleanlog_element_handler(e){document.querySelector(".wfu_cleanlog_error").classList.add("hidden")}function wfu_cleanlog_period_changed(){var e=document.getElementById("wfu_cleanlog_period");0==e.selectedIndex?(document.querySelector(".wfu_selectdate_container").style.display="block",document.querySelector(".wfu_selectperiod_container").style.display="none",document.querySelector(".wfu_selectdates_container").style.display="none",document.getElementById("wfu_cleanlog_dateold").value="",document.querySelector(".wfu_cleanlog_proceed").classList.remove("disabled")):1==e.selectedIndex?(document.querySelector(".wfu_selectdate_container").style.display="none",document.querySelector(".wfu_selectperiod_container").style.display="block",document.querySelector(".wfu_selectdates_container").style.display="none",document.getElementById("wfu_cleanlog_periodold").value="1",document.getElementById("wfu_cleanlog_periodtype").selectedIndex=1,document.querySelector(".wfu_cleanlog_proceed").classList.remove("disabled")):2==e.selectedIndex?(document.querySelector(".wfu_selectdate_container").style.display="none",document.querySelector(".wfu_selectperiod_container").style.display="none",document.querySelector(".wfu_selectdates_container").style.display="block",document.getElementById("wfu_cleanlog_datefrom").value="",document.getElementById("wfu_cleanlog_dateto").value="",document.querySelector(".wfu_cleanlog_proceed").classList.remove("disabled")):3==e.selectedIndex?(document.querySelector(".wfu_selectdate_container").style.display="none",document.querySelector(".wfu_selectperiod_container").style.display="none",document.querySelector(".wfu_selectdates_container").style.display="none",document.querySelector(".wfu_cleanlog_proceed").classList.remove("disabled")):(document.querySelector(".wfu_selectdate_container").style.display="none",document.querySelector(".wfu_selectperiod_container").style.display="none",document.querySelector(".wfu_selectdates_container").style.display="none",document.querySelector(".wfu_cleanlog_proceed").classList.add("disabled")),document.querySelector(".wfu_cleanlog_error").classList.add("hidden")}function wfu_cleanlog_selector_toggle(e){e?(document.getElementById("wfu_includefiles").checked=!1,document.getElementById("wfu_cleanlog_period").selectedIndex=-1,wfu_cleanlog_period_changed(),document.querySelector(".wfu_cleanlog_tr").style.display="table-row"):document.querySelector(".wfu_cleanlog_tr").style.display="none"}function wfu_cleanlog_selector_validate(){var e={error:"",param:""},t=document.getElementById("wfu_includefiles").checked?"1":"0",n=document.getElementById("wfu_cleanlog_period");if(-1==n.selectedIndex)e.error="Invalid clean-up period selected";else if(0==n.selectedIndex){var a=jQuery("#wfu_cleanlog_dateold").datepicker("getDate");if(null==a)e.error="Invalid or empty date";else if(a>new Date)e.error="Date must be older than today";else{var o=jQuery.datepicker.formatDate("yymmdd",a);e.param="0"+t+":"+o.toString()}}else if(1==n.selectedIndex){var r=document.getElementById("wfu_cleanlog_periodold"),l=document.getElementById("wfu_cleanlog_periodtype");parseInt(r.value)<=0?e.error="Invalid period":l.selectedIndex<0||l.selectedIndex>2?e.error="Invalid period interval":e.param="1"+t+":"+r.value.toString()+":"+l.value.substr(0,1)}else if(2==n.selectedIndex){var s=jQuery("#wfu_cleanlog_datefrom").datepicker("getDate"),u=jQuery("#wfu_cleanlog_dateto").datepicker("getDate");if(null==s)e.error="Invalid or empty starting date";else if(null==u)e.error="Invalid or empty ending date";else if(s>new Date)e.error="Starting date must be older than today";else if(u>s)e.error="Ending date must be older or equal to starting date";else{var d=jQuery.datepicker.formatDate("yymmdd",s),_=jQuery.datepicker.formatDate("yymmdd",u);e.param="2"+t+":"+d.toString()+":"+_.toString()}}else 3==n.selectedIndex&&(e.param="3"+t);return e}function wfu_cleanlog_selector_checkproceed(){var e=wfu_cleanlog_selector_validate();return""!=e.error?(document.querySelector(".wfu_cleanlog_error").innerHTML=e.error,document.querySelector(".wfu_cleanlog_error").classList.remove("hidden"),!1):(document.querySelector(".wfu_cleanlog_error").classList.add("hidden"),document.querySelector(".wfu_cleanlog_proceed").href=document.getElementById("wfu_cleanlog_href").value+"&data="+e.param,!0)}function wfu_initialize_consent_policy(e){wfu_PD_bank.params=e,wfu_adjust_pdops_levels(),wfu_adjust_permissions_levels(),wfu_adjust_logactions_levels(),wfu_attach_pdheaders_events(),wfu_attach_pdops_events(),wfu_attach_conops_events(),wfu_pdops_update(!0),wfu_allops_freeze_events=!0,wfu_conops_update(),wfu_consent_question_optable_recreate(),wfu_update_consent_questions(),wfu_consent_question_operations_reassign(),wfu_update_consent_question_itemprops(0,-1),wfu_permissions_update(!0),wfu_logactions_update(!0),wfu_pdusers_update(),wfu_allops_freeze_events=!1}function wfu_get_consent_policy(){var e=wfu_plugin_decode_string(document.getElementById("wfu_consent_policy").value),t=null;try{t=JSON.parse(e)}catch(e){}return t}function wfu_get_permissions_policy(){var e=wfu_plugin_decode_string(document.getElementById("wfu_permissions_policy").value),t=null;try{t=JSON.parse(e)}catch(e){}return t}function wfu_get_logactions_policy(){var e=wfu_plugin_decode_string(document.getElementById("wfu_logactions_policy").value),t=null;try{t=JSON.parse(e)}catch(e){}return t}function wfu_get_pd_users(){var e=wfu_plugin_decode_string(document.getElementById("wfu_assigned_users").value),t=null;try{t=JSON.parse(e)}catch(e){}return t}function wfu_set_consent_policy(e){var t=JSON.stringify(e);document.getElementById("wfu_consent_policy").value=wfu_plugin_encode_string(t)}function wfu_set_logactions_policy(e){var t=JSON.stringify(e);document.getElementById("wfu_logactions_policy").value=wfu_plugin_encode_string(t)}function wfu_set_permissions_policy(e){var t=JSON.stringify(e);document.getElementById("wfu_permissions_policy").value=wfu_plugin_encode_string(t)}function wfu_adjust_pdops_levels(){function e(t){var a=t.ID;if(t.children.length>0)for(var o=0;o<t.children.length;o++)e(t.children[o]);else n.operations[a].Allowed=!0}function t(n,o){if(n.children.length>0)for(var r=0;r<n.children.length;r++)t(n.children[r],o+1);var l=n.ID;0==wfu_PD_bank.allowedstatus[l]&&o==wfu_PD_bank.params.oplevels&&(e(n),wfu_PD_bank.allowedstatus[l]=1,a=!0)}wfu_pdops_update(!1);var n=wfu_get_consent_policy();if(n){console.log(n);for(var a=!1,o=0;o<n.structure.length;o++)t(n.structure[o],1);a&&wfu_set_consent_policy(n)}}function wfu_attach_pdheaders_events(){var e,t=document.querySelectorAll(".wfu_pdheader_button");for(e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("expanded");var e=null;this.classList.contains("wfu_pdop_header_button")?e=document.querySelector(".wfu_plugin_operations"):this.classList.contains("wfu_conop_header_button")?e=document.querySelector(".wfu_consent_operations"):this.classList.contains("wfu_conquestion_header_button")?e=document.querySelector(".wfu_consent_questions"):this.classList.contains("wfu_permissions_header_button")?e=document.querySelector(".wfu_consent_permissions"):this.classList.contains("wfu_logactions_header_button")?e=document.querySelector(".wfu_consent_logactions"):this.classList.contains("wfu_pdusers_header_button")&&(e=document.querySelector(".wfu_consent_users")),e&&(this.classList.contains("expanded")?e.style.display="block":e.style.display="none")}))}function wfu_attach_pdops_events(){var e,t=document.querySelectorAll(".wfu_pdop_button");for(e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("expanded");var e=this.parentElement.nextElementSibling;this.classList.contains("expanded")?e.style.display="block":e.style.display="none"}))}function wfu_attach_conops_events(){var e,t=document.querySelectorAll(".wfu_conop_button");for(e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("expanded");var e=this.parentElement.nextElementSibling;this.classList.contains("expanded")?e.style.display="block":e.style.display="none"}))}function wfu_pdop_toggle(e){if(!wfu_allops_freeze_events&&-1!=e.id.indexOf("wfu_pdop_")){var t=e.id.replace("wfu_pdop_",""),n=wfu_get_consent_policy();if(n){if(void 0===n.operations[t])return;var a=e.classList.contains("indeterminate")?0:e.checked?-1:1,o=!!e.classList.contains("indeterminate")||e.checked;if(e.indeterminate||e.classList.remove("indeterminate"),n.children_index[t].length>0){for(var r=1,l=t;(l=n.operations[l].Parent)>0;)r++;if((wfu_PD_bank.params.oplevels<1||r<wfu_PD_bank.params.oplevels)&&!confirm("This will set all children operations to "+(o?"allowed":"not allowed")+". Continue?"))return wfu_allops_freeze_events=!0,wfu_set_checkbox_status(e,a),void(wfu_allops_freeze_events=!1);for(var s=0;s<n.children_index[t].length;s++){var u=n.children_index[t][s];0==n.children_index[u].length&&(n.operations[u].Allowed=o)}}else n.operations[t].Allowed=o;wfu_set_consent_policy(n),wfu_allops_freeze_events=!0,wfu_pdops_update(!0),wfu_conops_update(),wfu_update_consent_question_itemprops(0,-1),wfu_consent_question_optable_recreate(),wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(0,0),wfu_allops_freeze_events=!1}}}function wfu_conop_toggle(e){if(!wfu_allops_freeze_events&&-1!=e.id.indexOf("wfu_conop_")){var t=e.id.replace("wfu_conop_",""),n=wfu_get_consent_policy();if(n){if(void 0===n.operations[t])return;var a=e.classList.contains("indeterminate")?0:e.checked?-1:1,o=!!e.classList.contains("indeterminate")||e.checked;if(e.indeterminate||check.classList.remove("indeterminate"),n.children_index[t].length>0){for(var r=1,l=t;(l=n.operations[l].Parent)>0;)r++;if((wfu_PD_bank.params.oplevels<1||r<wfu_PD_bank.params.oplevels)&&!confirm("This will make all children operations "+(o?"require":"not require")+" consent. Continue?"))return wfu_allops_freeze_events=!0,wfu_set_checkbox_status(e,a),void(wfu_allops_freeze_events=!1);for(var s=0;s<n.children_index[t].length;s++){var u=n.children_index[t][s];0==n.children_index[u].length&&(n.operations[u].NeedsConsent=o)}}else n.operations[t].NeedsConsent=o;wfu_set_consent_policy(n),wfu_allops_freeze_events=!0,wfu_conops_update(),wfu_update_consent_question_itemprops(0,-1),wfu_consent_question_optable_recreate(),wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(0,0),wfu_allops_freeze_events=!1}}}function wfu_pdops_update(e){function t(a,o){var r=a.ID;if(a.children.length>0){n.operations[r].allowedstatus={},n.operations[r].pdvisible=!1;for(var l=0;l<a.children.length;l++){t(a.children[l],o+1);var s=a.children[l].ID;if(n.operations[s].pdvisible){for(var u in n.operations[s].Allowed,n.operations[s].allowedstatus)if(n.operations[s].allowedstatus.hasOwnProperty(u)){var d=n.operations[s].allowedstatus[u];void 0===n.operations[r].allowedstatus[u]?n.operations[r].allowedstatus[u]=d:n.operations[r].allowedstatus[u]*d<1&&(n.operations[r].allowedstatus[u]=0)}n.operations[r].pdvisible||(n.operations[r].pdvisible=n.operations[s].pdvisible)}}}else!function(e){var t=n.operations[e].Allowed;n.operations[e].allowedstatus={};for(var a=0;a<n.operations[e].Datatypes.length;a++){var o=n.operations[e].Datatypes[a];n.operations[e].allowedstatus[o]=t?1:-1}var r=n.operations[e].Condition;if(""==r)n.operations[e].pdvisible=!0;else{var l=!1;"!"==r.substr(0,1)&&(l=!0,r=r.replace("!",""));var s=n.operations[parseInt(r)].allowedstatus,u=!1;for(var o in s)if(s.hasOwnProperty(o)&&s[o]>-1){u=!0;break}n.operations[e].pdvisible=l?!u:u}}(r);var _=-2;for(var u in n.operations[r].allowedstatus)if(n.operations[r].allowedstatus.hasOwnProperty(u))if(d=n.operations[r].allowedstatus[u],-2==_)_=d;else if(_*d<1){_=0;break}if(void 0===wfu_PD_bank.allowedstatus&&(wfu_PD_bank.allowedstatus={}),wfu_PD_bank.allowedstatus[r]=_,void 0===wfu_PD_bank.level&&(wfu_PD_bank.level={}),wfu_PD_bank.level[r]=o,e){wfu_set_checkbox_status(document.getElementById("wfu_pdop_"+r),_);var i=document.getElementById("wfu_pdop_container_"+r);i&&(i.style.display=n.operations[r].pdvisible&&(wfu_PD_bank.params.oplevels<1||o<=wfu_PD_bank.params.oplevels)?"block":"none")}}var n=wfu_get_consent_policy();if(n){wfu_allops_freeze_events=!0;for(var a=0;a<n.structure.length;a++)t(n.structure[a],1);wfu_allops_freeze_events=!1}}function wfu_conops_update(){function e(n,a){var o=n.ID;if(n.children.length>0){t.operations[o].needsconsentstatus=-2,t.operations[o].convisible=!1;for(var r=0;r<n.children.length;r++){e(n.children[r],a+1);var l=n.children[r].ID;if(t.operations[l].convisible){var s=t.operations[l].needsconsentstatus;-2==t.operations[o].needsconsentstatus?t.operations[o].needsconsentstatus=s:t.operations[o].needsconsentstatus*s<1&&(t.operations[o].needsconsentstatus=0),t.operations[o].convisible||(t.operations[o].convisible=t.operations[l].convisible)}}}else!function(e){t.operations[e].needsconsentstatus=t.operations[e].Allowed&&t.operations[e].NeedsConsent?1:-1;var n=t.operations[e].Condition;if(""==n)t.operations[e].convisible=!0;else{var a=!1;"!"==n.substr(0,1)&&(a=!0,n=n.replace("!",""));var o=wfu_PD_bank.allowedstatus[parseInt(n)]>-1;t.operations[e].convisible=a?!o:o}t.operations[e].convisible=t.operations[e].convisible&&t.operations[e].Allowed}(o);void 0===wfu_PD_bank.visible&&(wfu_PD_bank.visible={}),wfu_PD_bank.visible[o]=t.operations[o].convisible,void 0===wfu_PD_bank.needsconsentstatus&&(wfu_PD_bank.needsconsentstatus={}),wfu_PD_bank.needsconsentstatus[o]=t.operations[o].needsconsentstatus,wfu_set_checkbox_status(document.getElementById("wfu_conop_"+o),t.operations[o].needsconsentstatus);var u=document.getElementById("wfu_conop_container_"+o);u&&(u.style.display=t.operations[o].convisible&&(wfu_PD_bank.params.oplevels<1||a<=wfu_PD_bank.params.oplevels)?"block":"none")}var t=wfu_get_consent_policy();if(t){wfu_allops_freeze_events=!0;for(var n=0;n<t.structure.length;n++)e(t.structure[n],1);wfu_allops_freeze_events=!1}}function wfu_update_consent_questions(){var e=wfu_get_consent_policy();if(e){var t=document.getElementById("wfu_conquestions_container");wfu_allops_freeze_events=!0;for(var n=0;n<e.questions.length;n++){var a=wfu_render_consent_question(n);a&&(t.appendChild(a),wfu_update_consent_question(n,!0))}wfu_update_conquestion_header(),wfu_allops_freeze_events=!1}}function wfu_render_consent_question(e){var t=wfu_get_consent_policy();if(!t)return null;var n=t.questions[e],a=e+1,o=document.createElement("DIV");o.className="wfu_conquestion_container",o.id="wfu_conquestion_container_"+a;var r=document.createElement("DIV");r.className="wfu_conquestion_header";var l=document.createElement("LABEL");l.className="wfu_conquestion_headerlabel",l.innerHTML="Question "+a,r.appendChild(l);var s=document.createElement("DIV");s.className="wfu_conquestion_tools";var u=document.getElementById("wfu_conquestion_add").cloneNode(!0);u.removeAttribute("id"),wfu_addEventHandler(u,"click",wfu_conquestion_tools_handler);var d=document.getElementById("wfu_conquestion_remove").cloneNode(!0);d.removeAttribute("id"),wfu_addEventHandler(d,"click",wfu_conquestion_tools_handler);var _=document.getElementById("wfu_conquestion_up").cloneNode(!0);_.removeAttribute("id"),wfu_addEventHandler(_,"click",wfu_conquestion_tools_handler);var i=document.getElementById("wfu_conquestion_down").cloneNode(!0);i.removeAttribute("id"),wfu_addEventHandler(i,"click",wfu_conquestion_tools_handler),s.appendChild(u),s.appendChild(d),s.appendChild(_),s.appendChild(i),r.appendChild(s);var c=document.createElement("DIV");c.className="wfu_conquestion_subcontainer";var f=document.createElement("DIV");f.className="wfu_conquestion_mainprops";var m=document.createElement("LABEL");m.className="wfu_conquestion_mainpropstitle",m.innerHTML="Main Properties";var p=document.createElement("LABEL");p.className="wfu_conquestion_titlelabel",p.innerHTML="Title";var w=document.createElement("INPUT");w.className="wfu_conquestion_titletext",w.value=n.title,wfu_attach_element_handlers(w,wfu_conquestion_mainprops_handler);var v=document.createElement("LABEL");v.className="wfu_conquestion_titlelocationlabel",v.innerHTML="Title Location";var g=document.createElement("SELECT");g.className="wfu_conquestion_titlelocationlist",(M=document.createElement("OPTION")).value="top",M.innerHTML="Top",M.selected="top"==n.location,g.add(M),(M=document.createElement("OPTION")).value="bottom",M.innerHTML="Bottom",M.selected="bottom"==n.location,g.add(M),wfu_addEventHandler(g,"change",wfu_conquestion_mainprops_handler);var h=document.createElement("LABEL");h.className="wfu_conquestion_matrixlabel",h.innerHTML="Number of Items";var b=document.createElement("INPUT");b.className="wfu_conquestion_matrix_x",b.type="number",b.min=1;var y=parseInt(n.x);y<=0&&(y=1),n.x=y,b.value=y,wfu_attach_element_handlers(b,wfu_conquestion_mainprops_handler);var I=document.createElement("LABEL");I.className="wfu_conquestion_matrixsep",I.innerHTML="x";var E=document.createElement("INPUT");E.className="wfu_conquestion_matrix_y",E.type="number",E.min=1;var k=parseInt(n.y);k<=0&&(k=1),n.y=k,E.value=k,wfu_attach_element_handlers(E,wfu_conquestion_mainprops_handler);var B=document.createElement("LABEL");B.className="wfu_conquestion_groupedlabel",B.innerHTML="Grouped";var x=document.createElement("INPUT");x.className="wfu_conquestion_groupedbox",x.type="checkbox",x.checked=1==n.grouped,wfu_addEventHandler(x,"change",wfu_conquestion_mainprops_handler);var q=document.createElement("LABEL");q.className="wfu_conquestion_typelabel",q.innerHTML="Type";var N=document.createElement("SELECT");N.className="wfu_conquestion_typelist",(M=document.createElement("OPTION")).value="checkbox",M.innerHTML="Checkbox",M.selected="checkbox"==n.type,N.add(M),(M=document.createElement("OPTION")).value="radio",M.innerHTML="Radio",M.selected="radio"==n.type,N.add(M),(M=document.createElement("OPTION")).value="prompt",M.innerHTML="Prompt",M.selected="prompt"==n.type,N.add(M),wfu_addEventHandler(N,"change",wfu_conquestion_mainprops_handler),f.appendChild(m),f.appendChild(h),f.appendChild(b),f.appendChild(I),f.appendChild(E),f.appendChild(p),f.appendChild(w),f.appendChild(v),f.appendChild(g),f.appendChild(B),f.appendChild(x),f.appendChild(q),f.appendChild(N);var T=document.createElement("DIV");T.className="wfu_conquestion_itemspreview";var L=document.createElement("LABEL");L.className="wfu_conquestion_itemspreviewtitle",L.innerHTML="Items";var S=document.createElement("LABEL");S.className="wfu_conquestion_displayedtitle",S.innerHTML=n.title;var P=document.createElement("TABLE");P.className="wfu_conquestion_itemtable",T.appendChild(L),"bottom"!=n.location&&T.appendChild(S),T.appendChild(P),"bottom"==n.location&&T.appendChild(S),wfu_addEventHandler(T,"click",wfu_conquestion_itempreviewer_handler);var A=document.createElement("DIV");A.className="wfu_conquestion_itemprops";var D=document.createElement("LABEL");D.className="wfu_conquestion_itempropstitle",D.innerHTML="Item Properties";var O=document.createElement("LABEL");O.className="wfu_conquestion_labellabel",O.innerHTML="Label";var C=document.createElement("INPUT");C.className="wfu_conquestion_labeltext",C.value="",wfu_attach_element_handlers(C,wfu_conquestion_mainprops_handler);var H=document.createElement("LABEL");H.className="wfu_conquestion_labellocationlabel",H.innerHTML="Label Location";var M,j=document.createElement("SELECT");j.className="wfu_conquestion_labellocationlist",(M=document.createElement("OPTION")).value="top",M.innerHTML="Top",M.selected=!1,j.add(M),(M=document.createElement("OPTION")).value="left",M.innerHTML="Left",M.selected=!1,j.add(M),(M=document.createElement("OPTION")).value="right",M.innerHTML="Right",M.selected=!0,j.add(M),(M=document.createElement("OPTION")).value="bottom",M.innerHTML="Bottom",M.selected=!1,j.add(M),wfu_addEventHandler(j,"change",wfu_conquestion_mainprops_handler);var R=document.createElement("LABEL");R.className="wfu_conquestion_preselectedlabel",R.innerHTML="Preselected";var z=document.createElement("INPUT");z.className="wfu_conquestion_preselectedbox",z.type="checkbox",z.checked=!1,wfu_addEventHandler(z,"change",wfu_conquestion_mainprops_handler);var V=document.createElement("LABEL");V.className="wfu_conquestion_visiblelabel",V.innerHTML="Visible";var U=document.createElement("INPUT");return U.className="wfu_conquestion_visiblebox",U.type="checkbox",U.checked=!0,wfu_addEventHandler(U,"change",wfu_conquestion_mainprops_handler),A.appendChild(D),A.appendChild(O),A.appendChild(C),A.appendChild(H),A.appendChild(j),A.appendChild(R),A.appendChild(z),A.appendChild(V),A.appendChild(U),c.appendChild(f),c.appendChild(T),c.appendChild(A),o.appendChild(r),o.appendChild(c),o}function wfu_consent_question_action(e,t){var n=wfu_get_consent_policy();if(n){var a=document.getElementById("wfu_conquestions_container"),o=document.querySelectorAll(".wfu_conquestion_container").length;if("add"==e){n.questions.splice(t+1,0,{title:"",location:"top",x:1,y:1,grouped:0,type:"checkbox",items:[{index:1,label:"I agree to allow the plugin to use my personal data",location:"right",preselect:0,visible:!0,operations:{}}]}),wfu_set_consent_policy(n);var r=wfu_render_consent_question(t+1);if(r){for(var l=t+2;l<=o;l++)document.getElementById("wfu_conquestion_container_"+l).id="wfu_conquestion_container_"+(l+1);a.insertBefore(r,document.getElementById("wfu_conquestion_container_"+(t+3))),wfu_update_consent_question(t+1,!0),wfu_update_consent_question_itemprops(t+1,-1)}}else if("remove"==e){if(o<=1)return;for(n.questions.splice(t,1),wfu_set_consent_policy(n),a.removeChild(document.getElementById("wfu_conquestion_container_"+(t+1))),l=t+2;l<=o;l++)document.getElementById("wfu_conquestion_container_"+l).id="wfu_conquestion_container_"+(l-1)}else if("up"==e){if(t<=0)return;var s=n.questions[t];n.questions[t]=n.questions[t-1],n.questions[t-1]=s,wfu_set_consent_policy(n);var u=document.getElementById("wfu_conquestion_container_"+(t+1)),d=document.getElementById("wfu_conquestion_container_"+t);u.id="wfu_conquestion_container_"+t+"_temp",d.id="wfu_conquestion_container_"+(t+1),u.id="wfu_conquestion_container_"+t,a.insertBefore(u,d)}else if("down"==e){if(t>=o-1)return;s=n.questions[t],n.questions[t]=n.questions[t+1],n.questions[t+1]=s,wfu_set_consent_policy(n),u=document.getElementById("wfu_conquestion_container_"+(t+2)),d=document.getElementById("wfu_conquestion_container_"+(t+1)),u.id="wfu_conquestion_container_"+(t+1)+"_temp",d.id="wfu_conquestion_container_"+(t+2),u.id="wfu_conquestion_container_"+(t+1),a.insertBefore(u,d)}}}function wfu_update_consent_question(e,t){var n=wfu_get_consent_policy();if(n){var a=n.questions[e],o=e+1,r=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_itemspreview"),l=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_itemtable"),s=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_displayedtitle");if(r){if(t){var u=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_matrix_x"),d=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_matrix_y"),_=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_titletext"),i=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_titlelocationlist"),c=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_groupedbox");for(u.value=a.x,d.value=a.y,_.value=a.title,i.value=a.location,c.checked=1==a.grouped,u.disabled="prompt"==a.type,d.disabled="prompt"==a.type,_.disabled="prompt"==a.type,i.disabled="prompt"==a.type,c.disabled="prompt"==a.type,s.style.display="prompt"==a.type?"none":"block";l.rows.length>0;)l.deleteRow(0)}for(var f=a.x*a.y,m=[],p=0;p<f;p++)m.push({label:"",location:"right",preselect:!1,visible:!0,operations:{}});for(p=0;p<a.items.length;p++)void 0===a.items[p].visible&&(a.items[p].visible=1);for(p=0;p<a.items.length;p++){var w=a.items[p].index-1;w>=0&&w<f&&(m[w].label=a.items[p].label,m[w].location=a.items[p].location,m[w].preselect=1==a.items[p].preselect,m[w].visible=void 0===a.items[p].visible||1==a.items[p].visible,m[w].operations=a.items[p].operations)}p=0;for(var v=0;v<a.x;v++){var g;g=t?l.insertRow(v):l.rows[v];for(var h=0;h<a.y;h++){var b;for(t?(b=g.insertCell(h)).classList.add("wfu_conquestion_itemcontainer"):b=g.cells[h];b.childNodes.length>0;)b.removeChild(b.childNodes[0]);m[p].visible?b.classList.add("wfu_item_visible"):b.classList.remove("wfu_item_visible");var y=document.createElement("LABEL");if(y.className="wfu_conquestion_itemlabel",""==m[p].label?(y.classList.add("wfu_empty_label"),y.innerHTML="{no label}"):(y.classList.remove("wfu_empty_label"),y.innerHTML=m[p].label),"prompt"==a.type)b.appendChild(y);else{var I=document.createElement("INPUT");I.className="wfu_conquestion_itembox wfu_frozen",I.type=a.type,I.checked=m[p].preselect,"top"==m[p].location?(b.appendChild(y),b.appendChild(document.createElement("BR")),b.appendChild(I)):"left"==m[p].location?(b.appendChild(y),b.appendChild(I)):"bottom"==m[p].location?(b.appendChild(I),b.appendChild(document.createElement("BR")),b.appendChild(y)):(b.appendChild(I),b.appendChild(y))}p++}}""==a.title?(s.classList.add("wfu_empty_label"),s.innerHTML="{no title}"):(s.classList.remove("wfu_empty_label"),s.innerHTML=a.title),"bottom"!=a.location?r.insertBefore(s,l):r.insertBefore(s,null)}}}function wfu_conquestion_mainprops_handler(e){if(!wfu_allops_freeze_events){var t=wfu_get_consent_policy();if(t){e=e||window.event;for(var n=par=e.target;(par=par.parentElement)&&!par.classList.contains("wfu_conquestion_container"););var a=parseInt(par.id.replace("wfu_conquestion_container_","")),o=a-1,r=t.questions[o],l=!0,s=!0,u=!1;if(n.classList.contains("wfu_conquestion_titletext"))r.title=n.value;else if(n.classList.contains("wfu_conquestion_matrix_x"))r.x=n.value;else if(n.classList.contains("wfu_conquestion_matrix_y"))r.y=n.value;else if(n.classList.contains("wfu_conquestion_titlelocationlist"))r.location=n.value;else if(n.classList.contains("wfu_conquestion_groupedbox")){if(r.grouped=n.checked?1:0,1==r.grouped)for(var d=0,_=0;_<r.items.length;_++)1==d?r.items[_].preselect=0:1==r.items[_].preselect&&d++}else if(n.classList.contains("wfu_conquestion_typelist"))r.type=n.value,"prompt"==r.type&&(r.x=1,r.y=1,r.title="",r.location="top",r.grouped=0);else{var i=document.querySelectorAll("#wfu_conquestion_container_"+a+" .wfu_conquestion_itemcontainer.wfu_item_selected");if(0==i.length)return;var c=i[0].parentNode.rowIndex*i[0].parentNode.cells.length+i[0].cellIndex+1,f=null,m=r.items.length;for(_=0;_<r.items.length;_++){if(r.items[_].index==c){f=r.items[_];break}if(r.items[_].index>c){m=_;break}}if(f||(f={index:c,label:"",location:"right",preselect:!1,visible:1,operations:{}},r.items.splice(m,0,f)),n.classList.contains("wfu_conquestion_labeltext"))f.label=n.value;else if(n.classList.contains("wfu_conquestion_labellocationlist"))f.location=n.value;else if(n.classList.contains("wfu_conquestion_preselectedbox")){if(n.checked&&1==r.grouped)for(_=0;_<r.items.length;_++)r.items[_].preselect=0;f.preselect=n.checked?1:0}else n.classList.contains("wfu_conquestion_visiblebox")&&(f.visible=n.checked?1:0,u=!0);l=!1,s=!1}wfu_set_consent_policy(t),wfu_allops_freeze_events=!0,wfu_update_consent_question(o,l),s&&(wfu_update_consent_question_itemprops(o,-1),wfu_consent_question_operations_reassign()),u&&(wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(a,c)),wfu_allops_freeze_events=!1}}}function wfu_conquestion_itempreviewer_handler(e){if(!wfu_allops_freeze_events){e=e||window.event;for(var t=par=e.target,n=document.querySelectorAll(".wfu_conquestion_container").length;(par=par.parentElement)&&!par.classList.contains("wfu_conquestion_container"););var a=parseInt(par.id.replace("wfu_conquestion_container_",""))-1;t.classList.contains("wfu_conquestion_itemcontainer")||(t=t.parentNode);var o=-1;t.classList.contains("wfu_conquestion_itemcontainer")&&(o=t.parentNode.rowIndex*t.parentNode.cells.length+t.cellIndex+1),wfu_allops_freeze_events=!0;for(var r=0;r<n;r++)wfu_update_consent_question_itemprops(r,-1);wfu_update_consent_question_itemprops(a,o),wfu_allops_freeze_events=!1}}function wfu_update_consent_question_itemprops(e,t){var n=wfu_get_consent_policy();if(n){for(var a=n.questions[e],o=e+1,r=document.querySelectorAll("#wfu_conquestions_container .wfu_conquestion_itemcontainer"),l=null,s=0,u=1,d=0;d<r.length;d++){r[d].classList.remove("wfu_item_selected");for(var _=r[d];(_=_.parentElement)&&!_.classList.contains("wfu_conquestion_container"););parseInt(_.id.replace("wfu_conquestion_container_",""))>s&&(s++,u=1),s==o&&u==t&&(l=r[d]),u++}l&&l.classList.add("wfu_item_selected");var i=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_labeltext"),c=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_labellocationlist"),f=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_preselectedbox"),m=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_visiblebox"),p=-1;for(d=0;d<a.items.length;d++)if(a.items[d].index==t){p=d;break}p<0?(i.value="",i.disabled=t<1,c.value="right",c.disabled=t<1,f.checked=!1,f.disabled=t<1,m.checked=!0,m.disabled=t<1):(i.disabled=!1,i.value=a.items[p].label,c.disabled="prompt"==a.type,c.value="prompt"==a.type?"":a.items[p].location,f.disabled="prompt"==a.type,f.checked="prompt"!=a.type&&1==a.items[p].preselect,m.disabled="prompt"==a.type||0==e&&1==t,m.checked="prompt"==a.type||void 0===a.items[p].visible||1==a.items[p].visible),wfu_consent_question_optable_update(o,t)}}function wfu_consent_question_optable_recreate(){var e=wfu_get_consent_policy();if(e){if(void 0!==wfu_PD_bank.conops)for(var t in wfu_PD_bank.conops)wfu_PD_bank.conops.hasOwnProperty(t)&&(wfu_PD_bank.conops[t].active=!1);for(var n=document.getElementById("wfu_conquestions_optable"),a=n.tBodies[0];a.rows.length>0;)n.rows[0].remove();var o=0;for(var t in wfu_PD_bank.allowedstatus)if(wfu_PD_bank.allowedstatus.hasOwnProperty(t)){var r=!0;if(r=(r=(r=r&&(0==e.children_index[t].length&&(wfu_PD_bank.params.oplevels<1||wfu_PD_bank.level[t]<=wfu_PD_bank.params.oplevels)||e.children_index[t].length>0&&wfu_PD_bank.level[t]==wfu_PD_bank.params.oplevels))&&1==wfu_PD_bank.needsconsentstatus[t])&&wfu_PD_bank.visible[t]){void 0===wfu_PD_bank.conops&&(wfu_PD_bank.conops={}),wfu_PD_bank.conops[t]={active:!0,qindex:[1],itemindex:[1],inverse:[!1],unassigned:!0,nonevisible:!1};var l=a.insertRow(o);l.id="wfu_conquestions_oprow_"+t;for(var s=l.insertCell(0),u=e.operations[t].Name,d=t;(d=e.operations[d].Parent)>0;)u=e.operations[d].Name+"/"+u;s.innerHTML=u,s=l.insertCell(1);var _=document.createElement("INPUT");_.type="radio",_.className="wfu_conquestions_opsel wfu_frozen",wfu_addEventHandler(_,"click",wfu_conquestion_optable_handler),s.appendChild(_),s=l.insertCell(2);var i=document.createElement("INPUT");i.type="checkbox",i.className="wfu_conquestions_opinv wfu_frozen",i.disabled=!0,wfu_addEventHandler(i,"change",wfu_conquestion_optable_handler),s.appendChild(i),o++}}}}function wfu_consent_question_operations_reassign(){var e=wfu_get_consent_policy();if(e){for(var t in wfu_PD_bank.conops)wfu_PD_bank.conops.hasOwnProperty(t)&&(wfu_PD_bank.conops[t].qindex=[],wfu_PD_bank.conops[t].itemindex=[],wfu_PD_bank.conops[t].inverse=[],wfu_PD_bank.conops[t].unassigned=!0,wfu_PD_bank.conops[t].nonevisible=!0);for(var n=0;n<e.questions.length;n++)for(var a=e.questions[n],o=0;o<a.items.length;o++){var r=a.items[o];for(var t in r.operations)r.operations.hasOwnProperty(t)&&void 0!==wfu_PD_bank.conops[t]&&(wfu_PD_bank.params.multi_op_assignments||0==wfu_PD_bank.conops[t].qindex.length?(wfu_PD_bank.conops[t].qindex.push(n+1),wfu_PD_bank.conops[t].itemindex.push(o+1),wfu_PD_bank.conops[t].inverse.push(-1==r.operations[t]),wfu_PD_bank.conops[t].unassigned=!1):delete r.operations[t])}for(var t in wfu_PD_bank.conops)if(wfu_PD_bank.conops.hasOwnProperty(t)){for(o=0;o<wfu_PD_bank.conops[t].qindex.length;){var l=wfu_PD_bank.conops[t].qindex[o],s=wfu_PD_bank.conops[t].itemindex[o],u=!1;if(l<1||l>e.questions.length)u=!0;else{var d=(a=e.questions[l-1]).x*a.y;(s<1||s>d)&&(u=!0)}u?(wfu_PD_bank.conops[t].qindex.splice(o,1),wfu_PD_bank.conops[t].itemindex.splice(o,1),wfu_PD_bank.conops[t].inverse.splice(o,1)):((void 0===(r=e.questions[l-1].items[s-1]).visible||r.visible)&&(wfu_PD_bank.conops[t].nonevisible=!1),o++)}wfu_PD_bank.conops[t].nonevisible&&(wfu_PD_bank.conops[t].unassigned=0==wfu_PD_bank.conops[t].qindex.length,wfu_PD_bank.conops[t].qindex.splice(0,0,1),wfu_PD_bank.conops[t].itemindex.splice(0,0,1),wfu_PD_bank.conops[t].inverse.splice(0,0,!1))}wfu_set_consent_policy(e),wfu_update_consent_question_item_assignments()}}function wfu_update_consent_question_item_assignments(){for(var e=document.querySelectorAll("#wfu_conquestions_container .wfu_conquestion_itemcontainer"),t=0;t<e.length;t++)e[t].classList.remove("wfu_item_assigned");for(var n in wfu_PD_bank.conops)if(wfu_PD_bank.conops.hasOwnProperty(n)&&wfu_PD_bank.conops[n].active)for(var a=0;a<wfu_PD_bank.conops[n].qindex.length;a++){var o=wfu_PD_bank.conops[n].qindex[a],r=wfu_PD_bank.conops[n].itemindex[a],l=document.querySelector("#wfu_conquestion_container_"+o+" .wfu_conquestion_itemtable"),s=l.rows[0].cells.length,u=Math.floor((r-1)/s),d=(r-1)%s;l.rows[u].cells[d].classList.add("wfu_item_assigned")}}function wfu_conquestion_conop_bankpos(e,t,n){for(var a=-1,o=0;o<wfu_PD_bank.conops[e].qindex.length;o++)if(wfu_PD_bank.conops[e].qindex[o]==t&&wfu_PD_bank.conops[e].itemindex[o]==n){a=o;break}return a}function wfu_consent_question_optable_update(e,t){var n=e<1||t<1;for(var a in wfu_PD_bank.conops)if(wfu_PD_bank.conops.hasOwnProperty(a)&&wfu_PD_bank.conops[a].active){var o=document.getElementById("wfu_conquestions_oprow_"+a),r=document.querySelector("#wfu_conquestions_oprow_"+a+" .wfu_conquestions_opsel"),l=document.querySelector("#wfu_conquestions_oprow_"+a+" .wfu_conquestions_opinv");wfu_PD_bank.conops[a].unassigned||wfu_PD_bank.conops[a].nonevisible?o.classList.add("wfu_op_unassigned"):o.classList.remove("wfu_op_unassigned");var s=wfu_conquestion_conop_bankpos(a,e,t);r.checked=!n&&s>-1,!n&&s>-1&&(wfu_PD_bank.conops[a].unassigned||wfu_PD_bank.conops[a].nonevisible)&&1==e&&1==t?r.classList.add("wfu_forced_selection"):r.classList.remove("wfu_forced_selection"),l.checked=!n&&s>-1&&wfu_PD_bank.conops[a].inverse[s],l.disabled=!(!n&&s>-1),n?(r.classList.add("wfu_frozen"),l.classList.add("wfu_frozen")):(r.classList.remove("wfu_frozen"),l.classList.remove("wfu_frozen"))}}function wfu_conquestion_optable_handler(e){if(!wfu_allops_freeze_events){var t=(e=e||window.event).target,n=document.querySelector("#wfu_conquestions_container .wfu_conquestion_itemcontainer.wfu_item_selected");if(n){for(var a=n;(a=a.parentElement)&&!a.classList.contains("wfu_conquestion_container"););for(var o=parseInt(a.id.replace("wfu_conquestion_container_","")),r=document.querySelectorAll("#wfu_conquestion_container_"+o+" .wfu_conquestion_itemcontainer"),l=-1,s=0;s<r.length;s++)if(r[s]==n){l=s+1;break}var u=wfu_get_consent_policy();if(u&&(t.classList.contains("wfu_conquestions_opsel")||t.classList.contains("wfu_conquestions_opinv"))){var d=parseInt(t.parentNode.parentNode.id.replace("wfu_conquestions_oprow_","")),_=wfu_PD_bank.conops[d],i=wfu_conquestion_conop_bankpos(d,o,l);if(i<0||_.unassigned){if(!wfu_PD_bank.params.multi_op_assignments||_.unassigned){var c=u.questions[_.qindex[0]-1];for(s=0;s<c.items.length;s++)if(c.items[s].index==_.itemindex[0]){void 0!==c.items[s].operations[d]&&delete c.items[s].operations[d];break}_.qindex.splice(0,1),_.itemindex.splice(0,1),_.inverse.splice(0,1)}_.qindex.push(o),_.itemindex.push(l),_.inverse.push(document.querySelector("#wfu_conquestions_oprow_"+d+" .wfu_conquestions_opinv").checked),_.unassigned=!1,i=_.qindex.length-1;var f=null,m=(c=u.questions[_.qindex[i]-1]).items.length;for(s=0;s<c.items.length;s++){if(c.items[s].index==_.itemindex[i]){(f=c.items[s]).operations[d]=_.inverse[i]?-1:1;break}if(c.items[s].index>l){m=s;break}}f||((f={index:_.itemindex[i],label:"",location:"right",preselect:!1,operations:{}}).operations[d]=_.inverse[i]?-1:1,c.items.splice(m,0,f)),wfu_set_consent_policy(u),wfu_allops_freeze_events=!0,wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(o,l),wfu_update_consent_question_item_assignments(),wfu_allops_freeze_events=!1}else if(t.classList.contains("wfu_conquestions_opsel")&&i>=0){for(c=u.questions[_.qindex[i]-1],s=0;s<c.items.length;s++)if(c.items[s].index==_.itemindex[i]){void 0!==c.items[s].operations[d]&&delete c.items[s].operations[d];break}_.qindex.splice(i,1),_.itemindex.splice(i,1),_.inverse.splice(i,1),wfu_set_consent_policy(u),wfu_allops_freeze_events=!0,t.checked=!1,wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(o,l),wfu_update_consent_question_item_assignments(),wfu_allops_freeze_events=!1}else if(t.classList.contains("wfu_conquestions_opinv")){for(_.inverse[i]=t.checked,c=u.questions[_.qindex[i]-1],s=0;s<c.items.length;s++)if(c.items[s].index==_.itemindex[i]){c.items[s].operations[d]=_.inverse[i]?-1:1;break}wfu_set_consent_policy(u)}}}}}function wfu_conquestion_tools_handler(e){if(!wfu_allops_freeze_events){for(var t=(e=e||window.event).target,n=document.querySelectorAll(".wfu_conquestion_container").length,a=t;(a=a.parentElement)&&!a.classList.contains("wfu_conquestion_container"););var o=parseInt(a.id.replace("wfu_conquestion_container_",""))-1;wfu_allops_freeze_events=!0;var r="";t.classList.contains("wfu_conquestion_add")?r="add":t.classList.contains("wfu_conquestion_remove")&&n>1?r="remove":t.classList.contains("wfu_conquestion_up")&&o>0?r="up":t.classList.contains("wfu_conquestion_down")&&o<n-1&&(r="down"),""!=r&&(wfu_update_consent_question_itemprops(0,-1),wfu_consent_question_action(r,o),wfu_consent_question_operations_reassign(),wfu_consent_question_optable_update(0,0),wfu_update_conquestion_header()),wfu_allops_freeze_events=!1}}function wfu_update_conquestion_header(){for(var e=document.querySelectorAll(".wfu_conquestion_headerlabel"),t=(document.querySelectorAll(".wfu_conquestion_tools .wfu_conquestion_btn.wfu_conquestion_add"),document.querySelectorAll(".wfu_conquestion_tools .wfu_conquestion_btn.wfu_conquestion_remove")),n=document.querySelectorAll(".wfu_conquestion_tools .wfu_conquestion_btn.wfu_conquestion_up"),a=document.querySelectorAll(".wfu_conquestion_tools .wfu_conquestion_btn.wfu_conquestion_down"),o=0;o<e.length;o++)e[o].innerHTML="Question "+(o+1),e.length>1?t[o].classList.remove("wfu_tool_disabled"):t[o].classList.add("wfu_tool_disabled"),o>0?n[o].classList.remove("wfu_tool_disabled"):n[o].classList.add("wfu_tool_disabled"),o<e.length-1?a[o].classList.remove("wfu_tool_disabled"):a[o].classList.add("wfu_tool_disabled")}function wfu_permissions_update(e){function t(a,o){var r=a.ID;if(a.children.length>0){n.permissions[r].allowedstatus={};for(var l=0;l<a.children.length;l++){t(a.children[l],o+1);var s=a.children[l].ID;for(var u in n.permissions[s].allowedstatus)if(n.permissions[s].allowedstatus.hasOwnProperty(u)){var d=n.permissions[s].allowedstatus[u];void 0===n.permissions[r].allowedstatus[u]?n.permissions[r].allowedstatus[u]=d:n.permissions[r].allowedstatus[u]*d<1&&(n.permissions[r].allowedstatus[u]=0)}}}else{var _=n.permissions[r].Allowed;n.permissions[r].allowedstatus={};for(var i=0;i<n.permissions[r].Locations.length;i++)u=n.permissions[r].Locations[i],n.permissions[r].allowedstatus[u]=_.indexOf(u)>-1?1:-1}if(void 0===wfu_PD_bank.perallowedstatus&&(wfu_PD_bank.perallowedstatus={}),wfu_PD_bank.perallowedstatus[r]=n.permissions[r].allowedstatus,e)for(var u in document.getElementById("wfu_perm_row_"+r),n.permissions[r].allowedstatus)n.permissions[r].allowedstatus.hasOwnProperty(u)&&wfu_set_checkbox_status(document.querySelector("#wfu_perm_row_"+r+" .wfu_location_cell:nth-child("+(parseInt(u)+1)+") input"),n.permissions[r].allowedstatus[u])}var n=wfu_get_permissions_policy();if(n){console.log(n),wfu_allops_freeze_events=!0;for(var a=0;a<n.structure.length;a++)t(n.structure[a],1);wfu_allops_freeze_events=!1}}function wfu_adjust_permissions_levels(){function e(t,a){var o=t.ID;if(t.children.length>0)for(var r=0;r<t.children.length;r++)e(t.children[r],a);else-1==n.permissions[o].Allowed.indexOf(a)&&n.permissions[o].Locations.indexOf(a)>-1&&n.permissions[o].Allowed.push(a)}function t(n,o){if(n.children.length>0)for(var r=0;r<n.children.length;r++)t(n.children[r],o+1);var l=n.ID;for(var s in wfu_PD_bank.perallowedstatus[l])wfu_PD_bank.perallowedstatus[l].hasOwnProperty(s)&&0==wfu_PD_bank.perallowedstatus[l][s]&&o==wfu_PD_bank.params.perlevels&&(e(n,parseInt(s)),wfu_PD_bank.perallowedstatus[l][s]=1,a=!0)}wfu_permissions_update(!1);var n=wfu_get_permissions_policy();if(n){for(var a=!1,o=0;o<n.structure.length;o++)t(n.structure[o],1);a&&wfu_set_permissions_policy(n)}}function wfu_perm_toggle(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_location_selector")){var t=e.parentNode.parentNode.id.replace("wfu_perm_row_",""),n=e.parentNode.cellIndex,a=wfu_get_permissions_policy();if(a){if(void 0===a.permissions[t])return;var o=e.classList.contains("indeterminate")?0:e.checked?-1:1,r=!!e.classList.contains("indeterminate")||e.checked;if(e.indeterminate||e.classList.remove("indeterminate"),a.children_index[t].length>0){for(var l=1,s=t;(s=a.permissions[s].Parent)>0;)l++;if((wfu_PD_bank.params.perlevels<1||l<wfu_PD_bank.params.perlevels)&&!confirm("This will make all children permissions "+(r?"allowed":"not allowed")+". Continue?"))return wfu_allops_freeze_events=!0,wfu_set_checkbox_status(e,o),void(wfu_allops_freeze_events=!1);for(var u=0;u<a.children_index[t].length;u++){var d=a.children_index[t][u];if(0==a.children_index[d].length){var _=a.permissions[d].Allowed.indexOf(n);r&&-1==_&&a.permissions[d].Locations.indexOf(n)>-1?a.permissions[d].Allowed.push(n):!r&&_>-1&&a.permissions[d].Allowed.splice(_,1)}}}else{var i=a.permissions[t].Allowed.indexOf(n);r&&-1==i&&a.permissions[t].Locations.indexOf(n)>-1?a.permissions[t].Allowed.push(n):!r&&i>-1&&a.permissions[t].Allowed.splice(i,1)}wfu_set_permissions_policy(a),wfu_allops_freeze_events=!0,wfu_permissions_update(!0),wfu_allops_freeze_events=!1}}}function wfu_perm_button_action(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_perm_button")){var t=wfu_get_permissions_policy();if(t){for(var n=e;(n=n.parentElement)&&!n.classList.contains("wfu_perm_row"););var a=parseInt(n.id.replace("wfu_perm_row_",""));e.classList.toggle("expanded");for(var o=0;o<t.children_index[a].length;o++){for(var r=t.children_index[a][o],l=r,s=!0;(l=t.permissions[l].Parent)>0;)s=s&&document.querySelector("#wfu_perm_row_"+l+" .wfu_perm_button")&&document.querySelector("#wfu_perm_row_"+l+" .wfu_perm_button").classList.contains("expanded");document.getElementById("wfu_perm_row_"+r).style.display=s?"table-row":"none"}}}}function wfu_logactions_update(e){function t(a,o){var r=a.ID;if(a.children.length>0){n.logactions[r].allowedstatus={};for(var l=0;l<a.children.length;l++){t(a.children[l],o+1);var s=a.children[l].ID;for(var u in n.logactions[s].allowedstatus)if(n.logactions[s].allowedstatus.hasOwnProperty(u)){var d=n.logactions[s].allowedstatus[u];void 0===n.logactions[r].allowedstatus[u]?n.logactions[r].allowedstatus[u]=d:n.logactions[r].allowedstatus[u]*d<1&&(n.logactions[r].allowedstatus[u]=0)}}}else{var _=n.logactions[r].Allowed;n.logactions[r].allowedstatus={};for(var i=0;i<n.logactions[r].Entities.length;i++)u=n.logactions[r].Entities[i],n.logactions[r].allowedstatus[u]=_.indexOf(u)>-1?1:-1}if(void 0===wfu_PD_bank.logallowedstatus&&(wfu_PD_bank.logallowedstatus={}),wfu_PD_bank.logallowedstatus[r]=n.logactions[r].allowedstatus,e)for(var u in document.getElementById("wfu_log_row_"+r),n.logactions[r].allowedstatus)n.logactions[r].allowedstatus.hasOwnProperty(u)&&wfu_set_checkbox_status(document.querySelector("#wfu_log_row_"+r+" .wfu_entity_cell:nth-child("+(parseInt(u)+1)+") input"),n.logactions[r].allowedstatus[u])}var n=wfu_get_logactions_policy();if(n){console.log(n),wfu_allops_freeze_events=!0;for(var a=0;a<n.structure.length;a++)t(n.structure[a],1);wfu_allops_freeze_events=!1}}function wfu_adjust_logactions_levels(){function e(t,a){var o=t.ID;if(t.children.length>0)for(var r=0;r<t.children.length;r++)e(t.children[r],a);else-1==n.logactions[o].Allowed.indexOf(a)&&n.logactions[o].Entities.indexOf(a)>-1&&n.logactions[o].Allowed.push(a)}function t(n,o){if(n.children.length>0)for(var r=0;r<n.children.length;r++)t(n.children[r],o+1);var l=n.ID;for(var s in wfu_PD_bank.logallowedstatus[l])wfu_PD_bank.logallowedstatus[l].hasOwnProperty(s)&&0==wfu_PD_bank.logallowedstatus[l][s]&&o==wfu_PD_bank.params.loglevels&&(e(n,parseInt(s)),wfu_PD_bank.logallowedstatus[l][s]=1,a=!0)}wfu_logactions_update(!1);var n=wfu_get_logactions_policy();if(n){for(var a=!1,o=0;o<n.structure.length;o++)t(n.structure[o],1);a&&wfu_set_logactions_policy(n)}}function wfu_log_toggle(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_entity_selector")){var t=e.parentNode.parentNode.id.replace("wfu_log_row_",""),n=e.parentNode.cellIndex,a=wfu_get_logactions_policy();if(a){if(void 0===a.logactions[t])return;var o=e.classList.contains("indeterminate")?0:e.checked?-1:1,r=!!e.classList.contains("indeterminate")||e.checked;if(e.indeterminate||e.classList.remove("indeterminate"),a.children_index[t].length>0){for(var l=1,s=t;(s=a.logactions[s].Parent)>0;)l++;if((wfu_PD_bank.params.loglevels<1||l<wfu_PD_bank.params.loglevels)&&!confirm("This will make all children log actions "+(r?"allowed":"not allowed")+". Continue?"))return wfu_allops_freeze_events=!0,wfu_set_checkbox_status(e,o),void(wfu_allops_freeze_events=!1);for(var u=0;u<a.children_index[t].length;u++){var d=a.children_index[t][u];if(0==a.children_index[d].length){var _=a.logactions[d].Allowed.indexOf(n);r&&-1==_&&a.logactions[d].Entities.indexOf(n)>-1?a.logactions[d].Allowed.push(n):!r&&_>-1&&a.logactions[d].Allowed.splice(_,1)}}}else{var i=a.logactions[t].Allowed.indexOf(n);r&&-1==i&&a.logactions[t].Entities.indexOf(n)>-1?a.logactions[t].Allowed.push(n):!r&&i>-1&&a.logactions[t].Allowed.splice(i,1)}wfu_set_logactions_policy(a),wfu_allops_freeze_events=!0,wfu_logactions_update(!0),wfu_allops_freeze_events=!1}}}function wfu_log_button_action(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_log_button")){var t=wfu_get_logactions_policy();if(t){for(var n=e;(n=n.parentElement)&&!n.classList.contains("wfu_log_row"););var a=parseInt(n.id.replace("wfu_log_row_",""));e.classList.toggle("expanded");for(var o=0;o<t.children_index[a].length;o++){for(var r=t.children_index[a][o],l=r,s=!0;(l=t.logactions[l].Parent)>0;)s=s&&document.querySelector("#wfu_log_row_"+l+" .wfu_log_button")&&document.querySelector("#wfu_log_row_"+l+" .wfu_log_button").classList.contains("expanded");document.getElementById("wfu_log_row_"+r).style.display=s?"table-row":"none"}}}}function wfu_pdusers_addrole_handler(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_pdusers_roles_add")){for(var t=e;(t=t.parentElement)&&!t.classList.contains("wfu_pdusers_roles_container"););for(var n=t.id.replace(/^wfu_pdusers_roles_(in|out)_container$/,"$1"),a=document.querySelector("#wfu_pdusers_roles_"+n+"_container .wfu_pdusers_roles_list"),o=[],r=0;r<a.options.length;r++)a.options[r].selected&&o.push(a.options[r].value);wfu_allops_freeze_events=!0,wfu_pdusers_add_roles(n,o),wfu_allops_freeze_events=!1}}function wfu_pdusers_add_roles(e,t){for(var n=document.querySelector("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_show"),a=document.querySelector("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_list"),o=document.querySelectorAll("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_rightpanel .wfu_pdusers_roles_role"),r=document.querySelector('#wfu_pdusers_roles_in_container input[type="radio"]').checked?"in":"out",l="in"==e?"included":"excluded",s=o.length,u=0;u<t.length;u++){var d="";if("all"==t[u])d="All";else for(var _=0;_<a.options.length;_++)if(a.options[_].value==t[u]){d=a.options[_].innerHTML;break}if(""!=d){var i=!1;for(_=0;_<o.length;_++)if(o[_].roleName==t[u]){i=!0;break}if(!i){-1==wfu_PD_bank.pdusers.rolestates[r][l].indexOf(t[u])&&wfu_PD_bank.pdusers.rolestates[r][l].push(t[u]),s>0&&n.appendChild(document.createElement("BR"));var c=document.createElement("DIV");if(c.classList.add("wfu_pdusers_roles_role"),c.roleName=t[u],c.innerHTML=d,"all"==t[u])c.classList.add("wfu_pdusers_roles_all");else{var f=document.createElement("SPAN");wfu_addEventHandler(f,"click",wfu_pdusers_removerole_handler),c.appendChild(f)}n.appendChild(c),s++}}}}function wfu_pdusers_clear_roles(e){for(var t=document.querySelector("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_show"),n=document.querySelectorAll("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_rightpanel .wfu_pdusers_roles_role"),a=document.querySelectorAll("#wfu_pdusers_roles_"+e+"_container .wfu_pdusers_roles_rightpanel br"),o=0;o<n.length;o++)t.removeChild(n[o]);for(o=0;o<a.length;o++)t.removeChild(a[o])}function wfu_pdusers_removerole_handler(e){if(!wfu_allops_freeze_events){var t=(e=e||window.event).target;if(t.parentNode.classList.contains("wfu_pdusers_roles_role")){for(var n=t.parentNode.roleName,a=t;(a=a.parentElement)&&!a.classList.contains("wfu_pdusers_roles_container"););var o=a.id.replace(/^wfu_pdusers_roles_(in|out)_container$/,"$1"),r=document.querySelector('#wfu_pdusers_roles_in_container input[type="radio"]').checked?"in":"out",l="in"==o?"included":"excluded",s=wfu_PD_bank.pdusers.rolestates[r][l].indexOf(n);s>-1&&wfu_PD_bank.pdusers.rolestates[r][l].splice(s,1);var u=t.parentNode.previousSibling,d=t.parentNode.nextSibling,_=document.querySelector("#"+a.id+" .wfu_pdusers_roles_show");wfu_allops_freeze_events=!0,_.removeChild(t.parentNode),u&&u.tagName&&"BR"==u.tagName?_.removeChild(u):d&&d.tagName&&"BR"==d.tagName&&_.removeChild(d),wfu_allops_freeze_events=!1}}}function wfu_pdusers_update(){var e=wfu_get_pd_users();if(e){console.log(e),wfu_PD_bank.pdusers={rolestates:{in:{included:[],excluded:[]},out:{included:["all"],excluded:[]}}},wfu_attach_element_handlers(document.querySelector('#wfu_pdusers_users_in_container .wfu_pdusers_users_leftpanel input[type="text"]'),wfu_pdusers_get_users),wfu_attach_element_handlers(document.querySelector('#wfu_pdusers_users_out_container .wfu_pdusers_users_leftpanel input[type="text"]'),wfu_pdusers_get_users),wfu_PD_bank.pdusers.userinput={in:{prev_value:""},out:{prev_value:""},xhr:null};var t=document.querySelector('#wfu_pdusers_roles_in_container input[type="radio"]'),n=document.querySelector("#wfu_pdusers_roles_in_container .wfu_pdusers_roles_list"),a=document.querySelector("#wfu_pdusers_roles_in_container .wfu_pdusers_roles_back"),o=document.querySelector('#wfu_pdusers_roles_out_container input[type="radio"]'),r=document.querySelector("#wfu_pdusers_roles_out_container .wfu_pdusers_roles_list"),l=document.querySelector("#wfu_pdusers_roles_out_container .wfu_pdusers_roles_back");e.roles_included.length>0&&"all"!=e.roles_included[0]||1==e.roles_excluded.length&&"all"==e.roles_excluded[0]||0==e.roles_included.length&&0==e.roles_excluded.length?(wfu_PD_bank.pdusers.rolestates.in.included=e.roles_included,n.disabled=!1,a.classList.add("active"),r.disabled=!0,l.classList.remove("active"),t.checked=!0,wfu_pdusers_add_roles("in",e.roles_included),wfu_pdusers_add_roles("out",[])):(wfu_PD_bank.pdusers.rolestates.out.excluded=e.roles_excluded,n.disabled=!0,a.classList.remove("active"),r.disabled=!1,l.classList.add("active"),o.checked=!0,wfu_pdusers_add_roles("in",["all"]),wfu_pdusers_add_roles("out",e.roles_excluded))}}function wfu_pdusers_roletype_handler(e){if(!wfu_allops_freeze_events&&"wfu_pdusers_roletypes"==e.name){var t=document.querySelector('#wfu_pdusers_roles_in_container input[type="radio"]'),n=document.querySelector("#wfu_pdusers_roles_in_container .wfu_pdusers_roles_list"),a=document.querySelector("#wfu_pdusers_roles_in_container .wfu_pdusers_roles_back"),o=document.querySelector('#wfu_pdusers_roles_out_container input[type="radio"]'),r=document.querySelector("#wfu_pdusers_roles_out_container .wfu_pdusers_roles_list"),l=document.querySelector("#wfu_pdusers_roles_out_container .wfu_pdusers_roles_back");wfu_allops_freeze_events=!0,wfu_pdusers_clear_roles("in"),wfu_pdusers_clear_roles("out"),"include"==e.value?(n.disabled=!1,a.classList.add("active"),r.disabled=!0,l.classList.remove("active"),t.checked=!0,wfu_pdusers_add_roles("in",wfu_PD_bank.pdusers.rolestates.in.included),wfu_pdusers_add_roles("out",wfu_PD_bank.pdusers.rolestates.in.excluded)):(n.disabled=!0,a.classList.remove("active"),r.disabled=!1,l.classList.add("active"),o.checked=!0,wfu_pdusers_add_roles("in",wfu_PD_bank.pdusers.rolestates.out.included),wfu_pdusers_add_roles("out",wfu_PD_bank.pdusers.rolestates.out.excluded)),wfu_allops_freeze_events=!1}}function wfu_pdusers_adduser_handler(e){if(!wfu_allops_freeze_events&&e.classList.contains("wfu_pdusers_users_add")){for(var t=e;(t=t.parentElement)&&!t.classList.contains("wfu_pdusers_users_container"););for(var n=t.id.replace(/^wfu_pdusers_users_(in|out)_container$/,"$1"),a=document.querySelector("#wfu_pdusers_users_"+n+"_container .wfu_pdusers_users_list"),o=[],r=0;r<a.options.length;r++)a.options[r].selected&&o.push(a.options[r].value);wfu_allops_freeze_events=!0,wfu_pdusers_add_users(n,o),wfu_allops_freeze_events=!1}}function wfu_pdusers_add_users(e,t){for(var n=document.querySelector("#wfu_pdusers_users_"+e+"_container .wfu_pdusers_users_show"),a=document.querySelector("#wfu_pdusers_users_"+e+"_container .wfu_pdusers_users_list"),o=document.querySelectorAll("#wfu_pdusers_users_"+e+"_container .wfu_pdusers_users_rightpanel .wfu_pdusers_users_user"),r=document.querySelectorAll("#wfu_pdusers_users_"+("in"==e?"out":"in")+"_container .wfu_pdusers_users_rightpanel .wfu_pdusers_users_user"),l=o.length,s=0;s<t.length;s++){for(var u="",d=0;d<a.options.length;d++)if(a.options[d].value==t[s]){u=a.options[d].innerHTML;break}if(""!=u){var _=!1;for(d=0;d<o.length;d++)if(o[d].userName==t[s]){_=!0;break}if(!_){for(l>0&&n.appendChild(document.createElement("BR")),d=0;d<r.length;d++)if(r[d].userName==t[s]){var i=wfu_allops_freeze_events;wfu_allops_freeze_events=!1,wfu_pdusers_removeuser_handler({target:r[d].children[0]}),wfu_allops_freeze_events=i;break}var c=document.createElement("DIV");c.classList.add("wfu_pdusers_users_user"),c.userName=t[s],c.innerHTML=u;var f=document.createElement("SPAN");wfu_addEventHandler(f,"click",wfu_pdusers_removeuser_handler),c.appendChild(f),n.appendChild(c),l++}}}}function wfu_pdusers_removeuser_handler(e){if(!wfu_allops_freeze_events){var t=(e=e||window.event).target;if(t.parentNode.classList.contains("wfu_pdusers_users_user")){t.parentNode.userName;for(var n=t;(n=n.parentElement)&&!n.classList.contains("wfu_pdusers_users_container"););n.id.replace(/^wfu_pdusers_users_(in|out)_container$/,"$1");var a=t.parentNode.previousSibling,o=t.parentNode.nextSibling,r=document.querySelector("#"+n.id+" .wfu_pdusers_users_show");wfu_allops_freeze_events=!0,r.removeChild(t.parentNode),a&&a.tagName&&"BR"==a.tagName?r.removeChild(a):o&&o.tagName&&"BR"==o.tagName&&r.removeChild(o),wfu_allops_freeze_events=!1}}}function wfu_pdusers_get_users(e){if(!wfu_allops_freeze_events){var t=(e=e||window.event).target;if(t.parentNode.classList.contains("wfu_pdusers_users_leftpanel")){for(var n=t;(n=n.parentElement)&&!n.classList.contains("wfu_pdusers_users_container"););var a=n.id.replace(/^wfu_pdusers_users_(in|out)_container$/,"$1");if(t.value!=wfu_PD_bank.pdusers.userinput[a].prev_value){wfu_PD_bank.pdusers.userinput[a].prev_value=t.value,null!=wfu_PD_bank.pdusers.xhr&&(wfu_PD_bank.pdusers.xhr.abort(),wfu_PD_bank.pdusers.xhr=null);var o=document.querySelector("#wfu_pdusers_users_"+a+"_container .wfu_pdusers_users_list");if(""!=t.value){var r=wfu_GetHttpRequestObject();if(null!=r){var l=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_pdusers_get_users",params[1]=new Array(2),params[1][0]="nonce",params[1][1]=document.getElementById("_wpnonce").value,params[2]=new Array(2),params[2][0]="query",params[2][1]=t.value;for(var s="",u=0;u<params.length;u++)s+=(u>0?"&":"")+params[u][0]+"="+encodeURI(params[u][1]);r.open("POST",l,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=r.responseText.indexOf("pdusers_get_users:");-1==e&&(e=r.responseText.length),r.responseText.substr(0,e);var t=wfu_plugin_decode_string(r.responseText.substr(e+18,r.responseText.length-e-18)),n=null;try{n=JSON.parse(t)}catch(e){}var a=o.options.length;for(u=0;u<a;u++)o.options[u]=null;for(u=0;u<n.length;u++){var l=document.createElement("OPTION");l.value=n[u].user_login,l.innerHTML=n[u].display_name+" ("+n[u].user_login+")",o.options.add(l)}}},wfu_PD_bank.pdusers.xhr=r,r.send(s)}}else{var d=o.options.length;for(u=0;u<d;u++)o.options[0]=null}}}}}function wfu_initialize_consent_policy_basic(){wfu_PD_bank.userinput={prev_value:"",xhr:null,prev_select:-1},wfu_attach_element_handlers(document.getElementById("wfu_pd_user_box0"),wfu_pd_get_users_basic)}function wfu_pd_get_users_basic(e){var t=(e=e||window.event).target;if(t.classList.contains("wfu_pd_user_box0")&&t.value!=wfu_PD_bank.userinput){var n=document.getElementById("wfu_pd_user_select0");if(wfu_PD_bank.userinput=t.value,null!=wfu_PD_bank.userinput.xhr&&(wfu_PD_bank.userinput.xhr.abort(),wfu_PD_bank.userinput.xhr=null),""!=t.value){var a=wfu_GetHttpRequestObject();if(null!=a){var o=AdminParams.wfu_ajax_url;params=new Array(3),params[0]=new Array(2),params[0][0]="action",params[0][1]="wfu_ajax_action_pdusers_get_users",params[1]=new Array(2),params[1][0]="nonce",params[1][1]=document.getElementById("_wpnonce").value,params[2]=new Array(2),params[2][0]="query",params[2][1]=t.value;for(var r="",l=0;l<params.length;l++)r+=(l>0?"&":"")+params[l][0]+"="+encodeURI(params[l][1]);a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=a.responseText.indexOf("pdusers_get_users:");-1==e&&(e=a.responseText.length),a.responseText.substr(0,e);var t=wfu_plugin_decode_string(a.responseText.substr(e+18,a.responseText.length-e-18)),o=null;try{o=JSON.parse(t)}catch(e){}var r=n.options.length;for(l=0;l<r;l++)n.options[0]=null;for(l=0;l<o.length;l++){var s=document.createElement("OPTION");s.value=o[l].user_login,s.innerHTML=o[l].display_name+" ("+o[l].user_login+")",n.options.add(s)}}},wfu_PD_bank.userinput.xhr=a,a.send(r)}}else{var s=n.options.length;for(l=0;l<s;l++)n.options[0]=null}}}function wfu_export_user_data(){var e=document.getElementById("wfu_pd_user_select0");if(e.selectedIndex<0)alert("No user has been selected!");else{var t={username:e.options[e.selectedIndex].value};wfu_download_file("exportdata:"+JSON.stringify(t),1)}}function wfu_erase_user_data_check(){var e=document.getElementById("wfu_pd_user_select0"),t=document.getElementById("wfu_erase_userdata0");return e.selectedIndex<0?(alert("No user has been selected!"),!1):(t.href=t.href.replace(/action=erase_userdata_ask.*$/,"action=erase_userdata_ask&username="+e.options[e.selectedIndex].value),!0)}function wfu_pd_pre_save_actions(){var e=JSON.stringify(wfu_PD_bank);document.getElementById("wfu_PD_bank").value=wfu_plugin_encode_string(e)}jQuery(document).ready((function(e){e(".wfu_color_field").wpColorPicker({change:function(e,t){console.log(t),window.aaa=t,e.target.value=t.color.to_s(),"wfu_text_elements"==e.target.name?wfu_update_text_value(e):"wfu_triplecolor_elements"==e.target.name&&wfu_update_triplecolor_value(e)}})})),wfu_Attach_Advanced_Admin_Events=function(){for(var e=document.getElementsByName("wfu_envar_value"),t=0;t<e.length;t++)wfu_attach_element_handlers(e[t],wfu_envar_value_changed)},wfu_envar_value_changed=function(e){var t=(e=e||window.event).target,n=t.id.replace("wfu_envar_value_",""),a=document.getElementById("wfu_envar_initial_"+n);wfu_envar_mark_line(n,t.value!=a.value)},wfu_envar_restore_default=function(e){var t=document.getElementById("wfu_envar_value_"+e);t.value=document.getElementById("wfu_envar_default_"+e).value,wfu_envar_value_changed({target:t})},wfu_envar_mark_line=function(e,t){var n=document.getElementById("wfu_envar_tr_"+e),a=document.getElementById("wfu_envar_save_"+e);t&&"wfu_envar_tr_changed"!=n.className?(n.className="wfu_envar_tr_changed",a.removeAttribute("disabled")):t||"wfu_envar_tr_normal"==n.className||(document.getElementById("wfu_envar_value_"+e).value==document.getElementById("wfu_envar_default_"+e).value?n.className="wfu_envar_tr_normal":n.className="wfu_envar_tr_different",a.setAttribute("disabled","disabled"))};
